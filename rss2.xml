<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>ì²¼ì‹œíŒ¬ ê°œë°œì ì‘ì—… ê³µê°„</title>
    <link>https://chelseafandev.github.io/</link>
    
    <atom:link href="https://chelseafandev.github.io/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>ë”ë””ë”ë¼ë„ ê¾¸ì¤€íˆ</description>
    <pubDate>Sun, 27 Oct 2024 06:39:57 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>ìì£¼ ì‚¬ìš©í•˜ì§„ ì•ŠëŠ”ë° í•„ìš”í•  ë•Œë§ˆë‹¤ ë§¤ë²ˆ ê²€ìƒ‰í•´ì„œ ì°¾ì•„ë´ì•¼í•˜ëŠ” git ëª…ë ¹ì–´</title>
      <link>https://chelseafandev.github.io/2024/10/27/tip-for-git-command/</link>
      <guid>https://chelseafandev.github.io/2024/10/27/tip-for-git-command/</guid>
      <pubDate>Sun, 27 Oct 2024 06:39:57 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;escape&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><escape><span id="more"></span></escape></p><!-- toc --><br><h3 id="1-ë‹¤ë¥¸-ë¸Œëœì¹˜ì—-ìˆëŠ”-ì»¤ë°‹-ë‚´ìš©ì„-ê°€ì ¸ì˜¤ê¸°"><a href="#1-ë‹¤ë¥¸-ë¸Œëœì¹˜ì—-ìˆëŠ”-ì»¤ë°‹-ë‚´ìš©ì„-ê°€ì ¸ì˜¤ê¸°" class="headerlink" title="1. ë‹¤ë¥¸ ë¸Œëœì¹˜ì— ìˆëŠ” ì»¤ë°‹ ë‚´ìš©ì„ ê°€ì ¸ì˜¤ê¸°"></a>1. ë‹¤ë¥¸ ë¸Œëœì¹˜ì— ìˆëŠ” ì»¤ë°‹ ë‚´ìš©ì„ ê°€ì ¸ì˜¤ê¸°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout &#123;ì»¤ë°‹ ë‚´ìš©ì„ ì¶”ê°€í•  ë¸Œëœì¹˜&#125;</span><br><span class="line">$ git cherry-pick &#123;ì»¤ë°‹ë²ˆí˜¸&#125;</span><br></pre></td></tr></table></figure><br><h3 id="2-Git-ì›ê²©-ì €ì¥ì†Œ-ì£¼ì†Œ-ë³€ê²½"><a href="#2-Git-ì›ê²©-ì €ì¥ì†Œ-ì£¼ì†Œ-ë³€ê²½" class="headerlink" title="2. Git ì›ê²© ì €ì¥ì†Œ ì£¼ì†Œ ë³€ê²½"></a>2. Git ì›ê²© ì €ì¥ì†Œ ì£¼ì†Œ ë³€ê²½</h3><ul><li><p>ì•„ë˜ ì»¤ë§¨ë“œë¥¼ í†µí•´ í˜„ì¬ remote ì£¼ì†Œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v</span><br></pre></td></tr></table></figure></li><li><p>ì›ê²© ì €ì¥ì†Œ ì£¼ì†Œë¥¼ ë³€ê²½í•˜ëŠ” ì»¤ë§¨ë“œëŠ” ì•„ë˜ì™€ ê°™ìŒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote set-url origin &#123;ë³€ê²½í• repoì£¼ì†Œ&#125;</span><br></pre></td></tr></table></figure></li></ul><br><h3 id="3-ì½”ë“œ-ìˆ˜ì •-ë‚´ì—­-í™•ì¸í•˜ê¸°"><a href="#3-ì½”ë“œ-ìˆ˜ì •-ë‚´ì—­-í™•ì¸í•˜ê¸°" class="headerlink" title="3. ì½”ë“œ ìˆ˜ì • ë‚´ì—­ í™•ì¸í•˜ê¸°"></a>3. ì½”ë“œ ìˆ˜ì • ë‚´ì—­ í™•ì¸í•˜ê¸°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git blame &#123;íŒŒì¼ëª…&#125;</span><br><span class="line">$ git blame -L ì‹œì‘ë¼ì¸ë²ˆí˜¸,ì¢…ë£Œë¼ì¸ë²ˆí˜¸ &#123;íŒŒì¼ëª…&#125;</span><br></pre></td></tr></table></figure><ul><li>ì•„ë˜ ì»¤ë§¨ë“œë¥¼ í†µí•´ íŠ¹ì • ì»¤ë°‹ì˜ ì„¸ë¶€ ë³€ê²½ ì‚¬í•­ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git show &#123;ì»¤ë°‹ë²ˆí˜¸&#125;</span><br></pre></td></tr></table></figure></li></ul><br><h3 id="4-commitì—†ì´-ë³€ê²½-ì‚¬í•­-ì„ì‹œ-ì €ì¥í•˜ê¸°"><a href="#4-commitì—†ì´-ë³€ê²½-ì‚¬í•­-ì„ì‹œ-ì €ì¥í•˜ê¸°" class="headerlink" title="4. commitì—†ì´ ë³€ê²½ ì‚¬í•­ ì„ì‹œ ì €ì¥í•˜ê¸°"></a>4. commitì—†ì´ ë³€ê²½ ì‚¬í•­ ì„ì‹œ ì €ì¥í•˜ê¸°</h3><ul><li><p>ì•„ë˜ ì»¤ë§¨ë“œë¥¼ í†µí•´ í˜„ì¬ ë¸Œëœì¹˜ì˜ ë³€ê²½ ì‚¬í•­ì„ ì„ì‹œ ì €ì¥í•  ìˆ˜ ìˆìŒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git stash</span><br></pre></td></tr></table></figure></li><li><p>ì•„ë˜ ì»¤ë§¨ë“œë¥¼ í†µí•´ í˜„ì¬ stash ëª©ë¡ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git stash list</span><br><span class="line">stash@&#123;0&#125;: WIP on feature/add_wkloggerimpl: 917106b1 Merge branch &#x27;fix/edlpinterface_segfault&#x27; into &#x27;dist&#x27;</span><br></pre></td></tr></table></figure></li><li><p>ì•„ë˜ ì»¤ë§¨ë“œë¥¼ í†µí•´ ì„ì‹œ ì €ì¥ëœ ë³€ê²½ ì‚¬í•­ì„ ë¸Œëœì¹˜ì— ë‹¤ì‹œ ë°˜ì˜í•  ìˆ˜ ìˆìŒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git stash pop stash@&#123;0&#125;</span><br></pre></td></tr></table></figure></li></ul><br><p><strong>Reference</strong></p><ul><li><a href="https://git-scm.com/docs">https://git-scm.com/docs</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/%EC%9C%A0%EC%9A%A9%ED%95%9C-%ED%8C%81/">ìœ ìš©í•œ íŒ</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/git-command/">git command</category>
      
      <category domain="https://chelseafandev.github.io/tags/git-stash/">git stash</category>
      
      <category domain="https://chelseafandev.github.io/tags/git-cherry-pick/">git cherry-pick</category>
      
      <category domain="https://chelseafandev.github.io/tags/git-blame/">git blame</category>
      
      <category domain="https://chelseafandev.github.io/tags/git-remote/">git remote</category>
      
      
      <comments>https://chelseafandev.github.io/2024/10/27/tip-for-git-command/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ê¸°ë³¸ì ì¸ Go í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒ</title>
      <link>https://chelseafandev.github.io/2024/07/28/my-golang-layout/</link>
      <guid>https://chelseafandev.github.io/2024/07/28/my-golang-layout/</guid>
      <pubDate>Sun, 28 Jul 2024 07:04:34 GMT</pubDate>
      
      <description>&lt;p&gt;ì œê°€ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ì ì¸ Go í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒì— ëŒ€í•´ ê°„ëµíˆ ì†Œê°œí•˜ê¸° ìœ„í•´ í•´ë‹¹ í¬ìŠ¤íŒ…ì„ ì‘ì„±í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ì œê°€ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ì ì¸ Go í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒì— ëŒ€í•´ ê°„ëµíˆ ì†Œê°œí•˜ê¸° ìœ„í•´ í•´ë‹¹ í¬ìŠ¤íŒ…ì„ ì‘ì„±í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p><span id="more"></span><br><!-- toc --><br><h1 id="í”„ë¡œì íŠ¸-ë ˆì´ì•„ì›ƒì´-í•„ìš”í•œ-ì´ìœ ëŠ”"><a href="#í”„ë¡œì íŠ¸-ë ˆì´ì•„ì›ƒì´-í•„ìš”í•œ-ì´ìœ ëŠ”" class="headerlink" title="í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒì´ í•„ìš”í•œ ì´ìœ ëŠ”?"></a>í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒì´ í•„ìš”í•œ ì´ìœ ëŠ”?</h1><p>ìµœì´ˆ í”„ë¡œì íŠ¸ ì„¤ê³„ìê°€ ì•„ë‹Œ ë˜ ë‹¤ë¥¸ ëˆ„êµ°ê°€ê°€ ìœ ì§€ë³´ìˆ˜ë¥¼ ë‹´ë‹¹í•˜ê²Œë˜ëŠ” ê²½ìš°(ëŒ€ë¶€ë¶„ì˜ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ íšŒì‚¬ì˜ ìƒí™©ì¼ ê²ƒìœ¼ë¡œ ìƒê°ë¨) í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒì´ ëª…í™•í•˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” ì „ì²´ êµ¬ì¡°ë¥¼ íŒŒì•…í•˜ê¸°ê°€ ì–´ë ¤ìš¸ ë¿ë§Œì•„ë‹ˆë¼ ì˜ë„ì¹˜ ì•Šì€ ë°©í–¥ìœ¼ë¡œ ì†ŒìŠ¤ ì½”ë“œê°€ ì¶”ê°€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><br><h1 id="Go-ì½”ë“œë¥¼-ì–´ë–»ê²Œ-ì‘ì„±í•´ì•¼í•˜ëŠ”ê°€"><a href="#Go-ì½”ë“œë¥¼-ì–´ë–»ê²Œ-ì‘ì„±í•´ì•¼í•˜ëŠ”ê°€" class="headerlink" title="Go ì½”ë“œë¥¼ ì–´ë–»ê²Œ ì‘ì„±í•´ì•¼í•˜ëŠ”ê°€?"></a>Go ì½”ë“œë¥¼ ì–´ë–»ê²Œ ì‘ì„±í•´ì•¼í•˜ëŠ”ê°€?</h1><p>ë¨¼ì € Golang ê³µì‹ í™ˆí˜ì´ì§€ì—ì„œ ì œê³µí•˜ê³  ìˆëŠ” Go ì½”ë“œ ì‘ì„± ê°€ì´ë“œë¥¼ í†µí•´ íŒ¨í‚¤ì§€(package)ì™€ ëª¨ë“ˆ(module)ì— ëŒ€í•œ ê°œë…ì„ ë¨¼ì € ì¡ì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. (<a href="https://go.dev/doc/code">í•´ë‹¹ ë§í¬</a>ë¥¼ í†µí•´ ì›ë¬¸ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p><h2 id="Code-organization"><a href="#Code-organization" class="headerlink" title="Code organization"></a>Code organization</h2><p>Go í”„ë¡œê·¸ë¨ì€ íŒ¨í‚¤ì§€ë“¤ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ì—¬ê¸°ì„œ *íŒ¨í‚¤ì§€(package)*ë€ í•¨ê»˜ ì»´íŒŒì¼ë˜ëŠ” ë™ì¼ ë””ë ‰í† ë¦¬ ë‚´ì˜ ì†ŒìŠ¤ íŒŒì¼ë“¤ì˜ ì§‘í•©ì…ë‹ˆë‹¤. íŒ¨í‚¤ì§€ ë‚´ í•˜ë‚˜ì˜ ì†ŒìŠ¤ íŒŒì¼ ì•ˆì— ì •ì˜ëœ í•¨ìˆ˜, íƒ€ì…, ë³€ìˆ˜ ê·¸ë¦¬ê³  ìƒìˆ˜ë“¤ì€ ë™ì¼í•œ íŒ¨í‚¤ì§€ ë‚´ì— ìˆëŠ” ë‹¤ë¥¸ ëª¨ë“  ì†ŒìŠ¤ íŒŒì¼ë“¤ì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><blockquote><p>Go programs are organized into packages. A package is a collection of source files in the same directory that are compiled together. Functions, types, variables, and constants defined in one source file are visible to all other source files within the same package.</p></blockquote><p>í•˜ë‚˜ì˜ ì €ì¥ì†ŒëŠ” í•œ ê°œ ì´ìƒì˜ ëª¨ë“ˆë“¤ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ *ëª¨ë“ˆ(module)*ì´ë€ í•¨ê»˜ ë°°í¬ë˜ëŠ” ì—°ê´€ëœ Go íŒ¨í‚¤ì§€ë“¤ì˜ ì§‘í•©ì…ë‹ˆë‹¤. Go ì €ì¥ì†ŒëŠ” ì¼ë°˜ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ëª¨ë“ˆë§Œì„ í¬í•¨í•˜ë©° ì´ ëª¨ë“ˆì€ ì €ì¥ì†Œì˜ root ê²½ë¡œì— ì¡´ì¬í•©ë‹ˆë‹¤. ì €ì¥ì†Œì˜ root ê²½ë¡œì— go.mod ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì—ì„œëŠ” ëª¨ë“ˆ ê²½ë¡œë¥¼ ì„ ì–¸í•´ì£¼ëŠ”ë° ì´ ê²½ë¡œëŠ” ëª¨ë“ˆ ë‚´ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  íŒ¨í‚¤ì§€ë“¤ì˜ ì„í¬íŠ¸ ê²½ë¡œì˜ ì ‘ë‘ì‚¬(prefix)ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. ëª¨ë“ˆì€ go.mod íŒŒì¼ì´ í¬í•¨ëœ ë””ë ‰í† ë¦¬ì— ì¡´ì¬í•˜ëŠ” íŒ¨í‚¤ì§€ë“¤ë¿ë§Œì•„ë‹ˆë¼ ê·¸ ë””ë ‰í† ë¦¬ë“¤ì˜ í•˜ìœ„ ë””ë ‰í† ë¦¬ì— ì¡´ì¬í•˜ëŠ” íŒ¨í‚¤ì§€ë“¤ê¹Œì§€ í¬í•¨í•©ë‹ˆë‹¤.(ë§Œì•½ go.mod íŒŒì¼ì´ ë‘ ê°œ ì´ìƒ ì¡´ì¬í•˜ëŠ” ê²½ìš°ë¼ë©´ ë˜ ë‹¤ë¥¸ go.mod íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ” ë‹¤ìŒ í•˜ìœ„ ë””ë ‰í† ë¦¬ ì „ê¹Œì§€ë¥¼ í¬í•¨í•¨)</p><blockquote><p>A repository contains one or more modules. A module is a collection of related Go packages that are released together. A Go repository typically contains only one module, located at the root of the repository. A file named go.mod there declares the module path: the import path prefix for all packages within the module. The module contains the packages in the directory containing its go.mod file as well as subdirectories of that directory, up to the next subdirectory containing another go.mod file (if any).</p></blockquote><p>ì—¬ëŸ¬ë¶„ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë¹Œë“œí•˜ê¸° ì „ì— ì´ê²ƒì„ ì›ê²© ì €ì¥ì†Œì— ë°°í¬í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ëª¨ë“ˆì€ ì›ê²© ì €ì¥ì†Œì—ì„œ ê´€ë¦¬ë˜ì§€ ì•Šë”ë¼ë„ ë¡œì»¬ì—ì„œ ì •ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë¯¸ë˜ì˜ ë°°í¬ ê°€ëŠ¥ì„±ì„ ì—´ì–´ë‘ê³  ì—¬ëŸ¬ë¶„ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì¡°ì§í™”í•˜ëŠ” ê²ƒì€ ì¢‹ì€ ìŠµê´€ì…ë‹ˆë‹¤.</p><blockquote><p>Note that you donâ€™t need to publish your code to a remote repository before you can build it. A module can be defined locally without belonging to a repository. However, itâ€™s a good habit to organize your code as if you will publish it someday.</p></blockquote><p>ê° ëª¨ë“ˆì˜ ê²½ë¡œ ì •ë³´ëŠ” í•´ë‹¹ ëª¨ë“ˆì— í¬í•¨ëœ íŒ¨í‚¤ì§€ë“¤ì˜ ì„í¬íŠ¸ ê²½ë¡œì˜ ì ‘ë‘ì‚¬(prefix)ë¥¼ ì œê³µí•  ë¿ë§Œ ì•„ë‹ˆë¼, go ëª…ë ¹ì–´ê°€ í•´ë‹¹ ëª¨ë“ˆì„ ë‹¤ìš´ë¡œë“œí•˜ê¸° ìœ„í•´ ë°”ë¼ë´ì•¼í•  ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, golang.org/x/tools ë¼ëŠ” ëª¨ë“ˆì„ ë‹¤ìš´ë¡œë“œ í•˜ê¸°ìœ„í•´ì„œëŠ” go ëª…ë ¹ì–´ê°€ <a href="https://golang.org/x/tools%EA%B0%80">https://golang.org/x/toolsê°€</a> ê°€ë¦¬í‚¤ëŠ” ì €ì¥ì†Œë¥¼ ì°¸ê³ í•  ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>Each moduleâ€™s path not only serves as an import path prefix for its packages, but also indicates where the go command should look to download it. For example, in order to download the module golang.org/x/tools, the go command would consult the repository indicated by <a href="https://golang.org/x/tools">https://golang.org/x/tools</a> (described more here).</p></blockquote><p>ì„í¬íŠ¸ ê²½ë¡œëŠ” íŒ¨í‚¤ì§€ë¥¼ ì„í¬íŠ¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. íŒ¨í‚¤ì§€ì˜ ì„í¬íŠ¸ ê²½ë¡œëŠ” í•´ë‹¹ íŒ¨í‚¤ì§€ì˜ ëª¨ë“ˆ ê²½ë¡œì™€ ëª¨ë“ˆ ë‚´ì— ì¡´ì¬í•˜ëŠ” ì—°ê²°ëœ í•˜ìœ„ ë””ë ‰í† ë¦¬ ê²½ë¡œì…ë‹ˆë‹¤. ì—ë¥¼ ë“¤ì–´, github.com/google/go-cmp ëª¨ë“ˆì€ cmp/ ë””ë ‰í† ë¦¬ ì•ˆì˜ íŒ¨í‚¤ì§€ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ê·¸ íŒ¨í‚¤ì§€ì˜ ì„í¬íŠ¸ ê²½ë¡œëŠ” github.com/google/go-cmp/cmp ì…ë‹ˆë‹¤. ìŠ¤íƒ ë‹¤ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‚´ì˜ íŒ¨í‚¤ì§€ë“¤ì€ ëª¨ë“ˆ ê²½ë¡œ ì ‘ë‘ì‚¬ë¥¼ ê°€ì§€ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.</p><blockquote><p>An import path is a string used to import a package. A packageâ€™s import path is its module path joined with its subdirectory within the module. For example, the module github.com/google/go-cmp contains a package in the directory cmp/. That packageâ€™s import path is github.com/google/go-cmp/cmp. Packages in the standard library do not have a module path prefix.</p></blockquote><h2 id="Your-first-program"><a href="#Your-first-program" class="headerlink" title="Your first program"></a>Your first program</h2><p>ë‹¨ìˆœí•œ í”„ë¡œê·¸ë¨ì„ ì»´íŒŒì¼í•˜ê³  ì‹¤í–‰í•˜ê¸° ìœ„í•´ ë¨¼ì € ëª¨ë“ˆ ê²½ë¡œ(example/user/helloë¼ëŠ” ê²½ë¡œë¥¼ ì‚¬ìš©í•  ì˜ˆì •)ë¥¼ ì„ íƒí•˜ê³ , ê·¸ ê²½ë¡œë¥¼ ì„ ì–¸í•˜ê³  ìˆëŠ” go.mod íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.  </p><blockquote><p>To compile and run a simple program, first choose a module path (weâ€™ll use example/user/hello) and create a go.mod file that declares it:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir hello # Alternatively, clone it <span class="keyword">if</span> it already exists in version control.</span><br><span class="line">$ cd hello</span><br><span class="line">$ <span class="keyword">go</span> mod init example/user/hello</span><br><span class="line"><span class="keyword">go</span>: creating <span class="built_in">new</span> <span class="keyword">go</span>.mod: module example/user/hello</span><br><span class="line">$ cat <span class="keyword">go</span>.mod</span><br><span class="line">module example/user/hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.16</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>Go ì†ŒìŠ¤ íŒŒì¼ì˜ ì²«ë²ˆì§¸ ë¬¸ì¥ìœ¼ë¡œëŠ” íŒ¨í‚¤ì§€ ì´ë¦„ì´ ì‘ì„±ë¼ì•¼í•©ë‹ˆë‹¤. ì‹¤í–‰ ê°€ëŠ¥í•œ ëª…ë ¹ì–´ëŠ” í•­ìƒ main íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.</p><blockquote><p>The first statement in a Go source file must be package name. Executable commands must always use package main.</p></blockquote><p>ë‹¤ìŒìœ¼ë¡œ í•´ë‹¹ ë””ë ‰í† ë¦¬ ë‚´ì— ì•„ë˜ Go ì½”ë“œë¥¼ í¬í•¨í•˜ëŠ” hello.go íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.</p><blockquote><p>Next, create a file named hello.go inside that directory containing the following Go code:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello, world.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ì œ ì—¬ëŸ¬ë¶„ì€ go toolì„ ì‚¬ìš©í•´ì„œ í”„ë¡œê·¸ë¨ì„ ë¹Œë“œí•˜ê³  ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Now you can build and install that program with the go tool:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> install example/user/hello</span><br></pre></td></tr></table></figure><p>ì´ ëª…ë ¹ì–´ëŠ” hello ëª…ë ¹ì–´ë¥¼ ë¹Œë“œí•˜ê³ , ì‹¤í–‰ê°€ëŠ¥í•œ ë°”ì´ë„ˆë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³ ë‚˜ì„œ ê·¸ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ $HOME/go/bin/hello ê²½ë¡œì— ì„¤ì¹˜í•©ë‹ˆë‹¤.</p><blockquote><p>This command builds the hello command, producing an executable binary. It then installs that binary as $HOME/go/bin/hello.</p></blockquote><p>ì„¤ì¹˜ ê²½ë¡œëŠ” GOPATHì™€ GOBIN í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ GOBIN í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ì´ë˜ì—ˆë‹¤ë©´, ë°”ì´ë„ˆë¦¬ íŒŒì¼ì€ ê·¸ ê²½ë¡œì— ì„¤ì¹˜ë ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ GOPATHê°€ ì„¤ì •ë˜ì—ˆë‹¤ë©´, ë°”ì´ë„ˆë¦¬ íŒŒì¼ì€ GOPATH ë¦¬ìŠ¤íŠ¸ì˜ ì²«ë²ˆì§¸ ë””ë ‰í† ë¦¬ì˜ bin ì´ë¼ëŠ” í•˜ìœ„ ë””ë ‰í† ë¦¬ì— ì„¤ì¹˜ë  ê²ƒ ì…ë‹ˆë‹¤. ë‘ í™˜ê²½ ë³€ìˆ˜ ëª¨ë‘ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°ë¼ë©´, ë°”ì´ë„ˆë¦¬ íŒŒì¼ì€ ê¸°ë³¸ GOPATH ê²½ë¡œ($HOME/go)ì— ì„¤ì¹˜ë  ê²ƒ ì…ë‹ˆë‹¤.</p><blockquote><p>The install directory is controlled by the GOPATH and GOBIN environment variables. If GOBIN is set, binaries are installed to that directory. If GOPATH is set, binaries are installed to the bin subdirectory of the first directory in the GOPATH list. Otherwise, binaries are installed to the bin subdirectory of the default GOPATH ($HOME/go).</p></blockquote><p>ì—¬ëŸ¬ë¶„ì€ ì¶”í›„ì— ì‚¬ìš©ë  go ì»¤ë§¨ë“œê°€ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” í™˜ê²½ ë³€ìˆ˜ì˜ ê¸°ë³¸ ê°’ì„ go env ëª…ë ¹ì–´ë¥¼ í†µí•´ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>You can use the go env command to portably set the default value for an environment variable for future go commands:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env -w GOBIN=/somewhere/<span class="keyword">else</span>/bin</span><br></pre></td></tr></table></figure><p>go env -wë¥¼ í†µí•´ ì´ì „ì— ì„¤ì •í•œ ê°’ì„ í•´ì œí•˜ê³  ì‹¶ì€ ê²½ìš°ì—ëŠ” go env -uë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.</p><blockquote><p>To unset a variable previously set by go env -w, use go env -u:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> env -u GOBIN</span><br></pre></td></tr></table></figure><p>go installê³¼ ê°™ì€ ëª…ë ¹ì–´ëŠ” í˜„ì¬ ì‘ì—… ê²½ë¡œë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ëª¨ë“ˆì˜ ì»¨í…ìŠ¤íŠ¸ ë‚´ì— ì ìš©ë©ë‹ˆë‹¤. ë§Œì•½ ì‘ì—… ê²½ë¡œê°€ example/user/hello ëª¨ë“ˆ ë‚´ë¶€ê°€ ì•„ë‹ˆë¼ë©´, go insall ëª…ë ¹ì–´ëŠ” ì‹¤íŒ¨í•  ê²ƒ ì…ë‹ˆë‹¤.</p><blockquote><p>Commands like go install apply within the context of the module containing the current working directory. If the working directory is not within the example/user/hello module, go install may fail.</p></blockquote><p>í¸ë¦¬ì„±ì„ ìœ„í•´ go ëª…ë ¹ì–´ëŠ” ì‘ì—… ê²½ë¡œì— ìƒëŒ€ì ì¸ ê²½ë¡œë¥¼ í—ˆìš©í•˜ê³ , ë‹¤ë¥¸ ê²½ë¡œê°€ ì£¼ì–¸ì§„ ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´ í˜„ì¬ ì‘ì—… ê²½ë¡œì˜ íŒ¨í‚¤ì§€ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ í˜„ì¬ ìš°ë¦¬ì˜ ì‘ì—… ê²½ë¡œì—ì„œëŠ”, ì•„ë˜ ëª…ë ¹ì–´ë“¤ì´ ëª¨ë‘ ë™ì¼í•œ ê²°ê³¼ë¥¼ ê°–ìŠµë‹ˆë‹¤.</p><blockquote><p>For convenience, go commands accept paths relative to the working directory, and default to the package in the current working directory if no other path is given. So in our working directory, the following commands are all equivalent:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> install example/user/hello</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> install .</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> install</span><br></pre></td></tr></table></figure><p>ë‹¤ìŒìœ¼ë¡œ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ê¸° ìœ„í•´ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•´ë´…ì‹œë‹¤. ë°”ì´ë„ˆë¦¬ë¥¼ ì‰½ê²Œ ì‹¤í–‰í•˜ê¸° ìœ„í•´ PATH í™˜ê²½ ë³€ìˆ˜ì— ì„¤ì¹˜ ê²½ë¡œë¥¼ ì¶”ê°€í•  ê²ƒ ì…ë‹ˆë‹¤.</p><blockquote><p>Next, letâ€™s run the program to ensure it works. For added convenience, weâ€™ll add the install directory to our PATH to make running binaries easy:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Windows users should consult /wiki/SettingGOPATH</span><br><span class="line"># <span class="keyword">for</span> setting %PATH%.</span><br><span class="line">$ export PATH=$PATH:$(dirname $(<span class="keyword">go</span> list -f <span class="string">&#x27;&#123;&#123;.Target&#125;&#125;&#x27;</span> .))</span><br><span class="line">$ hello</span><br><span class="line">Hello, world.</span><br><span class="line">$</span><br></pre></td></tr></table></figure><h2 id="Importing-packages-from-your-module"><a href="#Importing-packages-from-your-module" class="headerlink" title="Importing packages from your module"></a>Importing packages from your module</h2><p>morestrings íŒ¨í‚¤ì§€ë¥¼ ì‘ì„±í•˜ê³  ê·¸ íŒ¨í‚¤ì§€ë¥¼ hello í”„ë¡œê·¸ë¨ì—ì„œ ì‚¬ìš©í•˜ë„ë¡ í•´ë´…ì‹œë‹¤. ë¨¼ì € í•´ë‹¹ íŒ¨í‚¤ì§€ë¥¼ ì €ì¥í•  $HOME/hello/morestrings ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³ ë‚˜ì„œ ì•„ë˜ ë‚´ìš©ì„ í¬í•¨í•˜ëŠ” reverse.go ë¼ëŠ” íŒŒì¼ì„ ê·¸ ë””ë ‰í† ë¦¬ ë‚´ì—ì„œ ìƒì„±í•´ì¤ì‹œë‹¤.</p><blockquote><p>Letâ€™s write a morestrings package and use it from the hello program. First, create a directory for the package named $HOME/hello/morestrings, and then a file named reverse.go in that directory with the following contents:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package morestrings implements additional functions to manipulate UTF-8</span></span><br><span class="line"><span class="comment">// encoded strings, beyond what is provided in the standard &quot;strings&quot; package.</span></span><br><span class="line"><span class="keyword">package</span> morestrings</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReverseRunes returns its argument string reversed rune-wise left to right.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReverseRunes</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    r := []<span class="keyword">rune</span>(s)</span><br><span class="line">    <span class="keyword">for</span> i, j := <span class="number">0</span>, <span class="built_in">len</span>(r)<span class="number">-1</span>; i &lt; <span class="built_in">len</span>(r)/<span class="number">2</span>; i, j = i+<span class="number">1</span>, j<span class="number">-1</span> &#123;</span><br><span class="line">        r[i], r[j] = r[j], r[i]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">string</span>(r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ReverseRunes() í•¨ìˆ˜ëŠ” ëŒ€ë¬¸ìë¡œ ì‹œì‘í•˜ê¸° ë•Œë¬¸ì— morestring íŒ¨í‚¤ì§€ë¥¼ ì„í¬íŠ¸í•œ ë˜ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë“¤ì—ì„œ í•´ë‹¹ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Because our ReverseRunes function begins with an upper-case letter, it is exported, and can be used in other packages that import our morestrings package.</p></blockquote><p>go buildë¡œ morestrings íŒ¨í‚¤ì§€ë¥¼ ì»´íŒŒì¼ í•´ë´…ì‹œë‹¤.</p><blockquote><p>Letâ€™s test that the package compiles with go build:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd $HOME/hello/morestrings</span><br><span class="line">$ <span class="keyword">go</span> build</span><br></pre></td></tr></table></figure><p>ìœ„ ëª…ë ¹ì–´ë¡œëŠ” ì–´ë– í•œ ê²°ê³¼ íŒŒì¼ì´ ìƒì„±ë˜ì§€ëŠ” ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ëŒ€ì‹ ì— ê·¸ê²ƒì€ ë¡œì»¬ ë¹Œë“œ ìºì‹œì— ì»´íŒŒì¼ëœ íŒ¨í‚¤ì§€ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.</p><blockquote><p>This wonâ€™t produce an output file. Instead it saves the compiled package in the local build cache.</p></blockquote><p>morestrings íŒ¨í‚¤ì§€ ë¹Œë“œ ì´í›„ì—, hello í”„ë¡œê·¸ë¨ì—ì„œ ì´ê²ƒì„ ì‚¬ìš©í•´ë´…ì‹œë‹¤. ì´ë¥¼ ìœ„í•´ $HOME/hello/hello.go ì½”ë“œì—ì„œ morestrings íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •í•´ë´…ì‹œë‹¤.</p><blockquote><p>After confirming that the morestrings package builds, letâ€™s use it from the hello program. To do so, modify your original $HOME/hello/hello.go to use the morestrings package:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;example/user/hello/morestrings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(morestrings.ReverseRunes(<span class="string">&quot;!oG ,olleH&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>hello í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•˜ê³ </p><blockquote><p>Install the hello program:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> install example/user/hello</span><br></pre></td></tr></table></figure><p>ìƒˆë¡œìš´ ë²„ì „ì˜ hello í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•´ë³´ë©´ ì—¬ëŸ¬ë¶„ì€ ë’¤ì§‘íŒ ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆì„ê²ë‹ˆë‹¤.</p><blockquote><p>Running the new version of the program, you should see a new, reversed message:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hello</span><br><span class="line">Hello, Go!</span><br></pre></td></tr></table></figure><h2 id="Importing-packages-from-remote-modules"><a href="#Importing-packages-from-remote-modules" class="headerlink" title="Importing packages from remote modules"></a>Importing packages from remote modules</h2><p>ì„í¬íŠ¸ ê²½ë¡œëŠ” ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œì¸ Git ì´ë‚˜ Mercurialì„ ì‚¬ìš©í•˜ëŠ” íŒ¨í‚¤ì§€ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì–´ë–»ê²Œ ë°›ì•„ì˜¤ëŠ”ì§€ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. go toolì€ ì›ê²© ì €ì¥ì†Œì— ìˆëŠ” íŒ¨í‚¤ì§€ë“¤ì„ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ì´ëŸ¬í•œ íŠ¹ì„±ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><blockquote><p>An import path can describe how to obtain the package source code using a revision control system such as Git or Mercurial. The go tool uses this property to automatically fetch packages from remote repositories. For instance, to use github.com/google/go-cmp/cmp in your program:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;example/user/hello/morestrings&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/google/go-cmp/cmp&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(morestrings.ReverseRunes(<span class="string">&quot;!oG ,olleH&quot;</span>))</span><br><span class="line">    fmt.Println(cmp.Diff(<span class="string">&quot;Hello World&quot;</span>, <span class="string">&quot;Hello Go&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ì œ ì—¬ëŸ¬ë¶„ì€ ì™¸ë¶€ ëª¨ë“ˆì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ê°€ì§€ê²Œ ë˜ì—ˆê³ , ê·¸ëŸ¬í•œ ëª¨ë“ˆì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ê·¸ê²ƒì˜ ë²„ì „ ì •ë³´ë¥¼ go.mode íŒŒì¼ ë‚´ì— ê¸°ë¡í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. go mod tidy ëª…ë ¹ì–´ëŠ” ì„í¬íŠ¸ íŒ¨í‚¤ì§€ë“¤ì— ëŒ€í•œ ëˆ„ë½ëœ ëª¨ë“ˆ ìš”êµ¬ì‚¬í•­ë“¤ì„ ì¶”ê°€í•´ì£¼ê³  ë”ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ëª¨ë“ˆë“¤ì— ëŒ€í•œ ìš”êµ¬ì‚¬í•­ë“¤ì„ ì œê±°í•´ì¤ë‹ˆë‹¤. </p><blockquote><p>Now that you have a dependency on an external module, you need to download that module and record its version in your go.mod file. The go mod tidy command adds missing module requirements for imported packages and removes requirements on modules that arenâ€™t used anymore.</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> mod tidy</span><br><span class="line"><span class="keyword">go</span>: finding module <span class="keyword">for</span> <span class="keyword">package</span> github.com/google/<span class="keyword">go</span>-cmp/cmp</span><br><span class="line"><span class="keyword">go</span>: found github.com/google/<span class="keyword">go</span>-cmp/cmp in github.com/google/<span class="keyword">go</span>-cmp v0<span class="number">.5</span><span class="number">.4</span></span><br><span class="line">$ <span class="keyword">go</span> install example/user/hello</span><br><span class="line">$ hello</span><br><span class="line">Hello, Go!</span><br><span class="line">  <span class="keyword">string</span>(</span><br><span class="line">-     <span class="string">&quot;Hello World&quot;</span>,</span><br><span class="line">+     <span class="string">&quot;Hello Go&quot;</span>,</span><br><span class="line">  )</span><br><span class="line">$ cat <span class="keyword">go</span>.mod</span><br><span class="line">module example/user/hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.16</span></span><br><span class="line"></span><br><span class="line">require github.com/google/<span class="keyword">go</span>-cmp v0<span class="number">.5</span><span class="number">.4</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>ëª¨ë“ˆ ì˜ì¡´ì„±ì€ GOPATH í™˜ê²½ ë³€ìˆ˜ê°€ ê°€ë¦¬í‚¤ëŠ” ê²½ë¡œì˜ í•˜ìœ„ ê²½ë¡œì¸ pkg/modì— ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ ë©ë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œëœ ëª¨ë“ˆì˜ ë²„ì „ ì •ë³´ë“¤ì€ í•´ë‹¹ ë²„ì „ì„ í•„ìš”ë¡œ í•˜ëŠ” ë‹¤ë¥¸ ëª¨ë“  ëª¨ë“ˆë“¤ì—ê²Œ ê³µìœ ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ go ëª…ë ¹ì–´ëŠ” ì´ëŸ¬í•œ íŒŒì¼ê³¼ ë””ë ‰í† ë¦¬ë¥¼ read-onlyë¡œ í‘œì‹œí•©ë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œ ë°›ì€ ëª¨ë“  ëª¨ë“ˆë“¤ì„ ì‚­ì œí•˜ê¸° ìœ„í•´ì„œëŠ” go clean ëª…ë ¹ì–´ì— -modcache í”Œë˜ê·¸ë¥¼ ì „ë‹¬í•´ì£¼ë©´ ë©ë‹ˆë‹¤. </p><blockquote><p>Module dependencies are automatically downloaded to the pkg/mod subdirectory of the directory indicated by the GOPATH environment variable. The downloaded contents for a given version of a module are shared among all other modules that require that version, so the go command marks those files and directories as read-only. To remove all downloaded modules, you can pass the -modcache flag to go clean:</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> clean -modcache</span><br></pre></td></tr></table></figure><br><h1 id="ë‚´ê°€-ì‚¬ìš©í•˜ëŠ”-Go-í”„ë¡œì íŠ¸-ë ˆì´ì•„ì›ƒ"><a href="#ë‚´ê°€-ì‚¬ìš©í•˜ëŠ”-Go-í”„ë¡œì íŠ¸-ë ˆì´ì•„ì›ƒ" class="headerlink" title="ë‚´ê°€ ì‚¬ìš©í•˜ëŠ” Go í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒ"></a>ë‚´ê°€ ì‚¬ìš©í•˜ëŠ” Go í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒ</h1><p>ë‹¤ì–‘í•œ í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒë“¤ì„ ë¹„êµí•´ë³¸ ëì— <a href="https://www.ardanlabs.com/blog/2017/02/package-oriented-design.html">Package Oriented Design</a>ë¼ëŠ” í¬ìŠ¤íŒ…ì„ ì°¸ì¡°í•˜ì—¬ í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒì„ êµ¬ì„±í•´ë³´ê¸°ë¡œ ê²°ì •í–ˆê³ , ì‹¤ì œ í˜„ì—…ì—ì„œ ê°œë°œ ì¤‘ì¸ ì„œë¹„ìŠ¤ë¥¼ ì´ êµ¬ì¡°ì— ë§ì¶°ì„œ êµ¬í˜„í•´ë‚˜ê°”ìŠµë‹ˆë‹¤.</p><h2 id="bin"><a href="#bin" class="headerlink" title="bin/"></a>bin/</h2><ul><li>ì‹¤í–‰ê°€ëŠ¥í•œ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì´ ìƒì„±ë˜ëŠ” ê²½ë¡œ</li><li>ë°”ì´ë„ˆë¦¬ ì‹¤í–‰ì„ ìœ„í•´ í•„ìš”í•œ ì„¤ì • ê°’ì´ ì €ì¥ë˜ëŠ” config íŒŒì¼ë„ í¬í•¨ë¨</li></ul><h2 id="cmd"><a href="#cmd" class="headerlink" title="cmd/"></a>cmd/</h2><ul><li>main íŒ¨í‚¤ì§€ë¥¼ í¬í•¨í•˜ëŠ” go íŒŒì¼ì´ ì €ì¥ë˜ëŠ” ê²½ë¡œ</li></ul><h2 id="internal"><a href="#internal" class="headerlink" title="internal/"></a>internal/</h2><ul><li>main íŒ¨í‚¤ì§€ì—ì„œ ì„í¬íŠ¸í•˜ëŠ” íŒ¨í‚¤ì§€ë“¤ì˜ ì§‘í•©ì´ë©°, ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ ë³„ë¡œ íŒ¨í‚¤ì§€ë“¤ì„ êµ¬ë¶„í•¨(ex. internal/gateway) </li></ul><p>ë™ì¼ í”„ë¡œì íŠ¸ ë‚´ì— ì¡´ì¬í•˜ëŠ” 2ê°œ ì´ìƒì˜ í”„ë¡œê·¸ë¨ë“¤ì—ì„œ ì„í¬íŠ¸ë  í•„ìš”ì„±ì´ ìˆëŠ” íŒ¨í‚¤ì§€ë“¤ì´ internal/ í´ë” ë‚´ì— ì†í•´ìˆìŠµë‹ˆë‹¤. internal/ ì´ë¼ëŠ” ëª…ì¹­ì˜ ì‚¬ìš©ì´ ê°€ì ¸ë‹¤ ì£¼ëŠ” í•œê°€ì§€ ì´ì ì€ í”„ë¡œì íŠ¸ê°€ ì»´íŒŒì¼ëŸ¬ë¡œë¶€í„° ì¶”ê°€ì ì¸ ë³´í˜¸ ë ˆë²¨ì„ ì–»ì–´ë‚¼ ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤. internal/ í´ë” ë‚´ì— ì¡´ì¬í•˜ëŠ” íŒ¨í‚¤ì§€ë“¤ì„ í•´ë‹¹ í”„ë¡œì íŠ¸ì˜ ì™¸ë¶€ì— ìˆëŠ” íŒ¨í‚¤ì§€ì—ì„œ ì„í¬íŠ¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì´ëŸ¬í•œ íŒ¨í‚¤ì§€ë“¤ì€ ì˜¤ë¡œì§€ í•´ë‹¹ í”„ë¡œì íŠ¸ ë‚´ì— ê·€ì†ë©ë‹ˆë‹¤.</p><blockquote><p>Packages that need to be imported by multiple programs within the project belong inside the internal/ folder. One benefit of using the name internal/ is that the project gets an extra level of protection from the compiler. No package outside of this project can import packages from inside of internal/. These packages are therefore internal to this project only.</p></blockquote><h2 id="internal-platform"><a href="#internal-platform" class="headerlink" title="internal/platform/"></a>internal/platform/</h2><ul><li>internalì— í¬í•¨ëœ íŒ¨í‚¤ì§€ë“¤ì—ì„œ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” íŒ¨í‚¤ì§€ë“¤ì˜ ì§‘í•©</li></ul><p>ê¸°ë°˜ì´ë˜ëŠ” ê·¸ëŸ¬ë‚˜ í”„ë¡œì íŠ¸ì— íŠ¹ì •ë˜ëŠ” íŒ¨í‚¤ì§€ë“¤ì´ internal/platform í´ë” ë‚´ì— ì†í•´ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ íŒ¨í‚¤ì§€ë“¤ì€ ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ì¸ì¦ ë˜ëŠ” marshalingê³¼ ê°™ì€ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•˜ê³¤ í•©ë‹ˆë‹¤.</p><blockquote><p>Packages that are foundational but specific to the project belong in the internal/platform/ folder. These would be packages that provide support for things like databases, authentication or even marshaling.</p></blockquote><br><h1 id="í”„ë¡œì íŠ¸-ì˜ˆì‹œ"><a href="#í”„ë¡œì íŠ¸-ì˜ˆì‹œ" class="headerlink" title="í”„ë¡œì íŠ¸ ì˜ˆì‹œ"></a>í”„ë¡œì íŠ¸ ì˜ˆì‹œ</h1><p>í˜„ì¬ í† ì´ í”„ë¡œì íŠ¸ë¡œ ì§„í–‰ì¤‘ì¸ go ì„œë¹„ìŠ¤ì—ì„œë„ ìœ„ í”„ë¡œì íŠ¸ ë ˆì´ì•„ì›ƒì„ ì‚¬ìš© ì¤‘ì— ìˆìŠµë‹ˆë‹¤. <a href="https://github.com/chelseafandev/wavynote/tree/main">í•´ë‹¹ ë§í¬</a>ë¥¼ í†µí•´ í™•ì¸ ê°€ëŠ¥í•˜ì‹­ë‹ˆë‹¤.</p><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>Reference</strong></p><ul><li><a href="https://go.dev/doc/code">https://go.dev/doc/code</a></li><li><a href="https://www.ardanlabs.com/blog/2017/02/package-oriented-design.html">https://www.ardanlabs.com/blog/2017/02/package-oriented-design.html</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/Go/">Go</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/go-project-layout/">go project layout</category>
      
      <category domain="https://chelseafandev.github.io/tags/golang-layout/">golang layout</category>
      
      <category domain="https://chelseafandev.github.io/tags/how-to-write-go-code/">how to write go code</category>
      
      
      <comments>https://chelseafandev.github.io/2024/07/28/my-golang-layout/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>boost strandë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ </title>
      <link>https://chelseafandev.github.io/2023/09/12/what-is-strand/</link>
      <guid>https://chelseafandev.github.io/2023/09/12/what-is-strand/</guid>
      <pubDate>Tue, 12 Sep 2023 08:03:48 GMT</pubDate>
      
      <description>&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” boostì—ì„œ ì œê³µí•˜ëŠ” strandì— ëŒ€í•´ ì•Œì•„ë³´ëŠ” ì‹œê°„ì„ ê°–ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” boostì—ì„œ ì œê³µí•˜ëŠ” strandì— ëŒ€í•´ ì•Œì•„ë³´ëŠ” ì‹œê°„ì„ ê°–ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><span id="more"></span><p>strandì— ëŒ€í•œ ì„¤ëª…ì€ <a href="https://www.crazygaze.com/blog/2016/03/17/how-strands-work-and-why-you-should-use-them/">How strands work and why you should use them</a> ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë‹ˆ ì°¸ê³ ë¶€íƒë“œë¦¬ë©°, ê¸€ í•˜ë‹¨ì—ëŠ” strand ë™ì‘ì„ ê²€ì¦í•˜ê¸° ìœ„í•œ ì˜ˆì œ ì½”ë“œë¥¼ ì²¨ë¶€í•˜ì˜€ìœ¼ë‹ˆ ì§ì ‘ í…ŒìŠ¤íŠ¸ í•´ë³´ì‹œë©° strandì˜ ì‚¬ìš©ë²•ê³¼ í•„ìš”ì„±ì— ëŒ€í•´ ë‹¤ì‹œ í•œë²ˆ ì •ë¦¬í•˜ëŠ” ì‹œê°„ì„ ê°–ìœ¼ë©´ ì¢‹ì„ê²ƒê°™ë„¤ìš”ğŸ˜</p><br><!-- toc --><br><h2 id="How-strands-work-and-why-you-should-use-them"><a href="#How-strands-work-and-why-you-should-use-them" class="headerlink" title="How strands work and why you should use them"></a>How strands work and why you should use them</h2><p>ë§Œì•½ ì—¬ëŸ¬ë¶„ì´ Boost Asioë¥¼ ì‚¬ìš©í•´ë³¸ì ì´ ìˆë‹¤ë©´, í‹€ë¦¼ì—†ì´ <a href="https://www.boost.org/doc/libs/1_83_0/doc/html/boost_asio/overview/core/strands.html">strands</a> ë¼ëŠ” ê²ƒì„ ì‚¬ìš©í•´ë´¤ê±°ë‚˜ ìµœì†Œí•œ ë§ˆì£¼ì¹˜ê¸°ë¼ë„ í•´ë´¤ì„ ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>If you ever used Boost Asio, certainly you used or at least looked at <a href="https://www.boost.org/doc/libs/1_83_0/doc/html/boost_asio/overview/core/strands.html">strands</a>.</p></blockquote><p>strands ì‚¬ìš©ì„ í†µí•´ ì–»ì„ ìˆ˜ ìˆëŠ” ì£¼ìš”í•œ ì´ì ì€ ì—¬ëŸ¬ë¶„ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë‹¨ìˆœí™”í•´ì¤€ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ë‹¨ìˆœí™”ëŠ” strandë¥¼ í†µí•´ ì‹¤í–‰ë˜ëŠ” í•¸ë“¤ëŸ¬ì— ëŒ€í•´ì„œëŠ” ëª…ì‹œì ì¸ ë™ê¸°í™”ê°€ í•„ìš”í•˜ì§€ ì•Šê¸°ë•Œë¬¸ì— ê°€ëŠ¥í•©ë‹ˆë‹¤. strandëŠ” 2ê°œì˜ í•¸ë“¤ëŸ¬ê°€ ë™ì‹œì— ì‹¤í–‰ë˜ì§€ì•ŠìŒì„ ë³´ì¥í•©ë‹ˆë‹¤.</p><blockquote><p>The main benefit of using strands is to simplify your code, since handlers that go through a strand donâ€™t need explicit synchronization. A strand guarantees that no two handlers execute concurrently.</p></blockquote><p>ë§Œì•½ ì—¬ëŸ¬ë¶„ì´ ë‹¨ì§€ í•˜ë‚˜ì˜ I/O ì“°ë ˆë“œ(boost ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¸¡ë©´ì—ì„œ ì„¤ëª…í•˜ìë©´ io_context::run()ì„ í˜¸ì¶œí•˜ëŠ” ì“°ë ˆë“œê°€ ì˜¤ì§ í•˜ë‚˜ì¸ ê²½ìš°ë¥¼ ì˜ë¯¸í•¨)ë¥¼ ì‚¬ìš©í•œë‹¤ë©´, ë™ê¸°í™”ë¥¼ ê±±ì •í•  í•„ìš”ê°€ ì „í˜€ ì—†ìŠµë‹ˆë‹¤. ê·¸ê²ƒì´ ì´ë¯¸ ì•”ë¬µì ì¸ strandì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì—¬ëŸ¬ë¶„ì´ ë” ë§ì€ I/O ì“°ë ˆë“œë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ìˆœê°„ì´ ì˜¨ë‹¤ë©´ I/O ì“°ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” í•¸ë“¤ëŸ¬ì— ëŒ€í•´ ëª…ì‹œì ì¸ ë™ê¸°í™” ì²˜ë¦¬ë¥¼ í•˜ê±°ë‚˜ strandsë¥¼ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.</p><blockquote><p>If you use just one I/O thread (or in Boost terms, just one thread calling io_context::run), then you donâ€™t need synchronization anyway. That is already an implicit strand. But the moment you want to ramp up and have more I/O threads, you need to either deal with explicit synchronization for your handlers, or use strands.</p></blockquote><p>ì—¬ëŸ¬ë¶„ì´ ì •ì˜í•œ í•¸ë“¤ëŸ¬ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë™ê¸°í™”í•˜ëŠ” ê²ƒì€ ëª…ë°±íˆ ê°€ëŠ¥í•œ ì¼ì´ì§€ë§Œ ì´ê²ƒì€ ë¶ˆí•„ìš”í•˜ê²Œ ì—¬ëŸ¬ë¶„ì˜ ì†ŒìŠ¤ ì½”ë“œì— ë³µì¡ì„±ì„ ë¶€ì—¬í•˜ì—¬ ë²„ê·¸ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. í•¸ë“¤ëŸ¬ì˜ ëª…ì‹œì  ë™ê¸°í™”ê°€ ê°–ëŠ” ë˜ ë‹¤ë¥¸ ì˜í–¥ë„ ì¤‘ í•˜ë‚˜ëŠ” ì—¬ëŸ¬ë¶„ì´ ì •ë§ ì‹ ì¤‘í•˜ê²Œ ê³ ë ¤í•˜ì§€ ì•ŠëŠ” ì´ìƒ ë¶ˆí•„ìš”í•œ ë¸”ë¡ êµ¬ê°„ì˜ ë°œìƒì´ ë¶ˆê°€í”¼í•˜ë‹¤ëŠ” ì ì…ë‹ˆë‹¤.</p><blockquote><p>Explicitly synchronizing your handlers is certainly possible, but you will be unnecessarily introducing complexity to your code which will certainly lead to bugs. One other effect of explicit handler synchronization is that unless you think really hard, youâ€™ll very likely introduce unnecessary blocking.</p></blockquote><p>strandsëŠ” ì—¬ëŸ¬ë¶„ì˜ ì†ŒìŠ¤ ì½”ë“œì™€ í•¸ë“¤ëŸ¬ì˜ ì‹¤í–‰ ì‚¬ì´ì— ë˜ ë‹¤ë¥¸ ê³„ì¸µì„ í•˜ë‚˜ ë‘ ìœ¼ë¡œì¨ ë™ì‘í•©ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì˜ í•¸ë“¤ëŸ¬ë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” worker ì“°ë ˆë“œë“¤ì„ ê°–ëŠ” ëŒ€ì‹ ì—, ì´ëŸ¬í•œ í•¸ë“¤ëŸ¬ë“¤ì´ strand ë‚´ì˜ íì— ì €ì¥ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³ ë‚˜ì„œ strandëŠ” ëª¨ë“  ì¡°ê±´ì´ ì¶©ì¡±ë˜ì—ˆì„ ë•Œì—ë§Œ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•˜ëŠ” ì œì–´ ê¶Œí•œì„ ê°–ê²Œë©ë‹ˆë‹¤.</p><blockquote><p>Strands work by introducing another layer between your application code and the handler execution. Instead of having the worker threads directly execute your handlers, those handlers are queued in a strand. The strand then has control over when executing the handlers so that all guarantees can be met.</p></blockquote><p>ì´ê²ƒì— ëŒ€í•´ ìƒê°í•´ë³¼ ìˆ˜ ìˆëŠ” í•œê°€ì§€ ë°©ë²•ì€ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ìŠµë‹ˆë‹¤.</p><blockquote><p>One way you can think about is like this:</p></blockquote><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/what-is-strand-figure-1.png" alt=""></div><h3 id="Possible-scenario"><a href="#Possible-scenario" class="headerlink" title="Possible scenario"></a>Possible scenario</h3><p>I/O ì“°ë ˆë“œì™€ í•¸ë“¤ëŸ¬ì— ì–´ë–¤ ì¼ì´ ë°œìƒí•˜ëŠ”ì§€ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ <a href="https://github.com/Celtoys/Remotery">Remotry</a>ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p><blockquote><p>To visually demonstrate what happens with the I/O threads and handlers, Iâ€™ve used <a href="https://github.com/Celtoys/Remotery">Remotery</a>.</p></blockquote><p>ì‚¬ìš©ë˜ëŠ” ì½”ë“œëŠ” 4ê°œì˜ worker ì“°ë ˆë“œì™€ 8ê°œì˜ connectionì„ ì—ë®¬ë ˆì´íŠ¸í•©ë‹ˆë‹¤. 5ms ~ 15ms ì‚¬ì´ì˜ ì„ì˜ì˜ ì‘ì—…ëŸ‰ì„ ê°–ëŠ” í•¸ë“¤ëŸ¬(ì¼ì¢…ì˜ ì‘ì—… í•­ëª©)ëŠ” worker íì— ë†“ì´ê²Œë©ë‹ˆë‹¤. ì‹¤ì œë¡œ ì—¬ëŸ¬ë¶„ì´ ì´ëŸ¬í•œ ì»¤ë„¥ì…˜ë³„ ì“°ë ˆë“œë¹„ìœ¨ ë˜ëŠ” í•¸ë“¤ëŸ¬ ì‘ì—…ëŸ‰ì„ ê°–ì§€ì•Šë”ë¼ë„ í•´ë‹¹ ìˆ˜ì¹˜ë“¤ì€ ë¬¸ì œë¥¼ ë³´ì—¬ì£¼ê¸°ì— ìš©ì´í•©ë‹ˆë‹¤. ë˜í•œ ì €ëŠ” Boost Asio ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ê³ , í•´ë‹¹ ê¸€ì˜ ì£¼ì œë¥¼ ë…¼ì˜í•´ë‚˜ê°€ê¸° ìœ„í•´ ìì²´ì ìœ¼ë¡œ strandë¥¼ êµ¬í˜„í•´ë³´ì•˜ìŠµë‹ˆë‹¤.</p><blockquote><p>The code used emulates 4 worker threads, and 8 connections. Handlers (aka work items) with a random workload of [5ms,15ms] for a random connection are placed in the worker queue. In practice, you would not have this threads/connections ratio or handler workload, but it makes it easier to demonstrate the problem. Also, Iâ€™m not using Boost Asio at all. Itâ€™s a custom strand implementation to explore the topic.</p></blockquote><p>ì•„ë˜ ê·¸ë¦¼ì€ worker ì“°ë ˆë“œë“¤ì˜ ìƒíƒœë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤:</p><blockquote><p>So, a view into the worker threads:</p></blockquote><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/what-is-strand-figure-2.png" alt=""></div><p><code>Conn N</code>ì€ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤(ë˜ëŠ” worker ì“°ë ˆë“œ ìƒì—ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì–´ë– í•œ ê°ì²´). ê°ê°ì˜ ì»¤ë„¥ì…˜ ê°ì²´ëŠ” ì„œë¡œ ë‹¤ë¥¸ ìƒ‰ìƒì„ ê°–ê³ ìˆìŠµë‹ˆë‹¤. ë³´ì‹œë‹¤ì‹œí”¼ ê²‰ë³´ê¸°ì—ëŠ” ê´œì°®ì•„ ë³´ì…ë‹ˆë‹¤. ì´ì œ ê°ê°ì˜ Conn ê°ì²´ì˜ ì‹¤ì§ì ì¸ ìƒíƒœë¥¼ ì‹œë¶„í•  ë‹¨ìœ„ë¡œ ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><blockquote><p>Conn N are our connection objects (or any object doing work in our worker threads for that matter). Each has a distinct colour. All good on the surface as you can see. Now lets look at what each Conn object is actually doing with its time slice.</p></blockquote><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/what-is-strand-figure-3.png" alt=""></div><p>worker íì™€ ì“°ë ˆë“œëŠ” í•¸ë“¤ëŸ¬ê°€ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…ì„ ì¸ì§€í•˜ì§€ ëª»í•˜ê¸°ë•Œë¬¸ì—ì„œ worker ì“°ë ˆë“œëŠ” ì²˜ë¦¬í•  ì»¤ë„¥ì…˜ ê°ì²´ê°€ ë“¤ì–´ì˜¤ëŠ” ìˆœê°„ ê¸°êº¼ì´ íì—ì„œ êº¼ë‚´ë ¤ í•  ê²ƒì…ë‹ˆë‹¤. í•˜ë‚˜ì˜ ì“°ë ˆë“œì—ì„œ ë˜ ë‹¤ë¥¸ worker ì“°ë ˆë“œì—ì„œ ì´ë¯¸ ì‚¬ìš©ë˜ê³  ìˆëŠ” ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ì‹¤í–‰í•˜ë ¤ê³  í•  ë•Œ, ê·¸ê²ƒì€ block ìƒíƒœì— ë†“ì´ê²Œë  ê²ƒì…ë‹ˆë‹¤. í˜„ì¬ì˜ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ì „ì²´ ì‹œê°„ì˜ ì•½ 19% ì •ë„ê°€ block ìƒíƒœ ë˜ëŠ” ë˜ ë‹¤ë¥¸ ì˜¤ë²„ í—¤ë“œë¡œ ì¸í•´ ë‚­ë¹„ë˜ê³  ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§í•´, ì‹¤ì§ˆì ìœ¼ë¡œ worker ì“°ë ˆë“œê°€ ì‘ì—…ì— í• ë‹¹í•˜ëŠ” ì‹œê°„ì´ ì „ì²´ì˜ ì•½ 81% ë¿ì´ë¼ëŠ” ê²ƒì…ë‹ˆë‹¤:</p><blockquote><p>What is happening is the worker queue and worker threads are oblivious to what its handlers do (as expected), so the worker threads will happily dequeue work as it comes. One thread tries to execute work for a given Conn object which is already being used in another worker thread, so it has to block. In this scenario, ~19% of total time is wasted with blocking or other overhead. In other words, only ~81% of the worker threadâ€™s time is spent doing actual work:</p></blockquote><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/what-is-strand-figure-4.png" alt=""></div><p>ì˜¤ë²„ í—¤ë“œëŠ” worker ì“°ë ˆë“œ ì „ì²´ ì‹œê°„ì—ì„œ ì‹¤ì œ ì‘ì—… ì‹œê°„ì„ ëº€ ê°’ìœ¼ë¡œ ì¸¡ì •ë©ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— í•¸ë“¤ëŸ¬ ë‚´ì˜ ëª…ì‹œì ì¸ ë™ê¸°í™” ê·¸ë¦¬ê³  worker í/ì“°ë ˆë“œ ë‚´ë¶€ì ìœ¼ë¡œ ìˆ˜í–‰ëœ ëª¨ë“  ë™ê¸°í™” ì‘ì—…ë“¤ì´ ì´ ì˜¤ë²„ í—¤ë“œì— í¬í•¨ë©ë‹ˆë‹¤.</p><blockquote><p>NOTE: The overhead was measured by subtracting actual work time from the total worker threadâ€™s time. So it accounts for explicit synchronization in the handlers and any work/synchronization done internally by the worker queue/threads.</p></blockquote><p>ì´ì œ ì»¤ë„¥ì…˜ ê°ì²´ì˜ ì‘ì—…ì„ ë™ê¸°í™”í•˜ê¸° ìœ„í•´ strandsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì˜ ìƒíƒœ ê°’ì„ ì‚´í´ë´…ì‹œë‹¤.</p><blockquote><p>Lets see how it looks like if we use strands to serialize work for our Conn objects:</p></blockquote><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/what-is-strand-figure-5.png" alt=""></div><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/what-is-strand-figure-6.png" alt=""></div><p>ë‚´ë¶€ ì‘ì—… ë˜ëŠ” ë™ê¸°í™”ì— ë‚­ë¹„ë˜ëŠ” ì‹œê°„ì´ ë§¤ìš° ì‘ë‹¤ëŠ”ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Very little time is wasted with internal work or synchronization.</p></blockquote><br><h3 id="Cache-locality"><a href="#Cache-locality" class="headerlink" title="Cache locality"></a>Cache locality</h3><p>strandsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì— ì–»ì„ ìˆ˜ ìˆëŠ” ë˜ í•˜ë‚˜ì˜ ì‘ì€ ì´ì ì€ ë” ë‚˜ì€ CPU ìºì‹œ í™œìš©ì…ë‹ˆë‹¤. worker ì“°ë ˆë“œëŠ” ë˜ ë‹¤ë¥¸ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ê°€ì§€ê³  ì˜¤ê¸° ì „ì— í˜„ì¬ ì£¼ì–´ì§„ ì»¤ë„¥ì…˜ ê°ì²´ì˜ í•¸ë“¤ëŸ¬ë¥¼ ë” ë§ì´ ì‹¤í–‰í•˜ë ¤ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Another possible small benefit with this scenario is better CPU cache utilization. Worker threads will tend to execute a few handlers for a given Conn object before grabbing another Conn object.</p></blockquote><p>Zoomed out, without strands</p><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/what-is-strand-figure-7.png" alt=""></div><p>Zoomed out, with strands<br>(ê°ê°ì˜ ì“°ë ˆë“œì— ë”°ë¼ ë™ì¼í•œ ë²ˆí˜¸ì˜ ì»¤ë„¥ì…˜ ê°ì²´ì˜ ì‘ì—… ìˆ˜í–‰ì´ ë°€ì§‘ë˜ì–´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŒ)</p><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/what-is-strand-figure-8.png" alt=""></div><br><h2 id="ì˜ˆì œ-ì½”ë“œ"><a href="#ì˜ˆì œ-ì½”ë“œ" class="headerlink" title="ì˜ˆì œ ì½”ë“œ"></a>ì˜ˆì œ ì½”ë“œ</h2><p>ì‹¤ì œ ì˜ˆì œ ì½”ë“œë¥¼ í†µí•´ì„œ strandì˜ ì‚¬ìš©ë²•ì„ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì•„ë˜ ì˜ˆì œëŠ” Nê°œ(1, 2, 4, 8, 16)ì˜ ì“°ë ˆë“œì—ì„œ ê°ê° ì „ì—­ ë³€ìˆ˜ì¸ sumì— 2ì”© ë”í•˜ëŠ” ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë©°, sumì˜ ëˆ„ì  í•©ì´ 1ì–µì´ ì¶œë ¥ë˜ëŠ”ì§€ë¥¼ í™•ì¸í•˜ê³ ì í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.<br>ì“°ë ˆë“œê°€ 1ê°œ(N=1)ì¸ ìƒí™©ì—ì„œ sumì´ 1ì–µì´ ë˜ê¸°ìœ„í•´ì„œëŠ” 2ì”© ë”í•˜ëŠ” ì—°ì‚°ì´ ì´ 50000000ë²ˆ ë°˜ë³µë¼ì•¼í•˜ë©° ì“°ë ˆë“œë¥¼ 16ê°œ(N=16)ê¹Œì§€ ëŠ˜ë¦°ë‹¤ë©´ í•´ë‹¹ ì—°ì‚°ì€ 3125000ë²ˆ ë°˜ë³µë˜ë©´ ë©ë‹ˆë‹¤.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/asio.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/thread.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/thread/detail/thread_group.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">thread_func</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">thread_func</span>(<span class="keyword">int</span> idx, boost::asio::io_context&amp; ctx) : <span class="built_in">idx_</span>(idx), <span class="built_in">ctx_</span>(ctx)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::ostringstream oss;</span><br><span class="line">        oss &lt;&lt; std::this_thread::<span class="built_in">get_id</span>();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;io_context::run #%d thread [%s]\n&quot;</span>, idx_, oss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">        ctx_.<span class="built_in">run</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> idx_;</span><br><span class="line">    boost::asio::io_context&amp; ctx_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">make_sum_to_100_million_without_strand</span><span class="params">(<span class="keyword">int</span> thread_count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    boost::asio::io_context ctx;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> loop_count = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span> (thread_count)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        loop_count = <span class="number">50000000</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        loop_count = <span class="number">25000000</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        loop_count = <span class="number">12500000</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        loop_count = <span class="number">6250000</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">        loop_count = <span class="number">3125000</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// no strand</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; thread_count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        boost::asio::<span class="built_in">post</span>(ctx, [&amp;]()&#123;</span><br><span class="line">            std::ostringstream oss;</span><br><span class="line">            oss &lt;&lt; std::this_thread::<span class="built_in">get_id</span>();</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;hello boost::asio::post in io_context [%s]\n&quot;</span>, oss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loop_count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                sum += <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    boost::thread_group tg;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; thread_count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        tg.<span class="built_in">create_thread</span>(<span class="built_in">thread_func</span>(i+<span class="number">1</span>, ctx));</span><br><span class="line">    &#125;</span><br><span class="line">    tg.<span class="built_in">join_all</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[make_sum_to_100_million_without_strand, %d thread] sum : %d\n&quot;</span>, thread_count, sum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> thread_count = <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">make_sum_to_100_million_without_strand</span>(thread_count)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì‹¤í–‰ê²°ê³¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[make_sum_to_100_million_without_strand, 2 thread] sum : 50614948</span><br></pre></td></tr></table></figure><p>(ìœ„ ì˜ˆì‹œì˜ ê²½ìš°ì—ëŠ” 2ê°œì˜ ì“°ë ˆë“œì—ì„œ)í•¸ë“¤ëŸ¬ ë™ê¸°í™”ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” 1ì–µì´ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥ë˜ì§€ ì•ŠìŒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ì“°ë ˆë“œì—ì„œ ë™ì‹œì— ì ‘ê·¼í•˜ëŠ” ë³€ìˆ˜ì— ëŒ€í•œ ëª…ì‹œì ì¸ ë™ê¸°í™” ì²˜ë¦¬ë¥¼ í•´ì£¼ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë‹¹ì—°í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/asio.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/thread.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/thread/detail/thread_group.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">thread_func</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">thread_func</span>(<span class="keyword">int</span> idx, boost::asio::io_context&amp; ctx) : <span class="built_in">idx_</span>(idx), <span class="built_in">ctx_</span>(ctx)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::ostringstream oss;</span><br><span class="line">        oss &lt;&lt; std::this_thread::<span class="built_in">get_id</span>();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;io_context::run #%d thread [%s]\n&quot;</span>, idx_, oss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">        ctx_.<span class="built_in">run</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> idx_;</span><br><span class="line">    boost::asio::io_context&amp; ctx_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">make_sum_to_100_million_with_strand</span><span class="params">(<span class="keyword">int</span> thread_count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    boost::asio::io_context ctx;</span><br><span class="line">    boost::asio::<span class="function">io_context::strand <span class="title">strand</span><span class="params">(ctx)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> loop_count = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span> (thread_count)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        loop_count = <span class="number">50000000</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        loop_count = <span class="number">25000000</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        loop_count = <span class="number">12500000</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        loop_count = <span class="number">6250000</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">        loop_count = <span class="number">3125000</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// strand</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; thread_count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        boost::asio::<span class="built_in">post</span>(strand.<span class="built_in">wrap</span>([&amp;]()&#123;</span><br><span class="line">            std::ostringstream oss;</span><br><span class="line">            oss &lt;&lt; std::this_thread::<span class="built_in">get_id</span>();</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;hello boost::asio::post in io_context [%s]\n&quot;</span>, oss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loop_count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                sum += <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    boost::thread_group tg;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; thread_count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        tg.<span class="built_in">create_thread</span>(<span class="built_in">thread_func</span>(i+<span class="number">1</span>, ctx));</span><br><span class="line">    &#125;</span><br><span class="line">    tg.<span class="built_in">join_all</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[make_sum_to_100_million_with_strand, %d thread] sum : %d\n&quot;</span>, thread_count, sum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> thread_count = <span class="number">16</span>;</span><br><span class="line">    <span class="built_in">make_sum_to_100_million_with_strand</span>(thread_count);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì‹¤í–‰ê²°ê³¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[make_sum_to_100_million_with_strand, 16 thread] sum : 100000000</span><br></pre></td></tr></table></figure><p>(ìœ„ ì˜ˆì‹œì˜ ê²½ìš°ì—ëŠ” 16ê°œì˜ ì“°ë ˆë“œì—ì„œ) boost strandë¥¼ ì‚¬ìš©í•˜ì—¬ í•¸ë“¤ëŸ¬ ë™ê¸°í™”ë¥¼ ìˆ˜í–‰(ì „ì—­ ë³€ìˆ˜ì¸ sumì— ì ‘ê·¼í•˜ëŠ” í•¸ë“¤ëŸ¬ê°€ ë™ì‹œì— ì‹¤í–‰ë˜ì§€ ì•ŠìŒì„ ë³´ì¥)í•˜ì˜€ê¸°ë•Œë¬¸ì— 1ì–µì´ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><br><h2 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h2><ul><li>I/O threadê°€ 1ê°œì¸ ê²½ìš°(ì¦‰, io_context::run() í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ” ì“°ë ˆë“œê°€ 1ê°œì¸ ê²½ìš°)ì—ëŠ” ì˜¤ì§ í•˜ë‚˜ì˜ ì“°ë ˆë“œì—ì„œë§Œ í•¸ë“¤ëŸ¬ê°€ í˜¸ì¶œë˜ë¯€ë¡œ ë™ê¸°í™”ë¼ëŠ”ê²Œ í•„ìš”ì—†ìŒ.</li><li>2ê°œ ì´ìƒì˜ I/O thread(ì¦‰, io_context::run() í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ” ì“°ë ˆë“œê°€ 2ê°œ ì´ìƒì¸ ê²½ìš°)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” í•¸ë“¤ëŸ¬ë¥¼ ë™ê¸°í™”í•˜ê¸° ìœ„í•´ ëª…ì‹œì ì¸ Lockì´ í•„ìš”í•¨.</li><li>ì´ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ê²Œ boost::asio::strand! í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ ë™ê¸°í™”ë¥¼ ìœ„í•œ ì‘ì—…ì„ ë”°ë¡œ í•´ì¤„í•„ìš”ê°€ ì—†ë‹¤!</li></ul><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>Reference</strong></p><ul><li><a href="https://www.crazygaze.com/blog/2016/03/17/how-strands-work-and-why-you-should-use-them/">https://www.crazygaze.com/blog/2016/03/17/how-strands-work-and-why-you-should-use-them/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/C/">C++</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/strands/">strands</category>
      
      <category domain="https://chelseafandev.github.io/tags/boost-strand/">boost strand</category>
      
      <category domain="https://chelseafandev.github.io/tags/synchronization/">synchronization</category>
      
      <category domain="https://chelseafandev.github.io/tags/handler-sync/">handler sync</category>
      
      
      <comments>https://chelseafandev.github.io/2023/09/12/what-is-strand/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>boost::io_context ì‹¤í–‰ ëª¨ë¸ì— ëŒ€í•´ ì•Œì•„ë³´ì</title>
      <link>https://chelseafandev.github.io/2023/05/19/multithreaded-execution/</link>
      <guid>https://chelseafandev.github.io/2023/05/19/multithreaded-execution/</guid>
      <pubDate>Fri, 19 May 2023 02:32:32 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;em&gt;&lt;strong&gt;ë­í•˜ëŠ” ë†ˆì¸ì§€ëŠ” ì•Œê³  ì“°ì&lt;/strong&gt;&lt;/em&gt; ì‹œë¦¬ì¦ˆì˜ ë„¤ë²ˆì§¸ ì£¼ì œëŠ” &lt;code&gt;boost io_context ì‹¤í–‰ ëª¨ë¸&lt;/code&gt;ì…ë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><em><strong>ë­í•˜ëŠ” ë†ˆì¸ì§€ëŠ” ì•Œê³  ì“°ì</strong></em> ì‹œë¦¬ì¦ˆì˜ ë„¤ë²ˆì§¸ ì£¼ì œëŠ” <code>boost io_context ì‹¤í–‰ ëª¨ë¸</code>ì…ë‹ˆë‹¤.</p><span id="more"></span><p><a href="https://dens.website/tutorials/cpp-asio/multithreading">execution model where you launch N threads for the sameÂ io_contextÂ class instance.</a>ì™€ <a href="https://dens.website/tutorials/cpp-asio/multithreading-2">execution model where you create N pairs of â€œ1Â io_contextÂ + 1 threadâ€</a>ì— í¬ìŠ¤íŒ…ëœ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë‹ˆ ì°¸ê³ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</p><br><!-- toc --><br><h2 id="Nê°œì˜-ì“°ë ˆë“œì—ì„œ-1ê°œì˜-io-contextë¥¼-ì‚¬ìš©í•˜ëŠ”-ì‹¤í–‰-ëª¨ë¸"><a href="#Nê°œì˜-ì“°ë ˆë“œì—ì„œ-1ê°œì˜-io-contextë¥¼-ì‚¬ìš©í•˜ëŠ”-ì‹¤í–‰-ëª¨ë¸" class="headerlink" title="Nê°œì˜ ì“°ë ˆë“œì—ì„œ 1ê°œì˜ io_contextë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹¤í–‰ ëª¨ë¸"></a>Nê°œì˜ ì“°ë ˆë“œì—ì„œ 1ê°œì˜ io_contextë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹¤í–‰ ëª¨ë¸</h2><p>ë©€í‹° ì“°ë ˆë“œ ì ‘ê·¼ ë°©ì‹ì— ë›°ì–´ë“¤ê¸° ìœ„í•œ ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ ê°ê°ì˜ ì“°ë ˆë“œë“¤ì—ì„œ ë™ì¼í•œ io_context ê°ì²´ì— ëŒ€í•´ì„œ io_context::run ë©¤ë²„ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>The simplest way to jump into a multithreaded approach is to run io_context::run member function on multiple threads with the same io_context object.</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BOOST_ASIO_NO_DEPRECATED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/asio.hpp&gt;</span></span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">io::io_context io_context;</span><br><span class="line"><span class="comment">// Prepare things</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; threads;</span><br><span class="line"><span class="keyword">auto</span> count = <span class="built_in">std</span>::thread::hardware_concurrency() * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> n = <span class="number">0</span>; n &lt; count; ++n)</span><br><span class="line">{</span><br><span class="line">    threads.emplace_back([&amp;]</span><br><span class="line">    {</span><br><span class="line">        io_context.run();</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span>&amp; thread : threads)</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span>(thread.joinable())</span><br><span class="line">    {</span><br><span class="line">        thread.join();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ì´ ê²½ìš°ì— io_contextëŠ” í´ë˜ì‹í•œ ì“°ë ˆë“œ í’€ê³¼ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤. ë¹„ë™ê¸° ì‘ì—…ë“¤ì€ OS ì¸¡ë©´ì˜ ì–´ë”˜ê°€ì—ì„œ ìˆ˜í–‰ë˜ì§€ë§Œ ì™„ë£Œ í•¸ë“¤ëŸ¬ëŠ” io_context::run í•¨ìˆ˜ê°€ ì‹¤í–‰ì¤‘ì¸ ì“°ë ˆë“œë“¤ì—ì„œ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤. ì¢€ ë” ì •í™•íˆ ë§í•˜ìë©´: ëª¨ë“  ì™„ë£Œ í•¸ë“¤ëŸ¬ëŠ” io_context::run í•¨ìˆ˜ê°€ ì‹¤í–‰ ì¤‘ì¸ ìµœì´ˆì˜ ìœ íœ´ ìƒíƒœ ì“°ë ˆë“œì—ì„œ ë°œìƒí•©ë‹ˆë‹¤.</p><blockquote><p>In that case io_context operates like a classic thread pool. Asynchronous tasks are performed somewhere on the OS side, however completion handlers are invoked on those threads where io_context::run function is running. To be more precise: every completion handler is invoked on a first free thread which io_context::run function is running on.</p></blockquote><p>ì´ê²ƒì€ ì™„ë£Œ í•¸ë“¤ëŸ¬ê°€ ë³‘ë ¬ì ìœ¼ë¡œ ì‹¤í–‰ë  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ê²ƒì€ ìš°ë¦¬ê°€ ë™ê¸°í™”ê°€ í•„ìš”í•œ ì§€ì ì— ë„ë‹¬í–ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ê¸°ë„ í•©ë‹ˆë‹¤.</p><blockquote><p>It means that completion handlers could run in parallel. And this is, in turn, mean that weâ€™ve reached a point where we need some synchronization.</p></blockquote><p>ë©€í‹°ì“°ë ˆë“œ í™˜ê²½ì—ì„œ ì—¬ëŸ¬ë¶„ì´ ë™ê¸°í™”ì— ëŒ€í•´ ì‹ ê²½ì¨ì•¼í•˜ëŠ” ë¶€ë¶„ë“¤ì„ ì¤„ì¼ ìˆ˜ë¡ ë” ì¢‹ì„ ê²ƒì…ë‹ˆë‹¤. ì¢‹ì€ ì†Œì‹ì€ Boost.Asioë¥¼ í™œìš©í•œ ë©€í‹°ì“°ë ˆë“œ í™˜ê²½ì—ì„œëŠ” ë™ê¸°í™”ë¥¼ ìœ„í•´ ë®¤í…ìŠ¤ ë˜ëŠ” ì„¸ë§ˆí¬ì–´ì™€ ê°™ì€ ì—£ì§€ ë¡œìš° ë ˆë²¨ ë™ê¸°í™” íˆ´ë“¤ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>The less you have to care about synchronization in a multithreaded environment â€” the better. The good news is that we donâ€™t need such edgy low-level synchronization tools like mutexes or semaphores to get things synchronized in the Boost.Asio multithreaded environment.</p></blockquote><p>ì—¬ëŸ¬ë¶„ì˜ ì™„ë£Œ í•¸ë“¤ëŸ¬ë¥¼ ì ì ˆí•˜ê²Œ ë™ê¸°í™”í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê²ƒì€ io_context::strand í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¿ì…ë‹ˆë‹¤. ê·¸ê²ƒì€ ê½¤ ë‹¨ìˆœí•˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤: ë™ì¼í•œ io_context::strandì— í• ë‹¹ëœ ì™„ë£Œ í•¸ë“¤ëŸ¬ëŠ” ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë  ê²ƒì…ë‹ˆë‹¤. ê·¸ê²ƒë“¤ì€ ì„œë¡œ ë‹¤ë¥¸ ì“°ë ˆë“œë“¤ì—ì„œ ì‹¤í–‰ë˜ì§€ë§Œ, ê·¸ê²ƒë“¤ì˜ ì‹¤í–‰ì€ ìˆœì°¨ì ì´ê²Œ ë  ê²ƒì…ë‹ˆë‹¤. ì´ê²ƒì€ ê·¸ê²ƒë“¤ì´ ë³‘ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì§€ ì•Šì„ê²ƒì´ë©° ì—¬ëŸ¬ë¶„ì´ ë™ê¸°í™” ì²˜ë¦¬ë¥¼ í•´ì¤„ í•„ìš”ê°€ ì—†ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p><blockquote><p>The only thing you need to get your completion handlers synchronized properly is io_context::strand class instance. It works pretty simple: completion handlers attached to the same io_context::strand will be invoked serially. They could be invoked from different threads, however those invocations will be serialized. This means that things wonâ€™t go in parallel and you donâ€™t have to deal with synchronization.</p></blockquote><p>ë”°ë¼ì„œ ì—¬ëŸ¬ë¶„ì´ í•´ì•¼ í•  ì¼ì€ ê³µìœ  ë°ì´í„°ì—ì„œ ì‘ë™í•˜ëŠ” ì™„ë£Œ í•¸ë“¤ëŸ¬ì™€ ë™ì¼í•œ io_context::strandì— ì—°ê²°ë˜ì–´ì•¼ í•˜ëŠ” ì™„ë£Œ í•¸ë“¤ëŸ¬, ê·¸ë¦¬ê³  ì´ë“¤ ì¤‘ ì–´ëŠ ê²ƒì´ ë…ë¦½ì ì´ê³  ë³‘ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ê²°ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì€ ì™„ë£Œ í•¸ë“¤ëŸ¬ë¥¼ strandë¡œ ê°ì‹¸ê¸°ìœ„í•´ boost::asio::bind_executor í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤. ì˜ˆì œë¥¼ ì‚´í´ë´…ì‹œë‹¤. ìš°ë¦¬ì˜ io_context::run í•¨ìˆ˜ê°€ ë©€í‹° ì“°ë ˆë“œ í™˜ê²½ì—ì„œ ì‹¤í–‰ì¤‘ì´ë¼ê³  ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><blockquote><p>So, everything you need to do is to decide which completion handlers operate on a shared data and should be attached to the same io_context::strand, and which of them are independent and can go in parallel. You should use boost::asio::bind_executor function to wrap a completion handler into a strand. Letâ€™s look at the example. Assume that our io_context::run is running on multiple threads:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">session</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    session(io::io_context&amp; io_context)</span><br><span class="line">    : socket(io_context)</span><br><span class="line">    , read  (io_context)</span><br><span class="line">    , write (io_context)</span><br><span class="line">    {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">async_read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        io::async_read(socket, read_buffer, io::bind_executor(read, [&amp;] (error_code error, <span class="built_in">std</span>::<span class="keyword">size_t</span> bytes_transferred)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(!error)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">                async_read();</span><br><span class="line">            }</span><br><span class="line">        }));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">async_write</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        io::async_read(socket, write_buffer, io::bind_executor(write, [&amp;] (error_code error, <span class="built_in">std</span>::<span class="keyword">size_t</span> bytes_transferred)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(!error)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">                async_write();</span><br><span class="line">            }</span><br><span class="line">        }));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">    tcp::socket socket;</span><br><span class="line">    io::io_context::strand read;</span><br><span class="line">    io::io_context::strand write;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ìœ„ì˜ ì˜ˆì œì—ì„œ ìš°ë¦¬ëŠ” 2ê°œì˜ strandë¥¼ ì‚¬ìš©í–ˆëŠ”ë° í•˜ë‚˜ëŠ” read ì—°ì‚°ì„ ë‹¤ë¥¸ í•˜ë‚˜ëŠ” write ì—°ì‚°ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. ì´ê²ƒì€ read ì™„ë£Œ í•¸ë“¤ëŸ¬ì™€ write ì™„ë£Œ í•¸ë“¤ëŸ¬ê°€ ì„œë¡œ ë‹¤ë¥¸ strandì—ì„œ ì§ë ¬í™” ë  ê²ƒì´ë¼ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë˜í•œ ì´ê²ƒì€ ë™ì¼í•œ íƒ€ì…(ì—¬ê¸°ì„œëŠ” readëƒ writeëƒ)ì˜ ì™„ë£Œ í•¸ë“¤ëŸ¬ë“¤ì€ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰ë˜ë‚˜ readì™€ write í•¸ë“¤ëŸ¬ëŠ” ê°ê° ë³‘ë ¬ì ìœ¼ë¡œ ì§„í–‰ë  ê²ƒì´ë¼ëŠ” ì˜ë¯¸ì´ê¸°ë„ í•©ë‹ˆë‹¤. ì´ê²ƒì´ ì—¬ëŸ¬ë¶„ì´ ì œì–´ íë¦„ì„ ë™ê¸°ì ìœ¼ë¡œ ìœ ì§€í•˜ê¸° ìœ„í•´ í•´ì•¼í•  ì „ë¶€ì…ë‹ˆë‹¤. ë„ˆë¬´ ê°„ë‹¨í•˜ì§€ ì•Šì€ê°€ìš”! ì—¬ëŸ¬ë¶„ì´ strandë¥¼ ì ì ˆí•˜ê²Œ í• ë‹¹í•´ì£¼ëŠ” í•œ êµì°©ìƒíƒœì— ë¹ ì§€ê±°ë‚˜ ë‹¤ë¥¸ ì¼ë°˜ì ì¸ ë©€í‹°ì“°ë ˆë”© ì´ìŠˆê°€ ë°œìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><blockquote><p>In the example above we used two strands, one for reading and one for writing operations. This means that read completion handlers will be serialized with one strand and write handlers will be serialized with another strand. Which means that completion handlers of the same type will go serially, however read and write handlers will go in parallel to each other. And thatâ€™s all you need to keep your control flow synchronized, so simple! Note that you canâ€™t get deadlocked here or run into other common multithreading issues. As long as you designate your strands properly.</p></blockquote><p>ì—¬ëŸ¬ë¶„ì€ ì£¼ì–´ì§„ strandì•ˆì—ì„œ ì—¬ëŸ¬ë¶„ì˜ functorë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ boost::asio::post í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>You can also use boost::asio::post function with io_context::strand to execute your functors within a given strand:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">io::post(read, []</span><br><span class="line">{</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"We're inside a read sequence, it's safe to access a read-related data here!\n"</span>;</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></div></figure><br><h2 id="1ê°œì˜-io-contextì™€-1ê°œì˜-ì“°ë ˆë“œ-ìŒì„-Nê°œ-ìƒì„±í•˜ëŠ”-ì‹¤í–‰-ëª¨ë¸"><a href="#1ê°œì˜-io-contextì™€-1ê°œì˜-ì“°ë ˆë“œ-ìŒì„-Nê°œ-ìƒì„±í•˜ëŠ”-ì‹¤í–‰-ëª¨ë¸" class="headerlink" title="1ê°œì˜ io_contextì™€ 1ê°œì˜ ì“°ë ˆë“œ ìŒì„ Nê°œ ìƒì„±í•˜ëŠ” ì‹¤í–‰ ëª¨ë¸"></a>1ê°œì˜ io_contextì™€ 1ê°œì˜ ì“°ë ˆë“œ ìŒì„ Nê°œ ìƒì„±í•˜ëŠ” ì‹¤í–‰ ëª¨ë¸</h2><p>ì´ì „ ê°•ì˜ì—ì„œ Nê°œì˜ ì“°ë ˆë“œë¥¼ í•˜ë‚˜ì˜ io_context í´ë˜ìŠ¤ ê°ì²´ì—ì„œ ë™ì‘í•˜ë„ë¡ í•˜ëŠ” ì‹¤í–‰ ëª¨ë¸ì„ ë°°ì›Œë³´ì•˜ìŠµë‹ˆë‹¤. ì´ ê²½ìš°ì— io_contextëŠ” ì—¬ëŸ¬ë¶„ì„ ìœ„í•´ ìì²´ì ìœ¼ë¡œ ë¡œë“œ ë°¸ëŸ°ì‹±ì„ ìˆ˜í–‰í•˜ë©°, ì—¬ëŸ¬ë¶„ì€ ë‹¤ìŒ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ì–´ë–¤ ì“°ë ˆë“œë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ”ì§€ì— ëŒ€í•´ ì‹ ê²½ ì“¸ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p><blockquote><p>In the previous lesson weâ€™ve learned an execution model where you launch N threads for the same io_context class instance. In that case io_context do load balancing for you, and you donâ€™t need to care which thread should be used for the next handler to execute on.</p></blockquote><p>1ê°œì˜ io_contextì™€ 1ê°œì˜ ì“°ë ˆë“œ ìŒì„ Nê°œ ìƒì„±í•˜ëŠ” ë˜ ë‹¤ë¥¸ ì‹¤í–‰ ëª¨ë¸ì´ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°ì— ëª¨ë“  ì“°ë ˆë“œëŠ” ê°ìì˜ io_context í´ë˜ìŠ¤ ê°ì²´ë¥¼ ê°–ê²Œë©ë‹ˆë‹¤. ì•„ë˜ ì˜ˆì œë¥¼ ì‚´í´ë´…ì‹œë‹¤. io_context group wrapperëŠ” ìš”ì²­ëœ io_context, work guard ê·¸ë¦¬ê³  ì“°ë ˆë“œ í´ë˜ìŠ¤ ê°ì²´ì˜ ì¹´ìš´íŠ¸ ê°’ì„ ìƒì„±í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì•„ë˜ ì˜ˆì œë¥¼ í†µí•´ ì´ ì‹¤í–‰ ëª¨ë¸ì— ëŒ€í•´ ë…¼ì˜í•  ì˜ˆì •ì…ë‹ˆë‹¤.</p><blockquote><p>There is another execution model where you create N pairs of â€œ1 io_context + 1 threadâ€ instead. In that case every thread has its own io_context class instance. Look at the example below. Itâ€™s io_context group wrapper which creates requested count of io_context, work guard and thread class instances. We will discuss this execution model below the example.</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BOOST_ASIO_NO_DEPRECATED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/asio.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> io = boost::asio;</span><br><span class="line"><span class="keyword">using</span> tcp = io::ip::tcp;</span><br><span class="line"><span class="keyword">using</span> work_guard_type = io::executor_work_guard&lt;io::io_context::executor_type&gt;;</span><br><span class="line"><span class="keyword">using</span> error_code = boost::system::error_code;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">io_context_group</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    io_context_group(<span class="built_in">std</span>::<span class="keyword">size_t</span> size)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">// Create io_context and work guard pairs</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">std</span>::<span class="keyword">size_t</span> n = <span class="number">0</span>; n &lt; size; ++n)</span><br><span class="line">        {</span><br><span class="line">            contexts.emplace_back(<span class="built_in">std</span>::make_shared&lt;io::io_context&gt;());</span><br><span class="line">            guards.emplace_back(<span class="built_in">std</span>::make_shared&lt;work_guard_type&gt;(contexts.back()-&gt;get_executor()));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="comment">// Create threads</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; io_context : contexts)</span><br><span class="line">        {</span><br><span class="line">            threads.emplace_back([&amp;]</span><br><span class="line">            {</span><br><span class="line">                io_context-&gt;run();</span><br><span class="line">            });</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Join threads</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; thread : threads)</span><br><span class="line">        {</span><br><span class="line">            thread.join();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Round-robin io_context&amp; query</span></span><br><span class="line">    <span class="function">io::io_context&amp; <span class="title">query</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">return</span> *contexts[index++ % contexts.size()];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="keyword">using</span> vector_ptr = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;T&gt;&gt;;</span><br><span class="line"></span><br><span class="line">    vector_ptr&lt;io::io_context&gt; contexts;</span><br><span class="line">    vector_ptr&lt;work_guard_type&gt; guards;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; threads;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::atomic&lt;<span class="built_in">std</span>::<span class="keyword">size_t</span>&gt; index = <span class="number">0</span>;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="function">io_context_group <span class="title">group</span><span class="params">(<span class="built_in">std</span>::thread::hardware_concurrency() * <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">tcp::socket <span class="title">socket</span><span class="params">(group.query())</span></span>;</span><br><span class="line">    <span class="comment">// Schedule some tasks</span></span><br><span class="line">    group.run();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ì—¬ëŸ¬ë¶„ì´ ì´ ì‹¤í–‰ ëª¨ë¸ì— ê´€í•´ ì•Œì•„ì•¼í•˜ëŠ” ë‚´ìš©ë“¤:</p><blockquote><p>Things you should know about this execution model:</p></blockquote><p>ì—¬ëŸ¬ë¶„ì€ strands ë˜ëŠ” ë‹¤ë¥¸ ì–´ë–¤ ë™ê¸°í™” ë„êµ¬ë“¤ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì„ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤: ëª¨ë“  io_contextê°€ ë‹¨ì¼ ì“°ë ˆë“œ ë‚´ì—ì„œ ì‹¤í–‰ë˜ê¸°ë•Œë¬¸ì— ë™ê¸°í™”ê°€ í•„ìš”í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¬¼ë¡  ë™ì¼í•œ io_context í•¸ë“¤ëŸ¬ì—ì„œ ë™ì¼í•œ ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ”ê²ƒì— í•œí•´ì„œ ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ì ì€ í”ŒëŸ¬ìŠ¤ ìš”ì¸ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.</p><blockquote><p>ğŸ’¡ You donâ€™t need to mess with strands or any other synchronization tools: since every io_context runs within a single thread, no data requires synchronization. As long as you access the same data from the same io_context handlers only. That looks like a plus.</p></blockquote><p>io_contextì—ì„œ ë™ì‘í•˜ëŠ” socketì´ë‚˜ acceptor ë“±ê³¼ ê°™ì€ ê°ì²´ë“¤ì€ io_context ê°ì²´ì— í•œ ë²ˆë§Œ ë°”ì¸ë”©ë©ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì€ ì´ëŸ¬í•œ ê°ì²´ë“¤ì˜ ìƒëª…ì£¼ê¸° ë‚´ì—ì„œëŠ” ë˜ ë‹¤ë¥¸ io_contextì— ë‹¤ì‹œ ë°”ì¸ë”©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ ë§ì€ ê³§ ë™ì¼í•œ io_contextì— ë°”ì¸ë”©ëœ ëª¨ë“  ê°ì²´ë“¤ì€ ë‹¨ì¼ ì“°ë ˆë“œ ë‚´ì—ì„œ ì‹¤í–‰ë  ê²ƒì´ë¼ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ê²ƒì´ ê·¸ë“¤ì´ ëª¨ë“  ì‹œê°„ ë™ì•ˆì— ë™ì¼í•œ CPU ì½”ì–´ì— ë°”ì¸ë”©ëœë‹¤ëŠ” ì˜ë¯¸ëŠ” ì•„ë‹™ë‹ˆë‹¤ - OSëŠ” ê°€ì¥ ì í•©í•œ ì½”ì–´ë¼ê³  ìƒê°ë˜ëŠ” ê³³ì—ì„œ ì“°ë ˆë“œë¥¼ ì‹¤í–‰í•˜ë©° ì“°ë ˆë“œì˜ ìƒëª…ì£¼ê¸° ë‚´ì—ì„œ ì“°ë ˆë“œì˜ ì½”ì–´ê°€ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì“°ë ˆë“œê°€ ì‹¤í–‰ë˜ëŠ” ì½”ì–´ê°€ ì–´ë””ëƒì— ê´€ê³„ì—†ì´ ëª¨ë“  io_context ê°ì²´ë“¤ì€ í•­ìƒ (í˜„ì¬ì˜)ë‹¨ì¼ ì½”ì–´ ë‚´ì—ì„œ ì‹¤í–‰ë  ê²ƒì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ì—¬ëŸ¬ë¶„ì€ í•˜ë‚˜ì˜ ì½”ì–´ê°€ 100% ì‚¬ìš©ë¥ ì„ ë³´ì´ëŠ” ë°˜ë©´ ë‹¤ë¥¸ ì½”ì–´ë“¤ì€ ë†€ê³  ìˆëŠ” ìƒíƒœì¸ ìƒí™©ì„ ì§ë©´í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì–¸ëœ»ë³´ê¸°ì— ì´ê²ƒì€ ë§ˆì´ë„ˆìŠ¤ ìš”ì¸ì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤.</p><blockquote><p>ğŸ’¡ Objects working on io_context, such as sockets, acceptors, etc, are bound to io_context object once. You canâ€™t rebind any of them to another io_context within their lifetime. Which means that all objects bound to the same io_context will run within a single thread. This doesnâ€™t mean that theyâ€™re bound to the same hardware CPU core all the time â€” an operating system runs a thread on the most suitable core and may change a threadâ€™s core within a threadâ€™s lifetime. However wherever that thread is running, all io_context objects will always run within a single (current) core. So you may face a situation when one core runs at 100% load while the others are idle. At a first glance thatâ€™s look like a minus.</p></blockquote><p>ì§„ì§œ ë§ˆì´ë„ˆìŠ¤ ìš”ì¸ì€ ì´ëŸ¬í•œ ì‚¬ì‹¤ ìì²´(í•˜ë‚˜ì˜ ì½”ì–´ê°€ 100% ì‚¬ìš©ë¥ ì„ ë³´ì´ëŠ” ë°˜ë©´ ë‹¤ë¥¸ ì½”ì–´ë“¤ì€ ë†€ê³  ìˆëŠ” ìƒíƒœ)ë¼ê¸° ë³´ë‹¤ëŠ” ì„ íƒí•œ ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜ ë˜ëŠ” íŠ¹ì •í•œ ì´ìš© ì‚¬ë¡€ì— ëŒ€í•œ ì‹¤í–‰ ëª¨ë¸ì˜ ë¶€ì ì ˆí•œ ì‚¬ìš©ì˜ ê²°ê³¼ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì „ì— ì‚´í´ë³¸ 1:N ì‹¤í–‰ ëª¨ë¸ì˜ ê²½ìš°ì—ëŠ” ìì²´ì ìœ¼ë¡œ ì—¬ëŸ¬ë¶„ì—ê²Œ ë°¸ëŸ°ì‹±ì„ ì œê³µí•´ì£¼ëŠ” ë°˜ë©´, ì´ ëª¨ë¸ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜(ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬) ê°œë°œìì— ì˜í•´ êµ¬í˜„ë˜ëŠ” ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜ì„ ìš”êµ¬í•˜ê²Œ ë©ë‹ˆë‹¤.</p><blockquote><p>ğŸ’¡ Well, itâ€™s not really a minus of the execution model itself, but a minus of a balancing algorithm chosen or a result of improper usage of the execution model for a specific use-case. While the execution model from the previous lesson do balancing for you, this lessonâ€™s model requires balancing algorithm to be implemented by the application (or a library) developer.</p></blockquote><p>ì´ì „ ê°•ì˜ì—ì„œ ì‚´í´ë³¸ 1:N ì‹¤í–‰ ëª¨ë¸ì€ ë²”ìš©ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ëª¨ë¸ì…ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì´ ì„ íƒí•´ì•¼í•˜ëŠ” ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜ì´ ë¬´ì—‡ì¸ì§€ ëª¨ë¥´ê² ëŠ” ìƒí™©ì´ë¼ë©´ ì´ ëª¨ë¸ì„ ì„ íƒí•˜ì‹œë©´ ë©ë‹ˆë‹¤. ìœ„ì—ì„œ ì‚´í´ë³¸ 1:1 ì‹¤í–‰ ëª¨ë¸ì€ ë” ë¹ ë¥´ê²Œ ë™ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ê²ƒì€ íŠ¹ë³„í•œ ì¼€ì´ìŠ¤ì— ëŒ€í•´ì„œë§Œ ì•Œë§ì€ ì„ íƒì…ë‹ˆë‹¤: ì—¬ëŸ¬ë¶„ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë˜ ë‹¤ë¥¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ê³¼ ëª‡ê°€ì§€ íŠ¹ë³„í•œ ë°©ì‹ìœ¼ë¡œ ìƒí˜¸ì‘ìš©í•˜ëŠ” ê²½ìš°ì—. ê·¸ë¦¬ê³  ì´ íŠ¹ë³„í•œ ë°©ì‹ì€ ì ì ˆí•œ ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜ì„ ìš”êµ¬í•©ë‹ˆë‹¤. ìœ„ì—ì„œ ë³¸ ì˜ˆì œì—ì„œëŠ” ë¼ìš´ë“œë¡œë¹ˆ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í–ˆê³ , ì¼ë°˜ì ìœ¼ë¡œ ê·¸ ì•Œê³ ë¦¬ì¦˜ì´ ë‚˜ì˜ë‹¤ í˜¹ì€ ì¢‹ë‹¤ë¼ê³  ë§í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤ - ì´ ì•Œê³ ë¦¬ì¦˜ì´ ì ì ˆí•œì§€ì— ëŒ€í•œ íŒë‹¨ì€ ë‹¤ë¥¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ê³¼ì˜ ìƒí˜¸ì‘ìš© ë°©ì‹ì´ ë¬´ì—‡ì´ëƒì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìš°ë¦¬ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë§ì€ ëœë¤í•œ ê°€ë²¼ìš´ ì‘ì—…ë“¤ì„ ì²˜ë¦¬í•˜ëŠ” ê²½ìš°ë¼ë©´ ìë™í™”ëœ ë°¸ëŸ°ì„œë³´ë‹¤ ë” ë‚˜ì€ í•´ê²°ì±…ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŸ¬í•œ íŒë‹¨ì„ ëª…í™•íˆ í•˜ëŠ”ê²ƒì€ ì‰½ì§€ ì•ŠìŠµë‹ˆë‹¤. ì»¤ìŠ¤í…€ ë°¸ëŸ°ì„œì˜ ë‹¤ë¥¸ ì´ìš© ì‚¬ë¡€ë‚˜ ë””ìì¸ íŒ¨í„´ë“¤ì€ ì´ë²ˆ ê°•ì˜ì˜ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤. ì´ê²ƒë“¤ì— ëŒ€í•´ì„œëŠ” ë‚˜ì¤‘ì— ë‹¤ë£¨ì–´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ: ì—¬ëŸ¬ë¶„ì´ ì–´ë– í•œ íƒ€ì…ì˜ ì‹¤í–‰ ëª¨ë¸ì„ ì‚¬ìš©í•´ì•¼í• ì§€ í™•ì‹ ì´ ì„œì§€ ì•ŠëŠ”ë‹¤ë©´ ì´ì „ ê°•ì˜ì—ì„œ ì‚´í´ë³¸ 1:N ì‹¤í–‰ ëª¨ë¸ì„ ì„ íƒí•˜ëŠ”ê²ƒì´ ë°”ëŒì§í•©ë‹ˆë‹¤.</p><blockquote><p>ğŸ’¡ The execution model from the previous lesson is a universal one. Pick it if you donâ€™t really know what balancing algorithm you should choose. The execution model from the current lesson may work faster though. However it best fit for special cases only: when your application interacts with other applications in some of special ways. And those special ways require a proper balancing algorithms. In the example above we used a round-robin algorithm, and we canâ€™t really say if that algorithm is bad or good in general â€” that depends on a way of interaction of our application with other applications. For example, if our application handles a lot of random lightweight tasks then it could be a better solution than the automatic balancer. However things could be not as obvious as theyâ€™re appear to be at a first glance. Different use-cases and design patterns of a custom balancer is out of scope of this lesson. We will discuss them some later. Once again: if youâ€™re not sure what type of execution model you should choose then pick an automatic one from the previous lesson.</p></blockquote><br><h2 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h2><p>ì§€ê¸ˆê¹Œì§€ boost::io_contextì˜ ì‹¤í–‰ ëª¨ë¸(execution model)ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ì •ë¦¬í•´ë³´ë©° í•´ë‹¹ í¬ìŠ¤íŒ…ì€ ì—¬ê¸°ì„œ ë§ˆì¹˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.<br><br></p><ul><li>boost::io_contextì˜ ì‹¤í–‰ ëª¨ë¸ì´ë€ í•˜ë‚˜ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŠ¹ì •í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” <em><strong>thread</strong></em>ì™€ ê·¸ ì“°ë ˆë“œë¥¼ êµ¬ë™í•˜ëŠ” ê³µê°„ì¸ <em><strong>io_context</strong></em>ê°„ì˜ ê´€ê³„ë¥¼ ê·œì •í•´ë†“ì€ ê²ƒì´ë‹¤.</li><li>boost::io_contextì˜ ì‹¤í–‰ ëª¨ë¸ì—ëŠ” 1:N ë°©ì‹ê³¼ 1:1 ë°©ì‹ì´ ìˆë‹¤. (io_context:thread)</li><li>1:N ì‹¤í–‰ ëª¨ë¸ì˜ ê²½ìš°ì—ëŠ” Nê°œì˜ ì“°ë ˆë“œë¥¼ í•˜ë‚˜ì˜ io_contextì—ì„œ ì²˜ë¦¬í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</li><li>1:1 ì‹¤í–‰ ëª¨ë¸ì˜ ê²½ìš°ì—ëŠ” ëª¨ë“  ì“°ë ˆë“œê°€ ê°ìì˜ io_contextë¥¼ ê°–ëŠ” êµ¬ì¡°ì´ë‹¤.</li><li>1:N ì‹¤í–‰ ëª¨ë¸ì€ Nê°œì˜ ì“°ë ˆë“œë“¤ì— ëŒ€í•´ì„œ ìì²´ì ì¸ ë¡œë“œ ë°¸ëŸ°ì‹±ì„ ì œê³µí•˜ì§€ë§Œ, 1:1 ì‹¤í–‰ ëª¨ë¸ì˜ ê²½ìš°ì—ëŠ” ê·¸ë ‡ì§€ ì•Šë‹¤(ì ì ˆí•œ ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜ì„ ê°œë°œìê°€ ì„ íƒí•´ì„œ ì ìš©í•´ì•¼í•¨).</li><li>ì–´ë– í•œ íƒ€ì…ì˜ ì‹¤í–‰ ëª¨ë¸ì„ ì‚¬ìš©í•´ì•¼í• ì§€ í™•ì‹ ì´ ì„œì§€ ì•ŠëŠ”ë‹¤ë©´ 1:N ëª¨ë¸ì„ íƒí•˜ë¼.</li></ul><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>Reference</strong></p><ul><li><a href="https://dens.website/tutorials/cpp-asio/multithreading">https://dens.website/tutorials/cpp-asio/multithreading</a></li><li><a href="https://dens.website/tutorials/cpp-asio/multithreading-2">https://dens.website/tutorials/cpp-asio/multithreading-2</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/%EA%B8%B0%EC%88%A0%EB%AC%B8%EC%84%9C-%EB%B2%88%EC%97%AD/">ê¸°ìˆ ë¬¸ì„œ ë²ˆì—­</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/boost-asio/">boost asio</category>
      
      <category domain="https://chelseafandev.github.io/tags/io-context/">io_context</category>
      
      <category domain="https://chelseafandev.github.io/tags/thread/">thread</category>
      
      <category domain="https://chelseafandev.github.io/tags/execution-model/">execution model</category>
      
      
      <comments>https://chelseafandev.github.io/2023/05/19/multithreaded-execution/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>boost::multiprecisionì„ í™œìš©í•˜ì—¬ Javaì˜ BigInteger í‰ë‚´ë‚´ê¸°</title>
      <link>https://chelseafandev.github.io/2023/05/12/impl-big-integer-in-cpp/</link>
      <guid>https://chelseafandev.github.io/2023/05/12/impl-big-integer-in-cpp/</guid>
      <pubDate>Fri, 12 May 2023 07:11:16 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;escape&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><escape><span id="more"></span></escape></p><p>ì•„ë˜ í‘œì—ì„œ ì²˜ëŸ¼ C/C++ì—ì„œ ì§€ì›í•˜ëŠ” ì •ìˆ˜ íƒ€ì…ì˜ ìë£Œí˜•(long long ë˜ëŠ” unsigned long long)ì€ ìµœëŒ€ 8byteì…ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ 8byte(32bit)ë¥¼ ì´ˆê³¼í•˜ëŠ” ì •ìˆ˜ëŠ” ì–´ë–¤ ìë£Œí˜•ì„ í†µí•´ ê´€ë¦¬í•´ì•¼í• ê¹Œìš”?</p><table><thead><tr><th><strong>ìë£Œí˜•</strong></th><th><strong>í¬ê¸°</strong></th><th><strong>ë²”ìœ„</strong></th></tr></thead><tbody><tr><td>long long</td><td>8 byte</td><td>-9,223,372,036,854,775,807 ~ 9,223,372,036,854,775,807</td></tr><tr><td>unsigned long long</td><td>8 byte</td><td>0 ~ 18,446,744,073,709,551,615</td></tr></tbody></table><p>Javaì—ì„œëŠ” ì´ì²˜ëŸ¼ 8byteë¥¼ ì´ˆê³¼í•˜ëŠ” í° ì •ìˆ˜ë“¤ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ BigIntegerë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">java</li></ul></figcaption><div class="tabs-content"><figure class="highlight java" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">String left = <span class="string">"18446744073709551615"</span>;</span><br><span class="line">String right = <span class="string">"18446744073709551615"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ë¬¸ìì—´ íƒ€ì…ì˜ ì²«ë²ˆì§¸ ì¸ì ê°’ì„ ë‘ë²ˆì§¸ ì¸ìë¡œ ì§€ì •ëœ Nì§„ìˆ˜ë¡œ ë³€í™˜í•´ì¤Œ</span></span><br><span class="line">BigInteger bi_left = <span class="keyword">new</span> BigInteger(left, <span class="number">10</span>);</span><br><span class="line">BigInteger bi_right = <span class="keyword">new</span> BigInteger(right, <span class="number">10</span>);</span><br><span class="line">BigInteger output = bi_left.add(bi_right);</span><br><span class="line">System.out.println(<span class="string">"output(dec): "</span> + output.toString());</span><br><span class="line">      </span><br><span class="line">StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"><span class="keyword">byte</span>[] ba = output.toByteArray();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">final</span> <span class="keyword">byte</span> b: ba)</span><br><span class="line">{</span><br><span class="line">  sb.append(String.format(<span class="string">"0x%02x "</span>, b&amp;<span class="number">0xff</span>));</span><br><span class="line">}</span><br><span class="line">System.out.println(<span class="string">"output(hex): "</span> + sb);</span><br></pre></td></tr></tbody></table></figure></div></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">output(dec) : 36893488147419103230</span><br><span class="line">output(hex) : 0x01 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xfe</span><br></pre></td></tr></table></figure><br><p>ë¶ˆí–‰íˆë„ C/C++ ë‚´ì¥í˜• íƒ€ì… ì¤‘ì—ëŠ” 8byteë¥¼ ì´ˆê³¼í•˜ëŠ” ìë£Œí˜•ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. stackoverflowë¥¼ ì°¾ì•„ë³´ë‹ˆ ì§ì ‘ êµ¬í˜„ì„ í•´ì„œ ì‚¬ìš©í•˜ê±°ë‚˜ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬(<a href="https://gmplib.org/">Gmplib</a>, <a href="https://gist.github.com/bloopletech/338338">bigint</a>)ë¥¼ ì‚¬ìš©í•˜ë¼ê³  í•˜ëŠ”ë°..<br>ì…ë§›ì— ë§ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ boost::multiprecisionì„ í™œìš©í•˜ì—¬ ê°„ëµí•˜ê²Œ êµ¬í˜„í•´ë³´ì•˜ìŠµë‹ˆë‹¤.</p><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cinttypes&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/multiprecision/cpp_int.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> left = <span class="string">"18446744073709551615"</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> right = <span class="string">"18446744073709551615"</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 18446744073709551615ëŠ” 10ì§„ìˆ˜ë¡œ í‘œí˜„ëœ 20ìë¦¬ ì •ìˆ˜ ê°’ì´ë©° í’€ì–´ì¨ë³´ë©´ (1*10^19) + (8*10^18) + (4*10^17) + ... + (1*10^1) + (5*10^0) ì…ë‹ˆë‹¤.</span></span><br><span class="line">  <span class="comment">// í•´ë‹¹ ê³¼ì •ì„ êµ¬í˜„í•œ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// ì‚¬ì‹¤ 10ì§„ìˆ˜ ì •ìˆ˜ì˜ ê²½ìš°ì—ëŠ” ë¬¸ìì—´ íƒ€ì…ì˜ ê°’ì„ boost::multiprecision::cpp_int ìƒì„±ìì˜ ì¸ìë¡œ ì „ë‹¬í•˜ë©´ ì‰½ê²Œ ë³€í™˜í•˜ì—¬ ì—°ì‚°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</span></span><br><span class="line">  <span class="comment">//   std::string value = "18446744073709551615";</span></span><br><span class="line">  <span class="comment">//   boost::multiprecision::cpp_int bi_value(value);</span></span><br><span class="line">  <span class="comment">// </span></span><br><span class="line">  <span class="comment">// í•˜ì§€ë§Œ Javaì˜ BigInteger ì²˜ëŸ¼ ì‚¬ìš©ìê°€ ì§ì ‘ íŠ¹ì • ì§„ìˆ˜ë¥¼ ì§€ì •í•˜ì—¬ ë³€í™˜í•  ìˆ˜ëŠ” ì—†ì—ˆê¸°ë•Œë¬¸ì— ì§„ìˆ˜ ë³€í™˜ ë¡œì§ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.</span></span><br><span class="line">  boost::<span class="function">multiprecision::cpp_int <span class="title">bi_left</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="keyword">int</span> len = left.length();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> tmp_str;</span><br><span class="line">    tmp_str.append(<span class="number">1</span>, left[i]);</span><br><span class="line">    bi_left += (boost::multiprecision::<span class="built_in">pow</span>(boost::multiprecision::cpp_int(<span class="number">10</span>), len - i - <span class="number">1</span>) * <span class="built_in">std</span>::strtoimax(tmp_str.c_str(), <span class="literal">nullptr</span>, <span class="number">10</span>));</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  boost::<span class="function">multiprecision::cpp_int <span class="title">bi_right</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">  len = right.length();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> tmp_str;</span><br><span class="line">    tmp_str.append(<span class="number">1</span>, left[i]);</span><br><span class="line">    bi_right += (boost::multiprecision::<span class="built_in">pow</span>(boost::multiprecision::cpp_int(<span class="number">10</span>), len - i - <span class="number">1</span>) * <span class="built_in">std</span>::strtoimax(tmp_str.c_str(), <span class="literal">nullptr</span>, <span class="number">10</span>));</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  boost::multiprecision::cpp_int output = bi_left + bi_right;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"output(dec): "</span> &lt;&lt; output &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">using</span> byte_array_type = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt;;</span><br><span class="line">  byte_array_type ba_output;</span><br><span class="line">  boost::multiprecision::export_bits(output, <span class="built_in">std</span>::back_inserter(ba_output), <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"output(hex): "</span>);</span><br><span class="line">  <span class="keyword">int</span> ba_output_len = ba_output.size();</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ba_output_len; ++i)</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"0x%02x "</span>, ba_output[i]);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">output(dec) : 36893488147419103230</span><br><span class="line">output(hex) : 0x01 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xfe</span><br></pre></td></tr></table></figure><br><p><strong>Reference</strong></p><ul><li><a href="https://learn.microsoft.com/ko-kr/cpp/cpp/data-type-ranges?view=msvc-170">https://learn.microsoft.com/ko-kr/cpp/cpp/data-type-ranges?view=msvc-170</a></li><li><a href="https://stackoverflow.com/questions/36952038/how-to-handle-big-integer-data-more-than-8-byte-or-more-than-20-digits-in-c">https://stackoverflow.com/questions/36952038/how-to-handle-big-integer-data-more-than-8-byte-or-more-than-20-digits-in-c</a></li><li><a href="https://gmplib.org/">https://gmplib.org/</a></li><li><a href="https://gist.github.com/bloopletech/338338">https://gist.github.com/bloopletech/338338</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/C/">C++</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/boost-multiprecision/">boost::multiprecision</category>
      
      <category domain="https://chelseafandev.github.io/tags/biginteger-in-c/">biginteger in c++</category>
      
      
      <comments>https://chelseafandev.github.io/2023/05/12/impl-big-integer-in-cpp/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>í´ë˜ìŠ¤ í…œí”Œë¦¿ì˜ íŠ¹ì • ë©¤ë²„ í•¨ìˆ˜ë§Œ íŠ¹ìˆ˜í™”í•˜ê¸°</title>
      <link>https://chelseafandev.github.io/2023/05/02/make-specific-memberfunc-to-templatefunc/</link>
      <guid>https://chelseafandev.github.io/2023/05/02/make-specific-memberfunc-to-templatefunc/</guid>
      <pubDate>Tue, 02 May 2023 02:24:04 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;escape&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><escape><span id="more"></span></escape></p><p>ì•„ë˜ì™€ ê°™ì´ í´ë˜ìŠ¤ í…œí”Œë¦¿ì—ì„œ <code>íŠ¹ì • ë©¤ë²„ í•¨ìˆ˜ë§Œ íŠ¹ìˆ˜í™”</code>ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><figure class="codeblock codeblock--tabbed"><figcaption><span>mytemplateclass.h</span><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mytemplateclass</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">get_name</span><span class="params">()</span></span>; <span class="comment">// íŠ¹ìˆ˜í™” í•˜ë ¤ëŠ” ëŒ€ìƒ</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">get_grade</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> name_;</span><br><span class="line">  <span class="keyword">int</span> grade_;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mytemplateclass.impl.h"</span></span></span><br></pre></td></tr></tbody></table></figure></div></figure><figure class="codeblock codeblock--tabbed"><figcaption><span>mytemplateclass.impl.h</span><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> mytemplateclass&lt;T&gt;::get_name()</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">return</span> name_;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> mytemplateclass&lt;<span class="keyword">int</span>&gt;::get_name()</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">std</span>::<span class="built_in">string</span>(<span class="string">"specific member function specialization"</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">int</span> mytemplateclass&lt;T&gt;::get_grade()</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">return</span> grade_;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><br><p>C++17 ë¶€í„°ëŠ” <code>if constexpr</code>ì™€ <code>std::is_same_v</code>ë¥¼ ì¡°í•©í•˜ì—¬ ì¢€ ë” ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="codeblock codeblock--tabbed"><figcaption><span>mytemplateclass_v2.h</span><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mytemplateclass_v2</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">get_name</span><span class="params">()</span></span>; <span class="comment">// íŠ¹ìˆ˜í™” í•˜ë ¤ëŠ” ëŒ€ìƒ</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">get_grade</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> name_;</span><br><span class="line">  <span class="keyword">int</span> grade_;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mytemplateclass_v2.impl.h"</span></span></span><br></pre></td></tr></tbody></table></figure></div></figure><figure class="codeblock codeblock--tabbed"><figcaption><span>mytemplateclass_v2.impl.h</span><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> mytemplateclass_v2&lt;T&gt;::get_name()</span><br><span class="line">{</span><br><span class="line">  <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(<span class="built_in">std</span>::is_same_v&lt;<span class="keyword">int</span>, T&gt;)</span></span></span><br><span class="line"><span class="function">  </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">std</span>::<span class="built_in">string</span>(<span class="string">"specific member function specialization"</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> name_;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">int</span> mytemplateclass_v2&lt;T&gt;::get_grade()</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">return</span> grade_;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><br><p><strong>Reference</strong></p><ul><li><a href="https://stackoverflow.com/questions/5512910/explicit-specialization-of-template-class-member-function">https://stackoverflow.com/questions/5512910/explicit-specialization-of-template-class-member-function</a></li><li><a href="https://en.cppreference.com/w/cpp/types/is_same">https://en.cppreference.com/w/cpp/types/is_same</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/C/">C++</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/template/">template</category>
      
      <category domain="https://chelseafandev.github.io/tags/template-function-specialization/">template function specialization</category>
      
      <category domain="https://chelseafandev.github.io/tags/if-constexpr/">if constexpr</category>
      
      <category domain="https://chelseafandev.github.io/tags/std-is-same-v/">std::is_same_v</category>
      
      
      <comments>https://chelseafandev.github.io/2023/05/02/make-specific-memberfunc-to-templatefunc/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ìì£¼ ì‚¬ìš©í•˜ëŠ” GDB ëª…ë ¹ì–´</title>
      <link>https://chelseafandev.github.io/2023/02/10/tip-for-gdb-debugging/</link>
      <guid>https://chelseafandev.github.io/2023/02/10/tip-for-gdb-debugging/</guid>
      <pubDate>Fri, 10 Feb 2023 04:18:57 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;escape&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><escape><span id="more"></span></escape></p><!-- toc --><br><h3 id="gdbë¥¼-í†µí•´-í”„ë¡œê·¸ë¨-ì‹¤í–‰"><a href="#gdbë¥¼-í†µí•´-í”„ë¡œê·¸ë¨-ì‹¤í–‰" class="headerlink" title="gdbë¥¼ í†µí•´ í”„ë¡œê·¸ë¨ ì‹¤í–‰"></a>gdbë¥¼ í†µí•´ í”„ë¡œê·¸ë¨ ì‹¤í–‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb &#123;(ê²½ë¡œí¬í•¨)í”„ë¡œê·¸ë¨ëª…&#125;</span><br></pre></td></tr></table></figure><br><h3 id="ë¸Œë ˆì´í¬-í¬ì¸íŠ¸-ë“±ë¡"><a href="#ë¸Œë ˆì´í¬-í¬ì¸íŠ¸-ë“±ë¡" class="headerlink" title="ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ ë“±ë¡"></a>ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ ë“±ë¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b ì†ŒìŠ¤íŒŒì¼ëª…:ë¼ì¸ë„˜ë²„</span><br></pre></td></tr></table></figure><br><h3 id="í”„ë¡œê·¸ë¨-ì‹œì‘"><a href="#í”„ë¡œê·¸ë¨-ì‹œì‘" class="headerlink" title="í”„ë¡œê·¸ë¨ ì‹œì‘"></a>í”„ë¡œê·¸ë¨ ì‹œì‘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) r &#123;ì¸ìë¥¼ ì¶”ê°€í•´ì•¼í•œë‹¤ë©´ ì…ë ¥&#125;</span><br></pre></td></tr></table></figure><br><h3 id="ë¸Œë ˆì´í¬-í¬ì¸íŠ¸ì—-ê±¸ë¦°-í›„-ì´ì–´ì„œ-ì§„í–‰"><a href="#ë¸Œë ˆì´í¬-í¬ì¸íŠ¸ì—-ê±¸ë¦°-í›„-ì´ì–´ì„œ-ì§„í–‰" class="headerlink" title="ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ì— ê±¸ë¦° í›„ ì´ì–´ì„œ ì§„í–‰"></a>ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ì— ê±¸ë¦° í›„ ì´ì–´ì„œ ì§„í–‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) c</span><br></pre></td></tr></table></figure><br><h3 id="ìì£¼-ì‚¬ìš©í•˜ëŠ”-ëª…ë ¹ì–´"><a href="#ìì£¼-ì‚¬ìš©í•˜ëŠ”-ëª…ë ¹ì–´" class="headerlink" title="ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´"></a>ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bt(=backtrace)</span><br><span class="line">p(=print)</span><br><span class="line">set print pretty on(or off)</span><br><span class="line">f(=frame)</span><br><span class="line">up</span><br><span class="line">down</span><br></pre></td></tr></table></figure><br><h3 id="print-í¬ë§·-ì¢…ë¥˜"><a href="#print-í¬ë§·-ì¢…ë¥˜" class="headerlink" title="print í¬ë§· ì¢…ë¥˜"></a>print í¬ë§· ì¢…ë¥˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d decimal</span><br><span class="line">x hex</span><br><span class="line">t binary</span><br><span class="line">f floating point</span><br><span class="line">i instruction</span><br><span class="line">c character</span><br></pre></td></tr></table></figure><br><h3 id="ì“°ë ˆë“œ-ì •ë³´-í™•ì¸"><a href="#ì“°ë ˆë“œ-ì •ë³´-í™•ì¸" class="headerlink" title="ì“°ë ˆë“œ ì •ë³´ í™•ì¸"></a>ì“°ë ˆë“œ ì •ë³´ í™•ì¸</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info threads</span><br></pre></td></tr></table></figure><br><h3 id="info-threads-ëª…ë ¹ì–´ë¥¼-í†µí•´-ì¶œë ¥ëœ-idê°’ì„-í†µí•œ-ì“°ë ˆë“œ-ì§„ì…"><a href="#info-threads-ëª…ë ¹ì–´ë¥¼-í†µí•´-ì¶œë ¥ëœ-idê°’ì„-í†µí•œ-ì“°ë ˆë“œ-ì§„ì…" class="headerlink" title="(info threads ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¶œë ¥ëœ idê°’ì„ í†µí•œ)ì“°ë ˆë“œ ì§„ì…"></a>(info threads ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¶œë ¥ëœ idê°’ì„ í†µí•œ)ì“°ë ˆë“œ ì§„ì…</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) thread &#123;id&#125;</span><br></pre></td></tr></table></figure><br><h3 id="ë ˆì§€ìŠ¤í„°-ì •ë³´-í™•ì¸"><a href="#ë ˆì§€ìŠ¤í„°-ì •ë³´-í™•ì¸" class="headerlink" title="ë ˆì§€ìŠ¤í„° ì •ë³´ í™•ì¸"></a>ë ˆì§€ìŠ¤í„° ì •ë³´ í™•ì¸</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info registers</span><br></pre></td></tr></table></figure><ul><li>rax (eax) : ëˆ„ì‚°ê¸°(accumulator) ë ˆì§€ìŠ¤í„°. ì‚°ìˆ ì—°ì‚°(ë§ì…ˆ, ë‚˜ëˆ—ì…ˆ, ê³±ì…ˆ)ì´ë‚˜ ë…¼ë¦¬ì—°ì‚°ì„ ìˆ˜í–‰í•œ ë°˜í™˜ê°’ì´ ì €ì¥</li><li>rbx (ebx) : ë² ì´ìŠ¤ ë ˆì§€ìŠ¤í„°</li><li>rcx (ecx) : ì¹´ìš´í„° ë ˆì§€ìŠ¤í„°. ë°˜ë³µ ëª…ë ¹ì–´ ì‚¬ìš© ì‹œ ë°˜ë³µ ì¹´ìš´í„°ë¡œ ì‚¬ìš©ë˜ëŠ” ê°’ì„ ì €ì¥</li><li>rdx (edx) : ë°ì´í„° ë ˆì§€ìŠ¤í„°. ì‚°ìˆ ì—°ì‚°ê³¼ I/O ëª…ë ¹ì—ì„œ rax(eax)ì™€ í•¨ê»˜ ì‚¬ìš©</li><li>rsi (esi) : source ì¸ë±ìŠ¤ ë ˆì§€ìŠ¤í„°</li><li>rdi (edi) : destination ì¸ë±ìŠ¤ ë ˆì§€ìŠ¤í„°</li><li>rbp (ebp) : ë² ì´ìŠ¤ í¬ì¸í„° ë ˆì§€ìŠ¤í„°. ìŠ¤íƒì˜ ì‹œì‘ ì§€ì  ì£¼ì†Œë¥¼ ì €ì¥</li><li>rsp (esp) : ìŠ¤íƒ í¬ì¸í„° ë ˆì§€ìŠ¤í„°. ìŠ¤íƒì˜ ê°€ì¥ ë§ˆì§€ë§‰ ì§€ì  ì£¼ì†Œë¥¼ ì €ì¥</li><li>rip : ëª…ë ¹ í¬ì¸í„° ë ˆì§€ìŠ¤í„°ì´ë‹¤. í˜„ì¬ ëª…ë ¹ì˜ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚´</li></ul><br><h3 id="ì–´ì…ˆë¸”ëŸ¬-ë¤í”„"><a href="#ì–´ì…ˆë¸”ëŸ¬-ë¤í”„" class="headerlink" title="ì–´ì…ˆë¸”ëŸ¬ ë¤í”„"></a>ì–´ì…ˆë¸”ëŸ¬ ë¤í”„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disas</span><br></pre></td></tr></table></figure><br><h3 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) layout src</span><br><span class="line">(gdb) layout asm</span><br><span class="line">(gdb) layout reg</span><br></pre></td></tr></table></figure><br><h3 id="íŠ¹ì •-ë³€ìˆ˜-ê°’ì˜-ì£¼ì†Œ-ì¶œë ¥"><a href="#íŠ¹ì •-ë³€ìˆ˜-ê°’ì˜-ì£¼ì†Œ-ì¶œë ¥" class="headerlink" title="íŠ¹ì • ë³€ìˆ˜ ê°’ì˜ ì£¼ì†Œ ì¶œë ¥"></a>íŠ¹ì • ë³€ìˆ˜ ê°’ì˜ ì£¼ì†Œ ì¶œë ¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p &amp;&#123;ë³€ìˆ˜ëª…&#125;</span><br></pre></td></tr></table></figure><br><h3 id="íŠ¹ì •-ë³€ìˆ˜ì˜-í—¥ì‚¬ê°’-ì¶œë ¥"><a href="#íŠ¹ì •-ë³€ìˆ˜ì˜-í—¥ì‚¬ê°’-ì¶œë ¥" class="headerlink" title="íŠ¹ì • ë³€ìˆ˜ì˜ í—¥ì‚¬ê°’ ì¶œë ¥"></a>íŠ¹ì • ë³€ìˆ˜ì˜ í—¥ì‚¬ê°’ ì¶œë ¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/&#123;ì¶œë ¥í• í¬ê¸°&#125;bx &#123;ë³€ìˆ˜ì˜ ì£¼ì†Œê°’&#125;</span><br></pre></td></tr></table></figure><br><h3 id="gdbì—ì„œ-ê¸´-ë¬¸ìì—´ì„-ì¤„ì´ì§€-ì•Šê³ -ê·¸ëŒ€ë¡œ-ì¶œë ¥"><a href="#gdbì—ì„œ-ê¸´-ë¬¸ìì—´ì„-ì¤„ì´ì§€-ì•Šê³ -ê·¸ëŒ€ë¡œ-ì¶œë ¥" class="headerlink" title="gdbì—ì„œ ê¸´ ë¬¸ìì—´ì„ ì¤„ì´ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ì¶œë ¥"></a>gdbì—ì„œ ê¸´ ë¬¸ìì—´ì„ ì¤„ì´ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ì¶œë ¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set print elements 0</span><br></pre></td></tr></table></figure><br><h3 id="gdbì—ì„œ-ì¤‘ë³µëœ-ë¬¸ìì—´ì„-ê·¸ëŒ€ë¡œ-í’€ì–´ì„œ-ì¶œë ¥"><a href="#gdbì—ì„œ-ì¤‘ë³µëœ-ë¬¸ìì—´ì„-ê·¸ëŒ€ë¡œ-í’€ì–´ì„œ-ì¶œë ¥" class="headerlink" title="gdbì—ì„œ ì¤‘ë³µëœ ë¬¸ìì—´ì„ ê·¸ëŒ€ë¡œ í’€ì–´ì„œ ì¶œë ¥"></a>gdbì—ì„œ ì¤‘ë³µëœ ë¬¸ìì—´ì„ ê·¸ëŒ€ë¡œ í’€ì–´ì„œ ì¶œë ¥</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set print repeats 0</span><br></pre></td></tr></table></figure><br><h3 id="px-pn"><a href="#px-pn" class="headerlink" title="px pn"></a>px pn</h3><p>Boost::shared_ptrì„ ì‚¬ìš©í•œë‹¤ë©´ gdb ë””ë²„ê¹… ì‹œ pxì™€ pnì •ë³´ë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆìŒ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element_type* px;                   <span class="comment">// contained pointer</span></span><br><span class="line">boost::detail::shared_count pn;     <span class="comment">// reference count</span></span><br></pre></td></tr></table></figure><br><h3 id="ì‹¤í–‰-ì¤‘ì¸-í”„ë¡œì„¸ìŠ¤ì˜-íŠ¹ì •-ì“°ë ˆë“œ-ì§„ì…"><a href="#ì‹¤í–‰-ì¤‘ì¸-í”„ë¡œì„¸ìŠ¤ì˜-íŠ¹ì •-ì“°ë ˆë“œ-ì§„ì…" class="headerlink" title="ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ì˜ íŠ¹ì • ì“°ë ˆë“œ ì§„ì…"></a>ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ì˜ íŠ¹ì • ì“°ë ˆë“œ ì§„ì…</h3><p>í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ ìƒíƒœì—ì„œ íŠ¹ì • ì“°ë ˆë“œ idë¥¼ í†µí•´ gdb ì§„ì…ì´ ê°€ëŠ¥í•˜ë©°, ì´í›„ <code>CTRL + C</code>ë¥¼ í†µí•´ í•´ë‹¹ ì“°ë ˆë“œì˜ íë¦„ì„ ì¤‘ë‹¨í•˜ì—¬ backtrace í™•ì¸ì´ ê°€ëŠ¥í•¨(c ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹¤í–‰ ì¬ê°œ)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb -p &#123;gdbë¡œ í™•ì¸í•  ì“°ë ˆë“œ id&#125;</span><br></pre></td></tr></table></figure><br><h3 id="sysroot-solib-search-path-substitute-path"><a href="#sysroot-solib-search-path-substitute-path" class="headerlink" title="sysroot / solib-search-path / substitute-path"></a>sysroot / solib-search-path / substitute-path</h3><p>ì•„ë˜ commandë“¤ì€ gdb ì‹¤í–‰ ì‹œ -ex ì˜µì…˜(execute a singleÂ GDBÂ command)ìœ¼ë¡œ ì¶”ê°€í•´ì£¼ë©´ ìœ ìš©í•¨</p><ul><li>set sysroot {path}</li><li>set solib-search-path {path}</li><li>set substitute-path {original path} {substitute path}</li></ul><br><p><strong>Reference</strong></p><ul><li><a href="https://visualgdb.com/gdbreference/commands/">https://visualgdb.com/gdbreference/commands/</a></li><li><a href="https://visualgdb.com/gdbreference/commands/set_sysroot">https://visualgdb.com/gdbreference/commands/set_sysroot</a></li><li><a href="https://visualgdb.com/gdbreference/commands/set_solib-search-path">https://visualgdb.com/gdbreference/commands/set_solib-search-path</a></li><li><a href="https://www.irya.unam.mx/computo/sites/manuales/fce12/debugger/cl/commandref/gdb_mode/cmd_set_substitu.htm">https://www.irya.unam.mx/computo/sites/manuales/fce12/debugger/cl/commandref/gdb_mode/cmd_set_substitu.htm</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/%EB%94%94%EB%B2%84%EA%B9%85/">ë””ë²„ê¹…</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/gdb/">gdb</category>
      
      <category domain="https://chelseafandev.github.io/tags/gdb-command/">gdb command</category>
      
      <category domain="https://chelseafandev.github.io/tags/backtrace/">backtrace</category>
      
      <category domain="https://chelseafandev.github.io/tags/bt/">bt</category>
      
      
      <comments>https://chelseafandev.github.io/2023/02/10/tip-for-gdb-debugging/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>UTF-8(Unicode Transformation Format - 8bit) ìš”ì•½ ì •ë¦¬</title>
      <link>https://chelseafandev.github.io/2023/01/30/unicode-encoding-utf8/</link>
      <guid>https://chelseafandev.github.io/2023/01/30/unicode-encoding-utf8/</guid>
      <pubDate>Mon, 30 Jan 2023 07:06:33 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;escape&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><escape><span id="more"></span></escape></p><p>ìœ ë‹ˆì½”ë“œëŠ” ì „ ì„¸ê³„ì˜ ëª¨ë“  ë¬¸ìë¥¼ ì»´í“¨í„°ì—ì„œ ì¼ê´€ë˜ê²Œ í‘œí˜„í•˜ê³  ë‹¤ë£° ìˆ˜ ìˆë„ë¡ ì„¤ê³„ëœ ì‚°ì—… í‘œì¤€ì´ë©°, í˜„ì¡´í•˜ëŠ” ë¬¸ì ì¸ì½”ë”© ë°©ë²•ë“¤ì„ ëª¨ë‘ ìœ ë‹ˆì½”ë“œë¡œ êµì²´í•˜ë ¤ëŠ” ê²ƒì— ëª©ì ì´ ìˆìŠµë‹ˆë‹¤.</p><p>ìœ ë‹ˆì½”ë“œ ì˜ì—­ ëª©ë¡ì€ ì•„ë˜ ë§í¬ë¥¼ ì°¸ì¡°</p><ul><li><a href="https://ko.wikipedia.org/wiki/%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C_%EC%98%81%EC%97%AD">https://ko.wikipedia.org/wiki/ìœ ë‹ˆì½”ë“œ_ì˜ì—­</a></li></ul><p>ìœ ë‹ˆì½”ë“œ ì¸ì½”ë”© ë°©ì‹ ì¤‘ í•˜ë‚˜ê°€ UTF-8ì´ë©°, ê°€ë³€ ê¸¸ì´ ë¬¸ì ì¸ì½”ë”© ë°©ì‹ìœ¼ë¡œ 1ë°”ì´íŠ¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¸ì½”ë”©í•©ë‹ˆë‹¤. (í•œ ê¸€ìê°€ 1~4ë°”ì´íŠ¸ ì¤‘ í•˜ë‚˜ë¡œ ì¸ì½”ë”©ë¨)</p><p><strong>ì¸ì½”ë”© ê·œì¹™</strong></p><ul><li>UTF-8 2-byte Characters<ul><li>ì²« ë²ˆì§¸ byte = 0xc0 ~ 0xdf</li><li>ë‘ ë²ˆì§¸ byte = 0x80 ~ 0xbf</li></ul></li><li>UTF-8 3-byte Characters<ul><li>ì²« ë²ˆì§¸ byte = 0xe0 ~ 0xef</li><li>ë‘ ë²ˆì§¸ byte = 0x80 ~ 0xbf</li><li>ì„¸ ë²ˆì§¸ byte = 0x80 ~ 0xbf</li></ul></li><li>UTF-8 4-byte Characters<ul><li>ì²« ë²ˆì§¸ byte = 0xf0 ~ 0xf7</li><li>ë‘ ë²ˆì§¸ byte = 0x80 ~ 0xbf</li><li>ì„¸ ë²ˆì§¸ byte = 0x80 ~ 0xbf</li><li>ë„¤ ë²ˆì§¸ byte = 0x80 ~ 0xbf</li></ul></li></ul><br><p><strong>Reference</strong></p><ul><li><a href="https://design215.com/toolbox/ascii-utf8.php">https://design215.com/toolbox/ascii-utf8.php</a></li><li><a href="https://design215.com/toolbox/utf8-3byte-characters.php">https://design215.com/toolbox/utf8-3byte-characters.php</a></li><li><a href="https://design215.com/toolbox/utf8-4byte-characters.php">https://design215.com/toolbox/utf8-4byte-characters.php</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/%EC%9D%B8%EC%BD%94%EB%94%A9/">ì¸ì½”ë”©</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/UTF8/">UTF8</category>
      
      <category domain="https://chelseafandev.github.io/tags/Unicode/">Unicode</category>
      
      
      <comments>https://chelseafandev.github.io/2023/01/30/unicode-encoding-utf8/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>SELECT ì¿¼ë¦¬ ê²°ê³¼ ë™ì ìœ¼ë¡œ ë°›ì•„ì˜¤ëŠ” ë°©ë²•</title>
      <link>https://chelseafandev.github.io/2023/01/26/how-to-get-query-result-dynamically/</link>
      <guid>https://chelseafandev.github.io/2023/01/26/how-to-get-query-result-dynamically/</guid>
      <pubDate>Thu, 26 Jan 2023 02:48:13 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;escape&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><escape><span id="more"></span></escape></p><p><code>SelectQueryResultType</code>ì€ ì¿¼ë¦¬ ì¡°íšŒ ê²°ê³¼ë¡œ ë‚˜ì˜¨ ì¹¼ëŸ¼ ì´ë¦„ì„ keyê°’ìœ¼ë¡œ í•˜ê³  í•´ë‹¹ ì¹¼ëŸ¼ì˜ íƒ€ì…ì— ê´€ê³„ ì—†ì´ ê·¸ ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ë¹ˆ ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ì˜ valueë¥¼ ê°–ëŠ” map ìŠ¬ë¼ì´ìŠ¤ì´ê³  ì¡°íšŒëœ row ê°œìˆ˜ ë§Œí¼ í•´ë‹¹ ìŠ¬ë¼ì´ìŠ¤ì— append ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p><p><code>pointers</code>ë¼ëŠ” ë¹ˆ(empty) ì¸í„°í˜ì´ìŠ¤ ìŠ¬ë¼ì´ìŠ¤ë¥¼ ì¶”ê°€í•œ ì´ìœ ëŠ” pq ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ Scan() í•¨ìˆ˜ëŠ” ì¡°íšŒëœ ì¹¼ëŸ¼ ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ <strong>ë³€ìˆ˜ì˜ ì£¼ì†Œ ê°’</strong>ì„ ì¸ìë¡œ ë°›ê¸° ë•Œë¬¸ì— <code>values</code> ë¼ëŠ” ë¹ˆ(empty) ì¸í„°í˜ì´ìŠ¤ ìŠ¬ë¼ì´ìŠ¤(ì¡°íšŒëœ ì¹¼ëŸ¼ ê°’ì„ ì €ì¥í•  ê³µê°„)ì˜ ìš”ì†Œ ë³„ ì£¼ì†Œ ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ìŠ¬ë¼ì´ìŠ¤ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. <img src="/assets/images/how-to-get-query-result-dynamically-figure1.jpeg" class="" width="200" height="200"></p><br><figure class="highlight go"><figcaption><span>postgres.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> postgres</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;database/sql&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line">_ <span class="string">&quot;github.com/lib/pq&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SelectQueryResultType []<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span> <span class="title">SelectQuery</span><span class="params">(query <span class="keyword">string</span>)</span> <span class="params">(SelectQueryResultType, error)</span></span> &#123;</span><br><span class="line">rows, err := db.db.Query(query)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cols, err := rows.Columns()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;db columns fail: %s\n&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result SelectQueryResultType</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">values := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(cols))</span><br><span class="line">pointers := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(cols))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> values &#123;</span><br><span class="line">pointers[i] = &amp;values[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err = rows.Scan(pointers...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;db scan fail: %s\n&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">row := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"><span class="keyword">for</span> i, val := <span class="keyword">range</span> values &#123;</span><br><span class="line">row[strings.ToLower(cols[i])] = val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result = <span class="built_in">append</span>(result, row)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><p><strong>Reference</strong></p><ul><li><a href="https://stackoverflow.com/questions/53435455/handling-dynamic-queries-cant-scan-into-struct">https://stackoverflow.com/questions/53435455/handling-dynamic-queries-cant-scan-into-struct</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/Go/">Go</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/lib-pq/">lib/pq</category>
      
      <category domain="https://chelseafandev.github.io/tags/Scan/">Scan()</category>
      
      <category domain="https://chelseafandev.github.io/tags/Golang-query/">Golang query</category>
      
      
      <comments>https://chelseafandev.github.io/2023/01/26/how-to-get-query-result-dynamically/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>boost::asio::post í•¨ìˆ˜ì˜ ì¸ìë¡œ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì „ë‹¬í•  ë•Œ ì£¼ì˜ ì‚¬í•­</title>
      <link>https://chelseafandev.github.io/2023/01/26/caution-when-passing-instance-to-post/</link>
      <guid>https://chelseafandev.github.io/2023/01/26/caution-when-passing-instance-to-post/</guid>
      <pubDate>Thu, 26 Jan 2023 02:43:57 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;escape&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><escape><span id="more"></span></escape></p><p>boost::asio::post í•¨ìˆ˜ì˜ ì¸ìë¡œ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì „ë‹¬í•˜ëŠ” ê²½ìš°ì—ëŠ” ë°˜ë“œì‹œ í•´ë‹¹ í´ë˜ìŠ¤ì— <code>í•¨ìˆ˜ í˜¸ì¶œ ì—°ì‚°ì</code>ê°€ <strong>ì˜¤ë²„ë¡œë”©</strong> ë˜ì–´ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</p><br><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/asio.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">handler</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    handler(<span class="keyword">int</span> a, <span class="keyword">int</span> b) : a_(a), b_(b) {}</span><br><span class="line"></span><br><span class="line">    <span class="comment">// í•´ë‹¹ í•¨ìˆ˜ ì£¼ì„ ì²˜ë¦¬í•˜ë©´ compile error!!</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a_ * b_ &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> a_;</span><br><span class="line">    <span class="keyword">int</span> b_;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="function">handler <span class="title">h</span><span class="params">(<span class="number">10</span>, <span class="number">20</span>)</span></span>;</span><br><span class="line">    boost::asio::post(h);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/C/">C++</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/boost-asio-post/">boost::asio::post</category>
      
      <category domain="https://chelseafandev.github.io/tags/passing-instance-to-post-function/">passing instance to post function</category>
      
      <category domain="https://chelseafandev.github.io/tags/function-call-operator/">function call operator</category>
      
      <category domain="https://chelseafandev.github.io/tags/operator-overloading/">operator overloading</category>
      
      
      <comments>https://chelseafandev.github.io/2023/01/26/caution-when-passing-instance-to-post/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>í…œí”Œë¦¿ í´ë˜ìŠ¤ë¥¼ ì •ì˜í•  ë•Œ ì„ ì–¸ë¶€ì™€ êµ¬í˜„ë¶€ë¥¼ ì„œë¡œ ë‹¤ë¥¸ íŒŒì¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ë°©ë²•</title>
      <link>https://chelseafandev.github.io/2023/01/26/seperate-header-and-impl-in-template-class/</link>
      <guid>https://chelseafandev.github.io/2023/01/26/seperate-header-and-impl-in-template-class/</guid>
      <pubDate>Thu, 26 Jan 2023 02:41:06 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;escape&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><escape><span id="more"></span></escape></p><p>í—¤ë” íŒŒì¼ì˜ ë§¨ í•˜ë‹¨ì— í…œí”Œë¦¿ í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•œ íŒŒì¼ì„ include ì‹œì¼œì£¼ë©´ ë©ë‹ˆë‹¤. (<strong>#include</strong> ëŠ” ëŒ€ìƒì´ ë˜ëŠ” íŒŒì¼ì„ ë‹¨ìˆœíˆ ë¶™ì—¬ ë„£ì–´ì£¼ëŠ” ì—­í• ì„ í•˜ë¯€ë¡œ)</p><figure class="codeblock codeblock--tabbed"><figcaption><span>mytemplateclass.h</span><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MYTEMPLATECLASS_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MYTEMPLATECLASS_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ggultip</span><br><span class="line">{</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mytemplateclass</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">mytemplateclass();</span><br><span class="line">~mytemplateclass();</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">};</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"mytemplateclass.impl.h"</span></span></span><br></pre></td></tr></tbody></table></figure></div></figure><figure class="codeblock codeblock--tabbed"><figcaption><span>mytemplateclass.impl.h</span><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ggultip</span><br><span class="line">{</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">mytemplateclass&lt;T&gt;::mytemplateclass()</span><br><span class="line">{</span><br><span class="line">...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">mytemplateclass&lt;T&gt;::~mytemplateclass()</span><br><span class="line">{</span><br><span class="line">...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><br><p><strong>Reference</strong></p><ul><li>Michael Main, Walter Savitch. (2010). Data Structures &amp; Other Objects Using C++, 4th Edition. Pearson</li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/C/">C++</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/template-class/">template class</category>
      
      <category domain="https://chelseafandev.github.io/tags/%ED%85%9C%ED%94%8C%EB%A6%BF-%ED%81%B4%EB%9E%98%EC%8A%A4-%EA%B5%AC%ED%98%84%EB%B6%80-%EB%B6%84%EB%A6%AC/">í…œí”Œë¦¿ í´ë˜ìŠ¤ êµ¬í˜„ë¶€ ë¶„ë¦¬</category>
      
      
      <comments>https://chelseafandev.github.io/2023/01/26/seperate-header-and-impl-in-template-class/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ê·¸ë£¹ì´ ì•„ë‹Œ ê³„ì¸µìœ¼ë¡œì„œì˜ Go íŒ¨í‚¤ì§€</title>
      <link>https://chelseafandev.github.io/2022/12/01/translate-packages-as-layers/</link>
      <guid>https://chelseafandev.github.io/2022/12/01/translate-packages-as-layers/</guid>
      <pubDate>Thu, 01 Dec 2022 05:43:31 GMT</pubDate>
      
      <description>&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì€ ì§€ë‚œë²ˆ &lt;a href=&quot;https://chelseafandev.github.io/2022/09/06/translate-standard-package-layout-in-go/&quot;&gt;ì–´ë– í•œ ë°©ì‹ìœ¼ë¡œ Goì½”ë“œë¥¼ êµ¬ì¡°í™”í•´ì•¼ í•˜ëŠ”ê°€?&lt;/a&gt; í¬ìŠ¤íŒ…ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ Go ì†ŒìŠ¤ ì½”ë“œì˜ êµ¬ì¡°í™”ì— ëŒ€í•œ ê³ ë¯¼ì˜ ì—°ì¥ì„ ì…ë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ì´ë²ˆ í¬ìŠ¤íŒ…ì€ ì§€ë‚œë²ˆ <a href="https://chelseafandev.github.io/2022/09/06/translate-standard-package-layout-in-go/">ì–´ë– í•œ ë°©ì‹ìœ¼ë¡œ Goì½”ë“œë¥¼ êµ¬ì¡°í™”í•´ì•¼ í•˜ëŠ”ê°€?</a> í¬ìŠ¤íŒ…ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ Go ì†ŒìŠ¤ ì½”ë“œì˜ êµ¬ì¡°í™”ì— ëŒ€í•œ ê³ ë¯¼ì˜ ì—°ì¥ì„ ì…ë‹ˆë‹¤.</p><span id="more"></span><p>ì´ë²ˆì— ë²ˆì—­í•´ ë³¸ ê¸€ë„ ì§€ë‚œë²ˆ í¬ìŠ¤íŒ…ê³¼ ë™ì¼í•œ ì €ìê°€ ì‘ì„±í•œ ê¸€ì´ë©° Go ì†ŒìŠ¤ ì½”ë“œì˜ êµ¬ì¡°í™”ì— ê´€ë ¨ëœ ê¸€ì„ 4ë…„ì´ ì§€ë‚œ í›„ì— ë‹¤ì‹œ í•œë²ˆ ê²Œì‹œí•´ì£¼ì…¨ë”ë¼ê³ ìš”. Go ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì œì‘í•  ë•Œ íŒ¨í‚¤ì§€ë“¤ ê°„ì˜ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ ë°”ë¼ë³¼ ê²ƒì¸ê°€ì— ëŒ€í•´ í•œ ë²ˆ ë” ê³ ë¯¼í•  ìˆ˜ ìˆëŠ” ì‹œê°„ì´ì—ˆìŠµë‹ˆë‹¤.</p><p>ì›ë¬¸ì„ ì°¸ê³ í•˜ì‹¤ ë¶„ë“¤ì€ <a href="https://www.gobeyond.dev/packages-as-layers/">í•´ë‹¹ ë§í¬</a>ë¥¼ í™•ì¸í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p><br><!-- toc --><br><h1 id="ê·¸ë£¹ì´-ì•„ë‹Œ-ê³„ì¸µìœ¼ë¡œì„œì˜-Go-íŒ¨í‚¤ì§€"><a href="#ê·¸ë£¹ì´-ì•„ë‹Œ-ê³„ì¸µìœ¼ë¡œì„œì˜-Go-íŒ¨í‚¤ì§€" class="headerlink" title="ê·¸ë£¹ì´ ì•„ë‹Œ ê³„ì¸µìœ¼ë¡œì„œì˜ Go íŒ¨í‚¤ì§€"></a>ê·¸ë£¹ì´ ì•„ë‹Œ ê³„ì¸µìœ¼ë¡œì„œì˜ Go íŒ¨í‚¤ì§€</h1><p>ìˆ™ë ¨ëœ Go ê°œë°œìë“¤ì—ê²Œë„ ê°€ì¥ ì–´ë ¤ìš´ ì£¼ì œì¤‘ í•˜ë‚˜ì¸ <code>package layout</code>ì— ëŒ€í•´ ë‹¤ë£¨ì–´ë³´ê³ ì 4ë…„ì „ì— <a href="https://www.gobeyond.dev/standard-package-layout/">Standard Package Layout</a>ì´ë¼ëŠ” ê¸€ì„ ê²Œì‹œí–ˆì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ Go ê°œë°œìë“¤ì€ ì—¬ì „íˆ ê·¸ë“¤ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ê³¼ í•¨ê»˜ ë°©ëŒ€í•´ì ¸ê°ˆ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¡œ ì •ë¦¬í•˜ëŠ”ê²ƒì— ëŒ€í•´ ì–´ë ¤ì›€ì„ ê²ªê³  ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Four years ago, I wrote an article called <a href="https://www.gobeyond.dev/standard-package-layout/">Standard Package Layout</a> that tried to address one of the most difficult topics for even advanced Go developers: package layout. However, most developers still struggle with organizing their code into a directory structure that will grow gracefully with their application.</p></blockquote><p>ê±°ì˜ ëª¨ë“  í”„ë¡œê·¸ë˜ë° ì–¸ì–´ëŠ” ê´€ë ¨ëœ ê¸°ëŠ¥ë“¤ì„ í•¨ê»˜ ê·¸ë£¹í™”í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ ê°–ê³  ìˆìŠµë‹ˆë‹¤. RubyëŠ” gems, JavaëŠ” pacakagesë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì–¸ì–´ë“¤ì€ ì½”ë“œë¥¼ ê·¸ë£¹í™” í•˜ëŠ” ì¼ë°˜ì ì¸ ê·œì•½ì„ ê°–ê³  ìˆì§€ ì•ŠëŠ”ë° ì†”ì§íˆ ì´ê²ƒì´ í¬ê²Œ ì¤‘ìš”í•˜ì§€ ì•Šê¸°ë•Œë¬¸ì…ë‹ˆë‹¤. ì½”ë“œë¥¼ ê·¸ë£¹í™”í•˜ëŠ” ê²ƒì€ ì „ì ìœ¼ë¡œ ê°œì¸ì˜ ì·¨í–¥ì— ë‹¬ë ¤ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Nearly all programming languages have a mechanism for grouping related functionality together. Ruby has gems, Java has packages. Those languages donâ€™t have a standard convention for grouping code because, honestly, it doesnâ€™t matter. It all comes down to personal preference.</p></blockquote><p>í•˜ì§€ë§Œ Goì–¸ì–´ë¡œ ì „í™˜í•˜ëŠ” ê°œë°œìë“¤ì€ ë§¤ìš° ë¹ˆë²ˆí•˜ê²Œ ê·¸ë“¤ì˜ íŒ¨í‚¤ì§€ êµ¬ì¡°í™”ê°€ ê·¸ë“¤ì„ ë‹¤ì‹œ ê´´ë¡­íˆê²Œ ëœë‹¤ëŠ” ê²ƒì— ë†€ë¼ê²Œ ë©ë‹ˆë‹¤. Goì˜ íŒ¨í‚¤ì§€ëŠ” ë‹¤ë¥¸ ì–¸ì–´ì˜ íŒ¨í‚¤ì§€ì˜ ê°œë…ê³¼ ì™œ ì´ë ‡ê²Œ ë‹¤ë¥¸ê±¸ê¹Œìš”? ê·¸ê²ƒì€ ë°”ë¡œ Goì—ì„œ íŒ¨í‚¤ì§€ ê°œë…ì€ ê·¸ë£¹ì´ ì•„ë‹Œ ê³„ì¸µì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p><blockquote><p>However, developers that transition to Go are surprised by how often their package organization comes back to bite them. Why are Go packages so different from other languages? Itâ€™s because theyâ€™re not groupsâ€”theyâ€™re layers.</p></blockquote><br><h2 id="ìˆœí™˜-ì°¸ì¡°-ì´í•´í•˜ê¸°"><a href="#ìˆœí™˜-ì°¸ì¡°-ì´í•´í•˜ê¸°" class="headerlink" title="ìˆœí™˜ ì°¸ì¡° ì´í•´í•˜ê¸°"></a>ìˆœí™˜ ì°¸ì¡° ì´í•´í•˜ê¸°</h2><p>Go ì–¸ì–´ì˜ íŒ¨í‚¤ì§€ì™€ ë‹¤ë¥¸ ì–¸ì–´ë“¤ì—ì„œì˜ ê·¸ë£¹í™”ê°„ì˜ ì£¼ìš”í•œ ì°¨ì´ëŠ” Go ì–¸ì–´ì—ì„œëŠ” íŒ¨í‚¤ì§€ê°„ì˜ ìˆœí™˜ ì˜ì¡´ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì— ìˆìŠµë‹ˆë‹¤. íŒ¨í‚¤ì§€ Aê°€ íŒ¨í‚¤ì§€ Bì— ì˜ì¡´í•  ìˆ˜ ìˆì§€ë§Œ ì´ì™€ ë™ì‹œì— íŒ¨í‚¤ì§€ Bê°€ íŒ¨í‚¤ì§€ Aì— ì˜ì¡´ì ì¼ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.</p><blockquote><p>The primary difference between Go packages and grouping in other languages is that Go doesnâ€™t allow for circular dependencies. Package A can depend on package B, but then package B cannot depend back on package A.</p></blockquote><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/figure1.png" alt="Package dependencies can only go one way"><span class="caption">Package dependencies can only go one way</span></div><p>ì´ëŸ¬í•œ ì œì•½ì€ ë‚˜ì¤‘ì— ê°œë°œìë“¤ì´ Aì™€ B íŒ¨í‚¤ì§€ ëª¨ë‘ì—ì„œ ê³µí†µëœ ì½”ë“œë¥¼ ê³µìœ í•˜ê²Œ í•˜ê³ ì í•  ë•Œ ë¬¸ì œë¥¼ ì•¼ê¸°í•˜ê²Œ í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë¬¸ì œì— ëŒ€í•œ 2ê°€ì§€ ì •ë„ì˜ ì†”ë£¨ì…˜ì´ ìˆìŠµë‹ˆë‹¤. ë‘ íŒ¨í‚¤ì§€ë¥¼ ë‹¨ì¼ íŒ¨í‚¤ì§€ë¡œ í•©ì¹˜ê±°ë‚˜ ë˜ ë‹¤ë¥¸ ì„¸ë²ˆì§¸ íŒ¨í‚¤ì§€ë¥¼ ë„ì…í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>This restriction causes issues for developers later on when they need to have both packages share common code. There are typically two solutions: either combine both packages into a single package or introduce a third package.</p></blockquote><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/figure2.png" alt=""></div><p>í•˜ì§€ë§Œ ë” ë§ì€ íŒ¨í‚¤ì§€ë“¤ë¡œ ë¶„í• í•´ê°€ëŠ” ê²ƒì€ ë¬¸ì œë¥¼ ë” í‚¤ìš°ëŠ” ê¼´ì…ë‹ˆë‹¤. ê²°êµ­ì—” ì‹¤ì œ êµ¬ì¡°ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê±°ëŒ€í•œ íŒ¨í‚¤ì§€ë“¤ì˜ ì§‘í•©ìœ¼ë¡œ ê·€ê²°ë  ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>However, splitting out into more and more packages only pushes the problem down the road. Eventually, you end up with a large mess of packages and no real structure.</p></blockquote><br><h2 id="ìŠ¤íƒ ë‹¤ë“œ-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì°¨ìš©í•˜ê¸°"><a href="#ìŠ¤íƒ ë‹¤ë“œ-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì°¨ìš©í•˜ê¸°" class="headerlink" title="ìŠ¤íƒ ë‹¤ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì°¨ìš©í•˜ê¸°"></a>ìŠ¤íƒ ë‹¤ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì°¨ìš©í•˜ê¸°</h2><p>Go í”„ë¡œê·¸ë˜ë° ì‹œì— í™œìš©ë˜ëŠ” ê°€ì¥ ìœ ìš©í•œ íŒë“¤ ì¤‘ì— í•˜ë‚˜ëŠ” ì—¬ëŸ¬ë¶„ì´ ê°€ì´ë“œê°€ í•„ìš”í•  ë•ŒëŠ” Goì˜ ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¸ê³ í•˜ë¼ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ì„¸ìƒì— ì™„ë²½í•œ ì½”ë“œë¼ëŠ” ê²ƒì€ ì—†ì§€ë§Œ Goì˜ ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” í•´ë‹¹ ì–¸ì–´ë¥¼ ì„¤ê³„í•œ ì‚¬ëŒë“¤ì´ ì´ìƒì ì´ë¼ê³  ìƒê°í•˜ëŠ” ë‚´ìš©ë“¤ì„ ì••ì¶•í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>One of the most useful tips when programming Go is to look to the standard library when you need guidance. No code is perfect, but the Go standard library encapsulates many of the ideals of the creators of the language.</p></blockquote><p>ì˜ˆë¥¼ ë“¤ì–´, net/http íŒ¨í‚¤ì§€ëŠ” ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ net íŒ¨í‚¤ì§€ì˜ ì¶”ìƒì„ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§€ë©° net íŒ¨í‚¤ì§€ëŠ” io ë ˆì´ì–´ì˜ ì¶”ìƒì„ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. net íŒ¨í‚¤ì§€ê°€ net/http íŒ¨í‚¤ì§€ì— ì˜ì¡´ì ì¼ ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•˜ëŠ” ê²ƒì€ ë‹¤ì†Œ ë¬´ì˜ë¯¸í•˜ê¸° ë•Œë¬¸ì— ì´ëŸ¬í•œ íŒ¨í‚¤ì§€ êµ¬ì¡°ëŠ” ê½¤ ì˜ ë™ì‘í•©ë‹ˆë‹¤.</p><blockquote><p>For example, the net/http package builds on top of the abstractions of the net package, which, in turn, builds on the abstractions of the io layer below it. This package structure works well because it would be nonsensical to imagine the net package needing to somehow depend on net/http.</p></blockquote><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/figure3.png" alt=""></div><p>Goì˜ ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì˜ ë™ì‘í•˜ëŠ” ê²ƒê³¼ëŠ” ë³„ê°œë¡œ ì´ê²ƒì„ Go ì–´í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì— ì ìš©í•˜ëŠ” ê²ƒì€ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>While this works well in the standard library but can be difficult to translate to application development.</p></blockquote><br><h2 id="ì–´í”Œë¦¬ì¼€ì´ì…˜-ê°œë°œì—-ê³„ì¸µ-ê°œë…-ì ìš©í•˜ê¸°"><a href="#ì–´í”Œë¦¬ì¼€ì´ì…˜-ê°œë°œì—-ê³„ì¸µ-ê°œë…-ì ìš©í•˜ê¸°" class="headerlink" title="ì–´í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì— ê³„ì¸µ ê°œë… ì ìš©í•˜ê¸°"></a>ì–´í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì— ê³„ì¸µ ê°œë… ì ìš©í•˜ê¸°</h2><p><code>WTF Dial</code>ì´ë¼ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì˜ˆë¡œ ë“¤ì–´ ì‚´í´ë³¼ ì˜ˆì •ì´ë¯€ë¡œ ì´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•´ ì¢€ ë” ì‚´í´ë³´ê³ ì í•˜ì‹œëŠ” ë¶„ë“¤ì€ <a href="https://www.gobeyond.dev/wtf-dial/">í•´ë‹¹ í¬ìŠ¤íŒ…</a>ì„ ì½ì–´ ë³´ì‹œë©´ ë©ë‹ˆë‹¤.</p><blockquote><p>Weâ€™ll be looking at an example application called WTF Dial, so you can read the <a href="https://www.gobeyond.dev/wtf-dial/">introductory post</a> to understand more about it.</p></blockquote><p>ì´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ 2ê°œì˜ ë…¼ë¦¬ì  ê³„ì¸µì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤:</p><blockquote><p>In this application, we have two logical layers:</p></blockquote><blockquote><ol><li>An SQLite database</li><li>An HTTP server</li></ol></blockquote><p>ìš°ë¦¬ëŠ” sqliteì™€ http íŒ¨í‚¤ì§€ë¥¼ ê°ê° ìƒì„±í•©ë‹ˆë‹¤. ë§ì€ ì‚¬ëŒë“¤ì´ Goì˜ ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒ¨í‚¤ì§€ì™€ ë™ì¼í•œ í˜•íƒœì˜ íŒ¨í‚¤ì§€ ì´ë¦„ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ êº¼ë ¤í•  ê²ƒ ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ìš°ë ¤ëŠ” ìœ íš¨í•œ ì§€ì ì´ê³  ì—¬ëŸ¬ë¶„ì€ http ëŒ€ì‹ ì— wtfhttpë¼ê³  ë„¤ì´ë°í•  ìˆ˜ë„ ìˆì„ê²ë‹ˆë‹¤. í•˜ì§€ë§Œ ìš°ë¦¬ì˜ HTTP íŒ¨í‚¤ì§€ëŠ” net/http íŒ¨í‚¤ì§€ë¥¼ ì™„ì „íˆ ìº¡ìŠí™”í•˜ê¸° ë•Œë¬¸ì— ë™ì¼í•œ íŒŒì¼ ë‚´ì—ì„œ ìš°ë¦¬ì˜ HTTP íŒ¨í‚¤ì§€ì™€ net/http íŒ¨í‚¤ì§€ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ëŠ” ê²°ì½” ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì €ëŠ” ëª¨ë“  íŒ¨í‚¤ì§€ ì´ë¦„ì— ì ‘ë‘ì–´ë¥¼ ë¶™ì´ëŠ” ì‘ì—…ì€ ì§€ë£¨í•˜ê³  ë³´ê¸°ì‹«ë‹¤ë¼ê³  ìƒê°í•˜ê¸° ë•Œë¬¸ì— ê·¸ ì§“ì€ í•˜ì§€ ì•Šê² ìŠµë‹ˆë‹¤.</p><blockquote><p>We create a package for each of these â€” sqlite &amp; http. Many people will balk at naming a package the same name as a standard library package. Thatâ€™s a valid criticism and you could name it wtfhttp instead, however, our HTTP package fully encapsulates the net/http package so we never use them both in the same file. I find that prefixing every package is tedious and ugly, so I donâ€™t do it.</p></blockquote><br><h3 id="ë‹¨ìˆœí•œ-ì ‘ê·¼"><a href="#ë‹¨ìˆœí•œ-ì ‘ê·¼" class="headerlink" title="ë‹¨ìˆœí•œ ì ‘ê·¼"></a>ë‹¨ìˆœí•œ ì ‘ê·¼</h3><p>ìš°ë¦¬ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¡°í™”í•˜ëŠ” í•œê°€ì§€ ë°©ë²•ì€ ë°ì´í„° íƒ€ì…(Userë‚˜ Dialê³¼ ê°™ì€)ê³¼ í•¨ìˆ˜(FindUser()ë‚˜ CreateDial()ê³¼ ê°™ì€)ë¥¼ sqlite íŒ¨í‚¤ì§€ì— í¬í•¨ì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤. http íŒ¨í‚¤ì§€ëŠ” sqlite íŒ¨í‚¤ì§€ì— ì§ì ‘ì ìœ¼ë¡œ ì˜ì¡´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p><blockquote><p>One way to structure our application would be to have our data types (e.g., User, Dial) and our functionality (e.g., FindUser(), CreateDial()) inside sqlite. Our http package could depend directly on it:</p></blockquote><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/figure4.png" alt=""></div><p>ì´ê²ƒì€ ê·¸ë¦¬ ë‚˜ìœ ì ‘ê·¼ ë°©ì‹ì´ ì•„ë‹ˆë©° ë‹¨ìˆœí•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ê½¤ ì˜ ë™ì‘í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ëª‡ê°€ì§€ ë¬¸ì œë“¤ì— ì§ë©´í•˜ê²Œ ë ê²ë‹ˆë‹¤. ì²«ì§¸ë¡œ ë°ì´í„° íƒ€ì…ì€ sqlite.Userì™€ sqlite.Dialë¡œ ë„¤ì´ë°ë˜ëŠ”ë° ë°ì´í„° íƒ€ì…ì´ë¼ëŠ” ê²ƒì€ SQLiteê°€ ì•„ë‹ˆë¼ ìš°ë¦¬ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì†í•˜ëŠ” ê²ƒì´ë¯€ë¡œ ì´ëŸ¬í•œ ë„¤ì´ë°ì€ ì¢€ ì´ìƒí•´ë³´ì…ë‹ˆë‹¤.</p><blockquote><p>This is not a bad approach, and it works for simple applications. We end up with a few issues though. First, our data types are named sqlite.User and sqlite.Dial. That sounds odd as our data types belong to our applicationâ€”not SQLite.</p></blockquote><p>ë‘˜ì§¸ë¡œ ìœ„ êµ¬ì¡°ìƒ HTTP ê³„ì¸µì—ì„œëŠ” ì˜¤ë¡œì§€ SQLiteì— ëŒ€í•œ ë°ì´í„°ë§Œì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì´ ë‘ ê³„ì¸µ ì‚¬ì´ì— ìºì‹± ê³„ì¸µì„ í•˜ë‚˜ ì¶”ê°€í•œë‹¤ê³  í•˜ë©´ ì–´ë–¤ì¼ì´ ë²Œì–´ì§ˆê¹Œìš”? ë˜ SQLiteê°€ ì•„ë‹Œ PostgreSQL í˜¹ì€ ë””ìŠ¤í¬ì— ì¡´ì¬í•˜ëŠ” JSON í˜•ì‹ì˜ ë°ì´í„°ì™€ ê°™ì€ ë‹¤ë¥¸ í˜•íƒœì˜ íƒ€ì…ë“¤ì€ ì–´ë–»ê²Œ ì§€ì›í• ê¹Œìš”?</p><blockquote><p>Second, our HTTP layer can only serve data from SQLite now. What happens if we need to add a caching layer in between? Or how do we support other types of data storage such as Postgres or even storing as JSON on disk?</p></blockquote><p>ë§ˆì§€ë§‰ìœ¼ë¡œ SQLiteë¥¼ ì¶”ìƒí™”í•˜ëŠ” ê³„ì¸µì´ ì¡´ì¬í•˜ì§€ ì•Šê¸°ë•Œë¬¸ì— ëª¨ë“  HTTP í…ŒìŠ¤íŠ¸ì—ì„œ SQLite ë°ì´í„°ë² ì´ìŠ¤ë¥¼ êµ¬ë™í•´ì•¼ë§Œ í•©ë‹ˆë‹¤. </p><blockquote><p>Finally, we need to run an SQLite database for every HTTP test since thereâ€™s no abstraction layer to mock it out. I generally support doing end-to-end testing as much as you can, but there are valid use cases for introducing unit tests in your higher layers. This is especially true once you introduce cloud services that you wouldnâ€™t want to run on every test invocation.</p></blockquote><br><h3 id="ë¹„ì¦ˆë‹ˆìŠ¤-ë„ë©”ì¸-ê³ ë¦½ì‹œí‚¤ê¸°"><a href="#ë¹„ì¦ˆë‹ˆìŠ¤-ë„ë©”ì¸-ê³ ë¦½ì‹œí‚¤ê¸°" class="headerlink" title="ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê³ ë¦½ì‹œí‚¤ê¸°"></a>ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê³ ë¦½ì‹œí‚¤ê¸°</h3><p>ìš°ë¦¬ê°€ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ì²«ë²ˆì§¸ ì‚¬í•­ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ì„ ê·¸ë“¤ ìì²´ì ì¸ íŒ¨í‚¤ì§€ë¡œ ì´ë™ì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ë„ë©”ì¸ì„ â€œì–´í”Œë¦¬ì¼€ì´ì…˜ ë„ë©”ì¸â€ì´ë¼ê³  ì¹­í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ ì—¬ëŸ¬ë¶„ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— íŠ¹í™”ëœ ë°ì´í„° íƒ€ì…ì…ë‹ˆë‹¤.</p><blockquote><p>The first thing we can change is moving our business domain to its own package. This can also be called the â€œapplication domainâ€. Itâ€™s the data types specific to your applicationâ€”e.g., User, Dial in the case of WTF Dial.</p></blockquote><p>ì €ëŠ” ì´ëŸ¬í•œ ëª©ì ìœ¼ë¡œ root íŒ¨í‚¤ì§€(wtf)ë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ì´ëŠ” ì´ë¯¸ ì œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ì— ë”°ë¼ í¸ë¦¬í•˜ê²Œ ë„¤ì´ë°ë˜ì–´ìˆê³ , ìƒˆë¡œìš´ ê°œë°œìê°€ ì½”ë“œ ë² ì´ìŠ¤ë¥¼ ì—´ì–´ ë³¼ ë•Œ ê°€ì¥ ë¨¼ì € ë³´ëŠ” ê³³ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ì œ ë°ì´í„° íƒ€ì…ì˜ ì´ë¦„ì€ wtf.User, wtf.Dialë¡œ ìœ„ì—ì„œ ë‚˜ì˜¨ ì´ë¦„ë³´ë‹¤ëŠ” ë” ì ì ˆí•´ ë³´ì…ë‹ˆë‹¤.</p><blockquote><p>I use the root package (wtf) for this purpose as itâ€™s already conveniently named after my application, and itâ€™s the first place new developers look when they open the code base. Our types are now named more appropriately as wtf.User and wtf.Dial.</p></blockquote><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/figure5.png" alt=""></div><p>ì—¬ëŸ¬ë¶„ì€ ì•„ë˜ ì˜ˆì‹œì—ì„œ wtf.Dial íƒ€ì…ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p><blockquote><p>You can see an example of this with the wtf.Dial type:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">go</li></ul></figcaption><div class="tabs-content"><figure class="highlight go" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Dial <span class="keyword">struct</span> {</span><br><span class="line">ID <span class="keyword">int</span> <span class="string">`json:"id"`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Owner of the dial. Only the owner may delete the dial.</span></span><br><span class="line">UserID <span class="keyword">int</span>   <span class="string">`json:"userID"`</span></span><br><span class="line">User   *User <span class="string">`json:"user"`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Human-readable name of the dial.</span></span><br><span class="line">Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Code used to share the dial with other users.</span></span><br><span class="line"><span class="comment">// It allows the creation of a shareable link without</span></span><br><span class="line"><span class="comment">// explicitly inviting users.</span></span><br><span class="line">InviteCode <span class="keyword">string</span> <span class="string">`json:"inviteCode,omitempty"`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Aggregate WTF level for the dial.</span></span><br><span class="line">Value <span class="keyword">int</span> <span class="string">`json:"value"`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Timestamps for dial creation &amp; last update.</span></span><br><span class="line">CreatedAt time.Time <span class="string">`json:"createdAt"`</span></span><br><span class="line">UpdatedAt time.Time <span class="string">`json:"updatedAt"`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// List of associated members and their contributing WTF level.</span></span><br><span class="line"><span class="comment">// This is only set when returning a single dial.</span></span><br><span class="line">Memberships []*DialMembership <span class="string">`json:"memberships,omitempty"`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ìœ„ ì½”ë“œì—ì„œëŠ” ì„¸ë¶€ êµ¬í˜„ì— ëŒ€í•œ ì–´ë– í•œ ì°¸ì¡°ë„ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¨ì§€ Goì˜ ë‚´ì¥ íƒ€ì…ë“¤ê³¼ time.Timeë§Œ ì¡´ì¬í•©ë‹ˆë‹¤. JOSN íƒœê·¸ëŠ” í¸ì˜ë¥¼ ìœ„í•´ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.</p><blockquote><p>In this code, there is no reference to any implementation detailsâ€”just primitive types &amp; time.Time. JSON tags are added for convenience.</p></blockquote><br><h3 id="ì¶”ìƒí™”-ì„œë¹„ìŠ¤ë¥¼-í†µí•œ-ì˜ì¡´ì„±-ì œê±°"><a href="#ì¶”ìƒí™”-ì„œë¹„ìŠ¤ë¥¼-í†µí•œ-ì˜ì¡´ì„±-ì œê±°" class="headerlink" title="ì¶”ìƒí™” ì„œë¹„ìŠ¤ë¥¼ í†µí•œ ì˜ì¡´ì„± ì œê±°"></a>ì¶”ìƒí™” ì„œë¹„ìŠ¤ë¥¼ í†µí•œ ì˜ì¡´ì„± ì œê±°</h3><p>ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì¡°ê°€ ì¡°ê¸ˆì€ ë” ë‚˜ì•„ì§„ê²ƒ ê°™ì•„ ë³´ì´ì§€ë§Œ HTTPê°€ SQLiteì— ì˜ì¡´ì ì´ë¼ëŠ” ê²ƒì€ ì—¬ì „íˆ ì–´ìƒ‰í•©ë‹ˆë‹¤. ìš°ë¦¬ì˜ HTTP ì„œë²„ëŠ” ë°ì´í„° ì €ì¥ ê³µê°„ì´ SQLiteì¸ì§€ ì•„ë‹Œì§€ëŠ” ì‹ ê²½ì“°ì§€ ì•Šê³  ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ê¸°ë¥¼ ì›í•©ë‹ˆë‹¤.</p><blockquote><p>Our application structure is looking better, but itâ€™s still odd that HTTP depends on SQLite. Our HTTP server wants to fetch data from an underlying data storageâ€”it doesnâ€™t specifically care if itâ€™s SQLite or not.</p></blockquote><p>ì´ ë¶€ë¶„ì„ ìˆ˜ì •í•˜ê¸° ìœ„í•´, ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ë‚´ì— ì„œë¹„ìŠ¤ë“¤ì„ ì œê³µí•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±í• ê²ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ë“¤ì€ ì „í˜•ì ì¸ CRUD ì´ì§€ë§Œ ë˜ ë‹¤ë¥¸ ë™ì‘ì„ ìˆ˜í–‰í•˜ë„ë¡ í™•ì¥í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>To fix this, weâ€™ll create interfaces for the services in our business domain. These services are typically Create/Read/Update/Delete (CRUD) but can extend to other operations.</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">go</li></ul></figcaption><div class="tabs-content"><figure class="highlight go" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DialService represents a service for managing dials.</span></span><br><span class="line"><span class="keyword">type</span> DialService <span class="keyword">interface</span> {</span><br><span class="line"><span class="comment">// Retrieves a single dial by ID along with associated memberships. Only</span></span><br><span class="line"><span class="comment">// the dial owner &amp; members can see a dial. Returns ENOTFOUND if dial does</span></span><br><span class="line"><span class="comment">// not exist or user does not have permission to view it.</span></span><br><span class="line">FindDialByID(ctx context.Context, id <span class="keyword">int</span>) (*Dial, error)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Retrieves a list of dials based on a filter. Only returns dials that</span></span><br><span class="line"><span class="comment">// the user owns or is a member of. Also returns a count of total matching</span></span><br><span class="line"><span class="comment">// dials which may different from the number of returned dials if the</span></span><br><span class="line"><span class="comment">// "Limit" field is set.</span></span><br><span class="line">FindDials(ctx context.Context, filter DialFilter) ([]*Dial, <span class="keyword">int</span>, error)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Creates a new dial and assigns the current user as the owner.</span></span><br><span class="line"><span class="comment">// The owner will automatically be added as a member of the new dial.</span></span><br><span class="line">CreateDial(ctx context.Context, dial *Dial) error</span><br><span class="line"></span><br><span class="line"><span class="comment">// Updates an existing dial by ID. Only the dial owner can update a dial.</span></span><br><span class="line"><span class="comment">// Returns the new dial state even if there was an error during update.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Returns ENOTFOUND if dial does not exist. Returns EUNAUTHORIZED if user</span></span><br><span class="line"><span class="comment">// is not the dial owner.</span></span><br><span class="line">UpdateDial(ctx context.Context, id <span class="keyword">int</span>, upd DialUpdate) (*Dial, error)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Permanently removes a dial by ID. Only the dial owner may delete a dial.</span></span><br><span class="line"><span class="comment">// Returns ENOTFOUND if dial does not exist. Returns EUNAUTHORIZED if user</span></span><br><span class="line"><span class="comment">// is not the dial owner.</span></span><br><span class="line">DeleteDial(ctx context.Context, id <span class="keyword">int</span>) error</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ì´ì œ ìš°ë¦¬ì˜ ë„ë©”ì¸ íŒ¨í‚¤ì§€(wtf)ëŠ” ë°ì´í„° êµ¬ì¡°ë¿ë§Œ ì•„ë‹ˆë¼ ê³„ì¸µ ê°„ì˜ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ë°©ì‹ì„ ì •ì˜í•œ ì¸í„°í˜ì´ìŠ¤ë„ êµ¬ì²´í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ ìš°ë¦¬ì˜ íŒ¨í‚¤ì§€ ê³„ì¸µ êµ¬ì¡°ë¥¼ ìˆ˜í‰ì ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ì—ˆìœ¼ë©° ì´ë¥¼ í†µí•´ ì´ì œ ëª¨ë“  íŒ¨í‚¤ì§€ë“¤ì€ ë„ë©”ì¸ íŒ¨í‚¤ì§€ì— ì˜ì¡´í•˜ê²Œë©ë‹ˆë‹¤. ì´ê²ƒì€ íŒ¨í‚¤ì§€ê°„ì˜ ì§ì ‘ì ì¸ ì˜ì¡´ ê´€ê³„ë¥¼ ê¹° ìˆ˜ ìˆë„ë¡ í•´ì£¼ë©° mock íŒ¨í‚¤ì§€ì™€ ê°™ì€ ë¶€ê°€ì ì¸ êµ¬í˜„ë“¤ë„ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.</p><blockquote><p>Now our domain package (wtf) specifies not just the data structures but also the interface contracts for how our layers can communicate with one another. This flattens our package hierarchy so that all packages now depend on the domain package. This lets us break direct dependencies between packages and introduce alternate implementations such as a mock package.</p></blockquote><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/figure6.png" alt=""></div><br><h3 id="íŒ¨í‚¤ì§€ì˜-ì¬íŒ¨í‚¤ì§€í™”"><a href="#íŒ¨í‚¤ì§€ì˜-ì¬íŒ¨í‚¤ì§€í™”" class="headerlink" title="íŒ¨í‚¤ì§€ì˜ ì¬íŒ¨í‚¤ì§€í™”"></a>íŒ¨í‚¤ì§€ì˜ ì¬íŒ¨í‚¤ì§€í™”</h3><p>íŒ¨í‚¤ì§€ê°„ì˜ ì˜ì¡´ì„±ì„ ê¹¨ëŠ”ê²ƒì€ ìš°ë¦¬ê°€ ì‘ì„±í•œ ì½”ë“œë¥¼ ìœ ì—°í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤ë‹ˆë‹¤. ìš°ë¦¬ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ ë°”ì´ë„ˆë¦¬ì¸ wtfdì— ëŒ€í•´ì„  ì—¬ì „íˆ http íŒ¨í‚¤ì§€ê°€ sqliteì— ì˜ì¡´ì ì´ì§€ë§Œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ http íŒ¨í‚¤ì§€ê°€ ìƒˆë¡œìš´ mock íŒ¨í‚¤ì§€ì— ì˜ì¡´í•˜ë„ë¡ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Breaking the dependency between packages allows us flexibility in how we use our code. For our application binary, wtfd, we still want http to depend on sqlite (see wtf/main.go) but for our tests we can change http to depend on our new mock package (see http/server_test.go):</p></blockquote><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/figure7.png" alt=""></div><p>ì´ê²ƒì€ WTF Dialê³¼ ê°™ì€ ì‘ì€ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì¡°ê¸ˆ ì§€ë‚˜ì¹œ ì‘ì—…ì¼ ìˆ˜ ìˆìœ¼ë‚˜ ìš°ë¦¬ê°€ ì†ŒìŠ¤ ì½”ë“œë¥¼ ëŠ˜ë ¤ ë‚˜ê°ì— ìˆì–´ì„œëŠ” ì ì°¨ ì¤‘ìš”í•œ ë¬¸ì œê°€ ë  ê²ë‹ˆë‹¤.</p><blockquote><p>This may be overkill for our small web application, WTF Dial, but it becomes increasingly important as we grow our codebase.</p></blockquote><br><h2 id="ê²°ë¡ "><a href="#ê²°ë¡ " class="headerlink" title="ê²°ë¡ "></a>ê²°ë¡ </h2><p>íŒ¨í‚¤ì§€ëŠ” Go ì–¸ì–´ì—ì„œ ë§¤ìš° ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì—¬ëŸ¬ë¶„ì´ íŒ¨í‚¤ì§€ë¥¼ ê³„ì¸µì´ ì•„ë‹Œ ê·¸ë£¹ìœ¼ë¡œ ë°”ë¼ë³¸ë‹¤ë©´ ëì—†ëŠ” í˜¼ë€ì˜ ì›ì²œì´ê¸°ë„ í•©ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì´ ë§Œë“  ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ë…¼ë¦¬ì ì¸ ê³„ì¸µì„ ì´í•´í•œ í›„ì— ë°ì´í„° íƒ€ì…ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ì„ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¶”ì¶œí•´ë‚¼ ìˆ˜ ìˆìœ¼ë©° ì´ê²ƒë“¤ì„ ë‚˜ë¨¸ì§€ ëª¨ë“  ì„œë¸Œ íŒ¨í‚¤ì§€ë“¤ì´ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë²”ìš©ì ì¸ ë„ë©”ì¸ ì–¸ì–´ë¥¼ ì œê³µí•˜ê¸° ìœ„í•œ ë£¨íŠ¸ íŒ¨í‚¤ì§€ë¡œ ì˜®ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„ë©”ì¸ ì–¸ì–´ë¥¼ ì •ì˜í•˜ëŠ” ê²ƒì€ ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ì—¬ëŸ¬ë¶„ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ ê·œëª¨ë¥¼ í‚¤ì›Œë‚˜ê°€ëŠ”ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤.</p><blockquote><p>Packages are a powerful tool in Go but are the source of endless frustration if you view them as groups instead of layers. After understanding the logical layers of your application, you can extract data types &amp; interface contracts for your business domain and move them into your root package to serve as a common domain language for all subpackages. Defining this domain language is essential to growing your application over time.</p></blockquote><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>reference</strong></p><ul><li><a href="https://www.gobeyond.dev/packages-as-layers/">https://www.gobeyond.dev/packages-as-layers/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/Go/">Go</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/go/">go</category>
      
      <category domain="https://chelseafandev.github.io/tags/golang/">golang</category>
      
      <category domain="https://chelseafandev.github.io/tags/package-layer/">package layer</category>
      
      <category domain="https://chelseafandev.github.io/tags/go-layout/">go layout</category>
      
      <category domain="https://chelseafandev.github.io/tags/organize-go-code/">organize go code</category>
      
      
      <comments>https://chelseafandev.github.io/2022/12/01/translate-packages-as-layers/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ì–´ë– í•œ ë°©ì‹ìœ¼ë¡œ Go ì½”ë“œë¥¼ êµ¬ì¡°í™”í•´ì•¼ í•˜ëŠ”ê°€?</title>
      <link>https://chelseafandev.github.io/2022/09/06/translate-standard-package-layout-in-go/</link>
      <guid>https://chelseafandev.github.io/2022/09/06/translate-standard-package-layout-in-go/</guid>
      <pubDate>Tue, 06 Sep 2022 09:30:58 GMT</pubDate>
      
      <description>&lt;p&gt;ìµœê·¼ íšŒì‚¬ì—ì„œ Go ì–¸ì–´ë¥¼ í™œìš©í•˜ì—¬ ì‹ ê·œ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•  ê¸°íšŒê°€ ìƒê²¼ëŠ”ë° ì¶”í›„ ì½”ë“œì˜ ìœ ì§€ ê´€ë¦¬ë¥¼ ê³ ë ¤í•´ë³¼ ë•Œ Go ì–¸ì–´ì˜ ì†ŒìŠ¤ ì½”ë“œ êµ¬ì¡°ë¥¼ ì–´ë–¤ ì‹ìœ¼ë¡œ í•´ì•¼ í•˜ëŠ”ê°€ì— ëŒ€í•´ ê³ ë¯¼ì´ ìƒê²¼ìŠµë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ìµœê·¼ íšŒì‚¬ì—ì„œ Go ì–¸ì–´ë¥¼ í™œìš©í•˜ì—¬ ì‹ ê·œ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•  ê¸°íšŒê°€ ìƒê²¼ëŠ”ë° ì¶”í›„ ì½”ë“œì˜ ìœ ì§€ ê´€ë¦¬ë¥¼ ê³ ë ¤í•´ë³¼ ë•Œ Go ì–¸ì–´ì˜ ì†ŒìŠ¤ ì½”ë“œ êµ¬ì¡°ë¥¼ ì–´ë–¤ ì‹ìœ¼ë¡œ í•´ì•¼ í•˜ëŠ”ê°€ì— ëŒ€í•´ ê³ ë¯¼ì´ ìƒê²¼ìŠµë‹ˆë‹¤.</p><span id="more"></span><p>êµ¬ê¸€ë§ ì¤‘ì— Go ì–¸ì–´ì˜ ì½”ë“œ êµ¬ì¡°í™”ì— ê´€í•œ ì¢‹ì€ ê¸€ì„ ë°œê²¬í•˜ì—¬ ì‹¤ì œ í”„ë¡œì íŠ¸ì—ë„ ë°˜ì˜í•´ë³¼ ê²¸ í•´ì„œ ë²ˆì—­í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì—­ì‹œë‚˜ ì €ì™€ ê°™ì€ ê³ ë¯¼ì„ ì•ì„œ í•´ì£¼ì‹  ì„ êµ¬ìë‹˜ë“¤ì´ ê³„ì‹œë”ë¼ê³ ìš”ğŸ˜.</p><p>ì›ë¬¸ì˜ ì¼ë¶€ ë‚´ìš©ì€ ë²ˆì—­ì—ì„œ ì œì™¸í–ˆìœ¼ë‹ˆ ì›ë¬¸ì„ ì°¸ê³ í•˜ì‹¤ ë¶„ë“¤ì€ <a href="https://www.gobeyond.dev/standard-package-layout/">í•´ë‹¹ ë§í¬</a>ë¥¼ í™•ì¸í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p><br><!-- toc --><br><h1 id="í‘œì¤€-íŒ¨í‚¤ì§€-ë ˆì´ì•„ì›ƒ"><a href="#í‘œì¤€-íŒ¨í‚¤ì§€-ë ˆì´ì•„ì›ƒ" class="headerlink" title="í‘œì¤€ íŒ¨í‚¤ì§€ ë ˆì´ì•„ì›ƒ"></a>í‘œì¤€ íŒ¨í‚¤ì§€ ë ˆì´ì•„ì›ƒ</h1><p>Vendoring. Generics. ì´ê²ƒë“¤ì€ Go ì»¤ë®¤ë‹ˆí‹° ë‚´ì—ì„œ í° ì´ìŠˆë“¤ë¡œ ë³´ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì¢€ ì²˜ëŸ¼ ì–¸ê¸‰ë˜ì§€ ì•ŠëŠ” ë˜ ë‹¤ë¥¸ ì´ìŠˆê°€ í•˜ë‚˜ ìˆìŠµë‹ˆë‹¤ - ë°”ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ íŒ¨í‚¤ì§€ ë ˆì´ì•„ì›ƒ ì…ë‹ˆë‹¤.</p><blockquote><p>Vendoring. Generics. These are seen as big issues in the Go community but thereâ€™s another issue thatâ€™s rarely mentioned â€” application package layout.</p></blockquote><p>ì œê°€ ì§€ê¸ˆê¹Œì§€ ì‘ì—…í•´ì™”ë˜ ëª¨ë“  Go ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ â€œë‚´ ì½”ë“œë¥¼ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ êµ¬ì¡°í™”í•´ì•¼í•˜ëŠ”ê°€?â€ë¼ëŠ” ì§ˆë¬¸ì— ëŒ€í•œ ê°ê¸° ë‹¤ë¥¸ ëŒ€ë‹µì„ ê°€ì§€ê³  ìˆëŠ”ê²ƒ ì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤. ëª‡ëª‡ ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ì— ëª¨ë“  ê²ƒì„ ë°€ì–´ ë„£ê¸°ë„í•˜ê³  ë˜ ë‹¤ë¥¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ íƒ€ì…ì´ë‚˜ ëª¨ë“ˆ ë‹¨ìœ„ë¡œ ê·¸ë£¹í™”í•˜ê¸°ë„ í•©ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì˜ íŒ€ ì „ë°˜ì— ê±¸ì³ ì ìš©í•  ë§Œí•œ ì¢‹ì€ ì „ëµì´ ì—†ë‹¤ë©´, ì—¬ëŸ¬ë¶„ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ë‹¤ì–‘í•œ íŒ¨í‚¤ì§€ë“¤ì— ê³³ê³³ì— ì½”ë“œê°€ í©ë¿Œë ¤ì§€ê²Œ ë˜ëŠ” ê²ƒì„ ë³´ê²Œ ë  ê²ƒì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” Go ì–´í”Œë¦¬ì¼€ì´ì…˜ ë””ìì¸ì— ì ìš©í•  ìˆ˜ ìˆëŠ” ë”ë‚˜ì€ í‘œì¤€ì´ í•„ìš”í•©ë‹ˆë‹¤.</p><blockquote><p>Every Go application Iâ€™ve ever worked on appears to have a different answer to the question, how should I organize my code? Some applications push everything into one package while others group by type or module. Without a good strategy applied across your team, youâ€™ll find code scattered across various packages of your application. We need a better standard for Go application design.</p></blockquote><p>ì €ëŠ” ë” ë‚˜ì€ ì ‘ê·¼ ë°©ì‹ì„ ì œì•ˆí•˜ê³ ì í•©ë‹ˆë‹¤. ëª‡ê°€ì§€ ë‹¨ìˆœí•œ ê·œì¹™ë“¤ì„ ë”°ë¦„ìœ¼ë¡œì¨ ìš°ë¦¬ëŠ” ì½”ë“œë¥¼ ë¶„ë¦¬ì‹œí‚¤ê³  í…ŒìŠ¤íŠ¸ë¥¼ ìš©ì´í•˜ê²Œ ë§Œë“¤ë©° í”„ë¡œì íŠ¸ì— ì¼ê´€ëœ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ì˜¬ ìˆ˜ ìˆê²Œë©ë‹ˆë‹¤.</p><blockquote><p>I suggest a better approach. By following a few simple rules we can decouple our code, make it easier to test, and bring a consistent structure to our project.</p></blockquote><br><h2 id="1-ê¸°ë³¸-íŒ¨í‚¤ì§€ëŠ”-ë„ë©”ì¸-íƒ€ì…ì„-ìœ„í•œ-íŒ¨í‚¤ì§€ë‹¤"><a href="#1-ê¸°ë³¸-íŒ¨í‚¤ì§€ëŠ”-ë„ë©”ì¸-íƒ€ì…ì„-ìœ„í•œ-íŒ¨í‚¤ì§€ë‹¤" class="headerlink" title="#1. ê¸°ë³¸ íŒ¨í‚¤ì§€ëŠ” ë„ë©”ì¸ íƒ€ì…ì„ ìœ„í•œ íŒ¨í‚¤ì§€ë‹¤"></a>#1. ê¸°ë³¸ íŒ¨í‚¤ì§€ëŠ” ë„ë©”ì¸ íƒ€ì…ì„ ìœ„í•œ íŒ¨í‚¤ì§€ë‹¤</h2><p>ì—¬ëŸ¬ë¶„ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ ë°ì´í„°ì™€ í”„ë¡œì„¸ìŠ¤ë“¤ì´ ì–´ë– í•œ ë°©ì‹ìœ¼ë¡œ ìƒí˜¸ì‘ìš©í•˜ëŠ”ì§€ë¥¼ ê¸°ìˆ í•˜ëŠ” ë…¼ë¦¬ì ì´ê³  ê³ ìˆ˜ì¤€(ì‚¬ëŒì´ ì´í•´í•˜ê¸° ì‰½ê²Œ ì‘ì„±ëœ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ì˜ë¯¸í•¨)ì¸ ì–¸ì–´ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì—¬ëŸ¬ë¶„ì´ eì»¤ë¨¸ìŠ¤ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œ ì¤‘ì´ë¼ë©´ ì—¬ëŸ¬ë¶„ì˜ ë„ë©”ì¸ì€ ê³ ê°, ê³„ì •, ì‹ ìš©ì¹´ë“œ ê²°ì œ, ì¬ê³  ê´€ë¦¬ì™€ ê°™ì€ ê²ƒë“¤ì„ í¬í•¨í•˜ê³  ìˆì„ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ ì—¬ëŸ¬ë¶„ì´ í˜ì´ìŠ¤ë¶ì„ ê°œë°œí•˜ê³  ìˆë‹¤ë©´ ì—¬ëŸ¬ë¶„ì˜ ë„ë©”ì¸ì€ ì‚¬ìš©ì, ì¢‹ì•„ìš”, &amp; relationships(?)ì´ ë ê²ƒ ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ë„ë©”ì¸ì€ ì—¬ëŸ¬ë¶„ì˜ ê·¼ë³¸ì ì¸ ê¸°ìˆ ê³¼ëŠ” ë…ë¦½ì ì¸ ê°œë…ì…ë‹ˆë‹¤.</p><blockquote><p>Your application has a logical, high-level language that describes how data and processes interact. This is your domain. If you have an e-commerce application your domain involves things like customers, accounts, charging credit cards, and handling inventory. If youâ€™re Facebook then your domain is users, likes, &amp; relationships. Itâ€™s the stuff that doesnâ€™t depend on your underlying technology.</p></blockquote><p>ì €ëŠ” ë„ë©”ì¸ íƒ€ì…ì„ í”„ë¡œì íŠ¸ì˜ ê¸°ë³¸(root) íŒ¨í‚¤ì§€ì— ìœ„ì¹˜ì‹œí‚µë‹ˆë‹¤. ê¸°ë³¸ íŒ¨í‚¤ì§€ëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” User êµ¬ì¡°ì²´ë‚˜ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì§€ê³  ì˜¤ê±°ë‚˜ ì €ì¥í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ” UserService ì¸í„°í˜ì´ìŠ¤ì™€ ê°™ì€ ë‹¨ìˆœí•œ ë°ì´í„° íƒ€ì…ë“¤ë§Œì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>I place my domain types in my root package. This package only contains simple data types like a User struct for holding user data or a UserService interface for fetching or saving user data.</p></blockquote><p>ê¸°ë³¸ íŒ¨í‚¤ì§€ëŠ” ì•„ë˜ì™€ ê°™ì€ êµ¬ì¡°ë¥¼ ë³´ì¼ ìˆ˜ ìˆì„ê²ë‹ˆë‹¤:</p><blockquote><p>It may look something like:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">go</li></ul></figcaption><div class="tabs-content"><figure class="highlight go" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> myapp</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">ID      <span class="keyword">int</span></span><br><span class="line">Name    <span class="keyword">string</span></span><br><span class="line">Address Address</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">interface</span> {</span><br><span class="line">User(id <span class="keyword">int</span>) (*User, error)</span><br><span class="line">Users() ([]*User, error)</span><br><span class="line">CreateUser(u *User) error</span><br><span class="line">DeleteUser(id <span class="keyword">int</span>) error</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ì´ê²ƒì€ ì—¬ëŸ¬ë¶„ì˜ ê¸°ë³¸ íŒ¨í‚¤ì§€ë¥¼ ë§¤ìš° ë‹¨ìˆœí•˜ê²Œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. ë˜í•œ ì—¬ëŸ¬ë¶„ì€ ë‹¤ë¥¸ ë„ë©”ì¸ íƒ€ì…ì— ì˜ì¡´í•˜ëŠ” ê²½ìš°ì—ë§Œ ë™ì‘ì„ ìˆ˜í–‰í•˜ë„ë¡ í•˜ëŠ” íƒ€ì…ë“¤ì„ í¬í•¨í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì—¬ëŸ¬ë¶„ì´ UserServiceë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í´ë§(polling)í•˜ëŠ” íŠ¹ì • íƒ€ì…ì„ í¬í•¨ì‹œì¼œì•¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì™¸ë¶€ ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•´ì„œëŠ” ì•ˆë©ë‹ˆë‹¤. ê·¸ê²ƒì€ ì„¸ë¶€ì ì¸ êµ¬í˜„ ì‚¬í•­ì…ë‹ˆë‹¤.</p><blockquote><p>This makes your root package extremely simple. You may also include types that perform actions but only if they solely depend on other domain types. For example, you could have a type that polls your UserService periodically. However, it should not call out to external services or save to a database. That is an implementation detail.</p></blockquote><p><em>ê¸°ë³¸ íŒ¨í‚¤ì§€ëŠ” ì—¬ëŸ¬ë¶„ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì¡´ì¬í•˜ëŠ” ì–´ë– í•œ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ì—ë„ ì˜ì¡´ì ì´ì–´ì„  ì•ˆë©ë‹ˆë‹¤!</em></p><blockquote><p><em>The root package should not depend on any other package in your application!</em></p></blockquote><br><h2 id="2-ì˜ì¡´ì„±ì—-ë”°ë¼-í•˜ìœ„íŒ¨í‚¤ì§€ë¥¼-ê·¸ë£¹í™”í•˜ë¼"><a href="#2-ì˜ì¡´ì„±ì—-ë”°ë¼-í•˜ìœ„íŒ¨í‚¤ì§€ë¥¼-ê·¸ë£¹í™”í•˜ë¼" class="headerlink" title="#2. ì˜ì¡´ì„±ì— ë”°ë¼ í•˜ìœ„íŒ¨í‚¤ì§€ë¥¼ ê·¸ë£¹í™”í•˜ë¼"></a>#2. ì˜ì¡´ì„±ì— ë”°ë¼ í•˜ìœ„íŒ¨í‚¤ì§€ë¥¼ ê·¸ë£¹í™”í•˜ë¼</h2><p>ë§Œì•½ ê¸°ë³¸ íŒ¨í‚¤ì§€ê°€ ì™¸ë¶€ ì˜ì¡´ì„±ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì´ëŸ¬í•œ ì˜ì¡´ì„±ë“¤ì„ í•˜ìœ„íŒ¨í‚¤ì§€ì— ì¶”ê°€í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì ‘ê·¼ ë°©ì‹ì—ì„œëŠ” í•˜ìœ„íŒ¨í‚¤ì§€ê°€ ë„ë©”ì¸ê³¼ êµ¬í˜„(implementation)ì‚¬ì´ì˜ ì–´ëŒ‘í„°ë¡œì„œ ì¡´ì¬í•˜ê²Œ ë©ë‹ˆë‹¤.</p><blockquote><p>If your root package is not allowed to have external dependencies then we must push those dependencies to subpackages. In this approach to package layout, subpackages exist as an adapter between your domain and your implementation.</p></blockquote><p>ì˜ˆë¥¼ ë“¤ì–´, ì—¬ëŸ¬ë¶„ì˜ UserServiceê°€ PostgreSQLì„ ì§€ì›í•´ì•¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë•Œ ì—¬ëŸ¬ë¶„ì€ postgres.UserServiceì— ëŒ€í•œ ì„¸ë¶€ êµ¬í˜„ì„ ì œê³µí•˜ëŠ” postgres í•˜ìœ„íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p><blockquote><p>For example, your UserService might be backed by PostgreSQL. You can introduce a postgres subpackage in your application that provides a postgres.UserService implementation:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">go</li></ul></figcaption><div class="tabs-content"><figure class="highlight go" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> postgres</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"database/sql"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/benbjohnson/myapp"</span></span><br><span class="line">_ <span class="string">"github.com/lib/pq"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserService represents a PostgreSQL implementation of myapp.UserService.</span></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">struct</span> {</span><br><span class="line">DB *sql.DB</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// User returns a user for a given id.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *UserService)</span> <span class="title">User</span><span class="params">(id <span class="keyword">int</span>)</span> <span class="params">(*myapp.User, error)</span></span> {</span><br><span class="line"><span class="keyword">var</span> u myapp.User</span><br><span class="line">row := db.QueryRow(<span class="string">`SELECT id, name FROM users WHERE id = $1`</span>, id)</span><br><span class="line"><span class="keyword">if</span> row.Scan(&amp;u.ID, &amp;u.Name); err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> &amp;u, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// implement remaining myapp.UserService interface...</span></span><br></pre></td></tr></tbody></table></figure></div></figure><p>ì´ê²ƒì€ PostgreSQL ì˜ì¡´ì„±ì„ ë¶„ë¦¬í•˜ê²Œë˜ëŠ”ë° ì´ëŸ¬í•œ ì˜ì¡´ì„±ì˜ ë¶„ë¦¬ëŠ” í…ŒìŠ¤íŠ¸ ê³¼ì •ì„ ë‹¨ìˆœí™”ì‹œì¼œì£¼ê³  ì¶”í›„ ë˜ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê¸° ìœ„í•œ ì‰¬ìš´ ë°©ì‹ì„ ì œê³µí•©ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì´ BoltDBì™€ ê°™ì€ ë˜ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì„¸ë¶€ êµ¬í˜„ì„ ì§€ì›í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤ë©´ ì´ê²ƒì€ í”ŒëŸ¬ê·¸í˜• êµ¬ì¡°ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>This isolates our PostgreSQL dependency which simplifies testing and provides an easy way to migrate to another database in the future. It can be used as a pluggable architecture if you decide to support other database implementations such as BoltDB.</p></blockquote><p>ì´ê²ƒì€ ë˜í•œ êµ¬í˜„ì„ ê³„ì¸µí™”í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤. ì•„ë§ˆë„ ì—¬ëŸ¬ë¶„ì€ PostgreSQL ì•ì— LRU ìºì‹œë¥¼ ë‘ì–´ ë°ì´í„°ë¥¼ ë©”ëª¨ìƒì— ë³´ê´€í•˜ê¸°ë¥¼ ì›í•  ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ PostgreSQL ì„¸ë¶€ êµ¬í˜„ì„ ë˜í•‘(wrapping)í•  ìˆ˜ ìˆëŠ” UserServiceë¥¼ êµ¬í˜„í•˜ëŠ” UserCacheë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>It also gives you a way to layer implementations. Perhaps you want to hold an in-memory, LRU cache in front of PostgreSQL. You can add a UserCache that implements UserService which can wrap your PostgreSQL implementation:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">go</li></ul></figcaption><div class="tabs-content"><figure class="highlight go" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> myapp</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserCache wraps a UserService to provide an in-memory cache.</span></span><br><span class="line"><span class="keyword">type</span> UserCache <span class="keyword">struct</span> {</span><br><span class="line">cache   <span class="keyword">map</span>[<span class="keyword">int</span>]*User</span><br><span class="line">service UserService</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewUserCache returns a new read-through cache for service.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewUserCache</span><span class="params">(service UserService)</span> *<span class="title">UserCache</span></span> {</span><br><span class="line"><span class="keyword">return</span> &amp;UserCache{</span><br><span class="line">cache: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]*User),</span><br><span class="line">service: service,</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// User returns a user for a given id.</span></span><br><span class="line"><span class="comment">// Returns the cached instance if available.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *UserCache)</span> <span class="title">User</span><span class="params">(id <span class="keyword">int</span>)</span> <span class="params">(*User, error)</span></span> {</span><br><span class="line"><span class="comment">// Check the local cache first.</span></span><br><span class="line"><span class="keyword">if</span> u := c.cache[id]; u != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> u, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Otherwise fetch from the underlying service.</span></span><br><span class="line">u, err := c.service.User(id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> u != <span class="literal">nil</span> {</span><br><span class="line">c.cache[id] = u</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> u, err</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>Golangì˜ ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì—ì„œë„ ì´ëŸ¬í•œ ì ‘ê·¼ ë°©ì‹ì„ ì‚´í´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. io.ReaderëŠ” ë°”ì´íŠ¸ë¥¼ ì½ì–´ë“¤ì´ê¸° ìœ„í•œ ë„ë©”ì¸ íƒ€ì…ì´ê³  ê·¸ê²ƒì˜ ì„¸ë¶€ êµ¬í˜„ë“¤ì€ ì˜ì¡´ì„±ì— ì˜í•´ ê·¸ë£¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤ - tar.Reader, gzip.Reader, multipart.Reader. ì´ê²ƒë“¤ ë˜í•œ ê³„ì¸µí™”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. os.Fileì€ bufio.Readerì— ì˜í•´ ë˜í•‘ë˜ì–´ìˆê³  ì´ bufio.ReaderëŠ” gzip.Readerì— ì˜í•´ ë˜í•‘ë˜ì–´ìˆìœ¼ë©° gzip.ReaderëŠ” tar.Readerì— ì˜í•´ ë˜í•‘ë˜ì–´ìˆëŠ” ì´ëŸ¬í•œ ëª¨ìŠµë“¤ì€ í”íˆ ë³´ì´ëŠ” ê³„ì¸µ êµ¬ì¡°ë“¤ì…ë‹ˆë‹¤.</p><blockquote><p>We see this approach in the standard library too. The io.Reader is a domain type for reading bytes and its implementations are grouped by dependency â€” tar.Reader, gzip.Reader, multipart.Reader. These can be layered as well. Itâ€™s common to see an os.File wrapped by a bufio.Reader which is wrapped by a gzip.Reader which is wrapped by a tar.Reader.</p></blockquote><br><h3 id="ì˜ì¡´ì„±-ê°„ì˜-ì˜ì¡´ì„±"><a href="#ì˜ì¡´ì„±-ê°„ì˜-ì˜ì¡´ì„±" class="headerlink" title="ì˜ì¡´ì„± ê°„ì˜ ì˜ì¡´ì„±"></a>ì˜ì¡´ì„± ê°„ì˜ ì˜ì¡´ì„±</h3><p>ì—¬ëŸ¬ë¶„ì˜ ì˜ì¡´ì„±ì€ í™€ë¡œ ê³ ë¦½ëœ ì±„ë¡œ ì‚´ì•„ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. User ë°ì´í„°ëŠ” PostgreSQLì— ì €ì¥ì„ í•˜ê³  ì¬ë¬´ì™€ ê´€ë ¨ëœ íŠ¸ëœì­ì…˜ ë°ì´í„°ëŠ” Stripeì™€ ê°™ì€ 3rd party ì„œë¹„ìŠ¤ì— ì €ì¥í•´ì•¼í•˜ëŠ” ê²½ìš°ê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ìš°ì—ëŠ” Stripeê°€ ë…¼ë¦¬ì ì¸ ë„ë©”ì¸ íƒ€ì…ê³¼ í•¨ê»˜ ë¬¶ì´ê²Œ ë©ë‹ˆë‹¤ - ì´ê²ƒì„ TranscationServiceë¼ê³  ë¶€ë¥´ê¸°ë¡œ í•˜ê² ìŠµë‹ˆë‹¤.</p><blockquote><p>Your dependencies donâ€™t live in isolation. You may store User data in PostgreSQL but your financial transaction data exists in a third party service like Stripe. In this case we wrap our Stripe dependency with a logical domain type â€” letâ€™s call it TransactionService.</p></blockquote><p>UserServiceì— TransactionServiceë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ìš°ë¦¬ëŠ” ì´ ë‘ê°€ì§€ ì˜ì¡´ì„±ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>By adding our TransactionService to our UserService we decouple our two dependencies:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">go</li></ul></figcaption><div class="tabs-content"><figure class="highlight go" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UserService <span class="keyword">struct</span> {</span><br><span class="line">DB                 *sql.DB</span><br><span class="line">TransactionService myapp.TransactionService</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ì´ì œ ìš°ë¦¬ì˜ ì˜ì¡´ì„±ë“¤ì€ ì˜¤ì§ ê³µí†µëœ ë„ë©”ì¸ ì–¸ì–´ë¥¼ í†µí•´ì„œë§Œ ì†Œí†µí•˜ê²Œ ë©ë‹ˆë‹¤. ì´ê²ƒì€ ìš°ë¦¬ê°€ ë‹¤ë¥¸ ì˜ì¡´ì„±ë“¤ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê³  PostgreSQLì„ MySQLë¡œ Stripeë¥¼ ë˜ ë‹¤ë¥¸ ì§€ë¶ˆ í”„ë¡œì„¸ì„œë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p><blockquote><p>Now our dependencies communicate solely through our common domain language. This means that we could swap out PostgreSQL for MySQL or switch Stripe for another payment processor without affecting other dependencies.</p></blockquote><br><h3 id="ì´ëŸ¬í•œ-ì ‘ê·¼-ë°©ì‹ì„-3rd-party-ì˜ì¡´ì„±ì—ë§Œ-êµ­í•œ-ì‹œí‚¤ì§€ë§ˆë¼"><a href="#ì´ëŸ¬í•œ-ì ‘ê·¼-ë°©ì‹ì„-3rd-party-ì˜ì¡´ì„±ì—ë§Œ-êµ­í•œ-ì‹œí‚¤ì§€ë§ˆë¼" class="headerlink" title="ì´ëŸ¬í•œ ì ‘ê·¼ ë°©ì‹ì„ 3rd party ì˜ì¡´ì„±ì—ë§Œ êµ­í•œ ì‹œí‚¤ì§€ë§ˆë¼"></a>ì´ëŸ¬í•œ ì ‘ê·¼ ë°©ì‹ì„ 3rd party ì˜ì¡´ì„±ì—ë§Œ êµ­í•œ ì‹œí‚¤ì§€ë§ˆë¼</h3><p>3rd party ì˜ì¡´ì„±ì—ë§Œ êµ­í•œ ì‹œí‚¤ì§€ë§ë¼ëŠ” ë§ì´ ì´ìƒí•˜ê²Œ ë“¤ë¦´ ìˆ˜ ìˆì§€ë§Œ ì´ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ Golangì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê³ ë¦½ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, net/http íŒ¨í‚¤ì§€ëŠ” ë‹¨ì§€ ë˜ ë‹¤ë¥¸ ì˜ì¡´ì„±ì…ë‹ˆë‹¤. ìš°ë¦¬ê°€ ë§Œë“  ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì¡´ì¬í•˜ëŠ” http ë¼ëŠ” í•˜ìœ„íŒ¨í‚¤ì§€ì— ì´ net/http íŒ¨í‚¤ì§€ë¥¼  ì¶”ê°€í•¨ìœ¼ë¡œì¨ ê³ ë¦½ëœ í™˜ê²½ì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>This may sound odd but I also isolate my standard library dependencies with this same method. For instance, the net/http package is just another dependency. We can isolate it as well by including an http subpackage in our application.</p></blockquote><p>í•´ë‹¹ íŒ¨í‚¤ì§€ì˜ ì´ë¦„ì´ ê·¸ê²ƒì´ ê°ì‹¸ê³  ìˆëŠ” ì˜ì¡´ì„±ê³¼ ë™ì¼í•œ ì´ë¦„ì„ ê°–ëŠ”ë‹¤ëŠ” ê²ƒì´ ì´ìƒí•  ìˆ˜ ìˆì§€ë§Œ ì´ê²ƒì€ ì˜ë„ëœ ê²ƒì…ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì´ ë§Œë“  ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ë‹¤ë¥¸ ì–´ë– í•œ ëª¨ë“ˆë“¤ì—ì„œë„ net/http íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ê³³ì´ ì—†ë‹¤ë©´ íŒ¨í‚¤ì§€ ì´ë¦„ ì¶©ëŒì´ ë°œìƒí•  ì¼ì€ ì—†ìŠµë‹ˆë‹¤. ì´ë¦„ì„ ì¤‘ë³µì‹œí‚´ìœ¼ë¡œ ì–»ì„ ìˆ˜ ìˆëŠ” ì´ì ì€ ì´ë¥¼ í†µí•´ ì—¬ëŸ¬ë¶„ì´ HTTPì™€ ê´€ë ¨ëœ ëª¨ë“  ì½”ë“œë“¤ì€ ìƒˆë¡­ê²Œ ë§Œë“  http íŒ¨í‚¤ì§€ì— í¬í•¨ë˜ë„ë¡ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>It might seem odd to have a package with the same name as the dependency it wraps, however, this is intentional. There are no package name conflicts in your application unless you allow net/http to be used in other parts of your application. The benefit to duplicating the name is that it requires you to isolate all HTTP code to your http package.</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">go</li></ul></figcaption><div class="tabs-content"><figure class="highlight go" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> http</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/benbjohnson/myapp"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Handler <span class="keyword">struct</span> {</span><br><span class="line">UserService myapp.UserService</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line"><span class="comment">// handle request</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ì´ì œ ìš°ë¦¬ê°€ ë§Œë“  http.HandlerëŠ” ë„ë©”ì¸ê³¼ HTTP í”„ë¡œí† ì½œ ê°„ ì–´ëŒ‘í„°ë¡œì„œì˜ ì—­í• ì„ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.</p><blockquote><p>Now your http.Handler acts as an adapter between your domain and the HTTP protocol.</p></blockquote><br><h2 id="3-ê³µìœ ëœ-mock-í•˜ìœ„íŒ¨í‚¤ì§€ë¥¼-ì‚¬ìš©í•˜ë¼"><a href="#3-ê³µìœ ëœ-mock-í•˜ìœ„íŒ¨í‚¤ì§€ë¥¼-ì‚¬ìš©í•˜ë¼" class="headerlink" title="#3. ê³µìœ ëœ mock í•˜ìœ„íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ë¼"></a>#3. ê³µìœ ëœ mock í•˜ìœ„íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ë¼</h2><p>ìš°ë¦¬ì˜ ì˜ì¡´ì„±ë“¤ì€ ë„ë©”ì¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ë‹¤ë¥¸ ì˜ì¡´ì„±ë“¤ê³¼ ë¶„ë¦¬ë˜ì–´ ìˆê¸°ë–„ë¬¸ì— ìš°ë¦¬ëŠ” mock êµ¬í˜„ì„ ì£¼ì…í•˜ê¸° ìœ„í•´ ì´ëŸ¬í•œ ì—°ê²° ì§€ì ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Because our dependencies are isolated from other dependencies by our domain interfaces, we can use these connection points to inject mock implementations.</p></blockquote><p>ì—¬ëŸ¬ë¶„ì—ê²Œ mockë¥¼ ìƒì„±í•´ì£¼ëŠ” GoMockê³¼ ê°™ì€ mocking ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ëª‡ê°€ì§€ ìˆì§€ë§Œ ì €ëŠ” ê°œì¸ì ìœ¼ë¡œ ê·¸ê²ƒë“¤ì„ ì§ì ‘ ì‘ì„±í•˜ëŠ”ê²ƒì„ ì„ í˜¸í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ mocking ë„êµ¬ë“¤ì€ ë„ˆë¬´ ë³µì¡í•˜ê²Œ ë˜ì–´ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>There are several mocking libraries such as GoMock that will generate mocks for you but I personally prefer to just write them myself. I find many of the mocking tools to be overly complicated.</p></blockquote><p>ì œê°€ ì‚¬ìš©í•˜ëŠ” mocksëŠ” ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, UserServiceë¥¼ ìœ„í•œ mockì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤:</p><blockquote><p>The mocks I use are very simple. For example, a mock for the UserService looks like:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">go</li></ul></figcaption><div class="tabs-content"><figure class="highlight go" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"github.com/benbjohnson/myapp"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// UserService represents a mock implementation of myapp.UserService.</span></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">struct</span> {</span><br><span class="line">UserFn      <span class="function"><span class="keyword">func</span><span class="params">(id <span class="keyword">int</span>)</span> <span class="params">(*myapp.User, error)</span></span></span><br><span class="line">UserInvoked <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">UsersFn     <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">([]*myapp.User, error)</span></span></span><br><span class="line">UsersInvoked <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// additional function implementations...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// User invokes the mock implementation and marks the function as invoked.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *UserService)</span> <span class="title">User</span><span class="params">(id <span class="keyword">int</span>)</span> <span class="params">(*myapp.User, error)</span></span> {</span><br><span class="line">s.UserInvoked = <span class="literal">true</span></span><br><span class="line"><span class="keyword">return</span> s.UserFn(id)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// additional functions: Users(), CreateUser(), DeleteUser()</span></span><br></pre></td></tr></tbody></table></figure></div></figure><p>ì´ mockì€ ì¸ìë“¤ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê±°ë‚˜ ê¸°ëŒ€ëœ ë°ì´í„°ê°€ ë°˜í™˜ë˜ëŠ”ì§€ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì‹¤íŒ¨í•˜ëŠ” ì¼€ì´ìŠ¤ë¥¼ ì£¼ì…í•´ë³´ê¸° ìœ„í•´ myapp.UserService ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸°ë§Œ í•œë‹¤ë©´ ì–´ëŠ ê³³ì´ë“  í•¨ìˆ˜ë“¤ì„ ì£¼ì…í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>This mock lets me inject functions into anything that uses the myapp.UserService interface to validate arguments, return expected data, or inject failures.</p></blockquote><p>ì˜ˆë¥¼ ë“¤ì–´ ìœ„ì—ì„œ ë§Œë“¤ì–´ ë³¸ http.Handlerë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ì›í•œë‹¤ê³  í•´ë´…ì‹œë‹¤:</p><blockquote><p>Letâ€™s say we want to test our http.Handler that we built above:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">go</li></ul></figcaption><div class="tabs-content"><figure class="highlight go" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> http_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line"><span class="string">"net/http/httptest"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/benbjohnson/myapp/mock"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestHandler</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line"><span class="comment">// Inject our mock into our handler.</span></span><br><span class="line"><span class="keyword">var</span> us mock.UserService</span><br><span class="line"><span class="keyword">var</span> h Handler</span><br><span class="line">h.UserService = &amp;us</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mock our User() call.</span></span><br><span class="line">us.UserFn = <span class="function"><span class="keyword">func</span><span class="params">(id <span class="keyword">int</span>)</span> <span class="params">(*myapp.User, error)</span></span> {</span><br><span class="line"><span class="keyword">if</span> id != <span class="number">100</span> {</span><br><span class="line">t.Fatalf(<span class="string">"unexpected id: %d"</span>, id)</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> &amp;myapp.User{ID: <span class="number">100</span>, Name: <span class="string">"susy"</span>}, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Invoke the handler.</span></span><br><span class="line">w := httptest.NewRecorder()</span><br><span class="line">r, _ := http.NewRequest(<span class="string">"GET"</span>, <span class="string">"/users/100"</span>, <span class="literal">nil</span>)</span><br><span class="line">h.ServeHTTP(w, r)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Validate mock.</span></span><br><span class="line"><span class="keyword">if</span> !us.UserInvoked {</span><br><span class="line">t.Fatal(<span class="string">"expected User() to be invoked"</span>)</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>mockëŠ” ìœ ë‹› í…ŒìŠ¤íŠ¸ì™€ HTTP í”„ë¡œí† ì½œì˜ ì²˜ë¦¬ë¶€ë¶„ì´ ì™„ì „íˆ ë¶„ë¦¬ë  ìˆ˜ ìˆë„ë¡ í•´ì¤ë‹ˆë‹¤.</p><blockquote><p>Our mock lets us completely isolate our unit test to only the handling of the HTTP protocol.</p></blockquote><br><h2 id="4-ë©”ì¸-íŒ¨í‚¤ì§€ëŠ”-ì˜ì¡´ì„±ë“¤ì„-í•˜ë‚˜ë¡œ-ì—®ëŠ”ë‹¤"><a href="#4-ë©”ì¸-íŒ¨í‚¤ì§€ëŠ”-ì˜ì¡´ì„±ë“¤ì„-í•˜ë‚˜ë¡œ-ì—®ëŠ”ë‹¤" class="headerlink" title="#4. ë©”ì¸ íŒ¨í‚¤ì§€ëŠ” ì˜ì¡´ì„±ë“¤ì„ í•˜ë‚˜ë¡œ ì—®ëŠ”ë‹¤"></a>#4. ë©”ì¸ íŒ¨í‚¤ì§€ëŠ” ì˜ì¡´ì„±ë“¤ì„ í•˜ë‚˜ë¡œ ì—®ëŠ”ë‹¤</h2><p>ì´ëŸ¬í•œ ëª¨ë“  ì˜ì¡´ì„± íŒ¨í‚¤ì§€ë“¤ì´ ê³ ë¦½ëœ ì±„ë¡œ ë– ë‹¤ë‹ˆê²Œ ëœë‹¤ë©´ ì´ë“¤ì„ ì–´ë–»ê²Œ í•˜ë‚˜ë¡œ ê²°í•©í•  ìˆ˜ ìˆì„ì§€ ê¶ê¸ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì—­í• ì„ í•˜ëŠ” ê²ƒì´ ë©”ì¸ íŒ¨í‚¤ì§€ ì…ë‹ˆë‹¤.</p><blockquote><p>With all these dependency packages floating around in isolation, you may wonder how they all come together. Thatâ€™s the job of the main package.</p></blockquote><br><h3 id="ë©”ì¸-íŒ¨í‚¤ì§€-ë ˆì´ì•„ì›ƒ"><a href="#ë©”ì¸-íŒ¨í‚¤ì§€-ë ˆì´ì•„ì›ƒ" class="headerlink" title="ë©”ì¸ íŒ¨í‚¤ì§€ ë ˆì´ì•„ì›ƒ"></a>ë©”ì¸ íŒ¨í‚¤ì§€ ë ˆì´ì•„ì›ƒ</h3><p>ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ 2ê°œ ì´ìƒì˜ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ ìƒì„±í•  ìˆ˜ë„ ìˆëŠ”ë° ì´ë¥¼ ìœ„í•´ ë©”ì¸ íŒ¨í‚¤ì§€ë¥¼ cmd íŒ¨í‚¤ì§€ì˜ í•˜ìœ„ ë””ë ‰í† ë¦¬ë¡œ ë‘ëŠ” Go ì–¸ì–´ì˜ ê´€ìŠµ(convention)ì„ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìš°ë¦¬ í”„ë¡œì íŠ¸ê°€ myapp ì´ë¼ëŠ” ì„œë²„ ë°”ì´ë„ˆë¦¬ë¿ë§Œ ì•„ë‹ˆë¼ í„°ë¯¸ë„ì„ í†µí•´ ì„œë²„ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” myappctl ì´ë¼ëŠ” í´ë¼ì´ì–¸íŠ¸ ë°”ì´ë„ˆë¦¬ë„ ê°–ê³ ìˆë‹¤ê³  í•´ë´…ì‹œë‹¤. ìš°ë¦¬ì˜ ë©”ì¸ íŒ¨í‚¤ì§€ë¥¼ ì•„ë˜ì™€ ê°™ì´ êµ¬ì„±í•˜ê²Œ ë  ê²ƒì…ë‹ˆë‹¤:</p><blockquote><p>An application may produce multiple binaries so weâ€™ll use the Go convention of placing our main package as a subdirectory of the cmd package. For example, our project may have a myapp server binary but also a myappctl client binary for managing the server from the terminal. Weâ€™ll layout our main packages like this:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">myapp/</span><br><span class="line">    cmd/</span><br><span class="line">        myapp/</span><br><span class="line">            main.go</span><br><span class="line">        myappctl/</span><br><span class="line">            main.go</span><br></pre></td></tr></table></figure><br><h3 id="ì»´íŒŒì¼-íƒ€ì„ì—-ì˜ì¡´ì„±-ì£¼ì…"><a href="#ì»´íŒŒì¼-íƒ€ì„ì—-ì˜ì¡´ì„±-ì£¼ì…" class="headerlink" title="ì»´íŒŒì¼ íƒ€ì„ì— ì˜ì¡´ì„± ì£¼ì…"></a>ì»´íŒŒì¼ íƒ€ì„ì— ì˜ì¡´ì„± ì£¼ì…</h3><p>â€œì˜ì¡´ì„± ì£¼ì…â€ì´ë¼ëŠ” ìš©ì–´ëŠ” ë‚˜ìœ í‰íŒì„ ë°›ì•„ì™”ìŠµë‹ˆë‹¤. ì´ê²ƒì€ ì¥í™©í•œ Spring XML íŒŒì¼ì— ëŒ€í•œ ìƒê°ì„ ë¶ˆëŸ¬ì¼ìœ¼ í‚µë‹ˆë‹¤. í•˜ì§€ë§Œ ê·¸ ìš©ì–´ì˜ ì‹¤ì œ ì˜ë¯¸ëŠ” ìš°ë¦¬ëŠ” ê°ì²´ì—ê²Œ ìŠ¤ìŠ¤ë¡œ ë¹Œë“œí•˜ê±°ë‚˜ ì˜ì¡´ì„±ì„ ì§ì ‘ ì°¾ì•„ê°€ëŠ” ê²ƒì„ ìš”êµ¬í•˜ëŠ” ëŒ€ì‹ ì— ê°ì²´ì—ê²Œ ì˜ì¡´ì„±ì„ ì§ì ‘ ì „ë‹¬í•´ì¤„ ê²ƒì´ë‹¤ë¼ëŠ” ê²ƒì´ ì „ë¶€ì…ë‹ˆë‹¤.</p><blockquote><p>The term â€œdependency injectionâ€ has gotten a bad rap. It conjures up thoughts of verbose Spring XML files. However, all the term really means is that weâ€™re going to pass dependencies to our objects instead of requiring that the object build or find the dependency itself.</p></blockquote><p>ë©”ì¸ íŒ¨í‚¤ì§€ëŠ” ì–´ë–¤ ì˜ì¡´ì„±ì„ ì–´ë–¤ ê°ì²´ì—ê²Œ ì£¼ì…í•  ê²ƒì¸ì§€ë¥¼ ì„ íƒí•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ë©”ì¸ íŒ¨í‚¤ì§€ëŠ” ë‹¨ìˆœíˆ ì´ëŸ¬í•œ ì¡°ê°ë“¤ì„ ì´ì–´ ë¶™ì´ëŠ” ì—­í• ë§Œì„ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œì˜ ê·œëª¨ê°€ ì‘ê³  ì‚¬ì†Œí•œ ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤:</p><blockquote><p>The main package is what gets to choose which dependencies to inject into which objects. Because the main package simply wires up the pieces, it tends to be fairly small and trivial code:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">go</li></ul></figcaption><div class="tabs-content"><figure class="highlight go" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"log"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/benbjohnson/myapp"</span></span><br><span class="line"><span class="string">"github.com/benbjohnson/myapp/postgres"</span></span><br><span class="line"><span class="string">"github.com/benbjohnson/myapp/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"><span class="comment">// Connect to database.</span></span><br><span class="line">db, err := postgres.Open(os.Getenv(<span class="string">"DB"</span>))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">log.Fatal(err)</span><br><span class="line">}</span><br><span class="line"><span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create services.</span></span><br><span class="line">us := &amp;postgres.UserService{DB: db}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Attach to HTTP handler.</span></span><br><span class="line"><span class="keyword">var</span> h http.Handler</span><br><span class="line">h.UserService = us</span><br><span class="line"></span><br><span class="line"><span class="comment">// start http server...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ì—¬ëŸ¬ë¶„ì˜ ë©”ì¸ íŒ¨í‚¤ì§€ ë˜í•œ ì–´ëŒ‘í„°ì˜ ì—­í• ì„ í•œë‹¤ëŠ” ê²ƒë„ ì¤‘ìš”í•œ ì ì…ë‹ˆë‹¤. ë©”ì¸ íŒ¨í‚¤ì§€ëŠ” í„°ë¯¸ë„ê³¼ ì—¬ëŸ¬ë¶„ì˜ ë„ë©”ì¸ì„ ì—°ê²°í•´ì¤ë‹ˆë‹¤.</p><blockquote><p>Itâ€™s also important to note that your main package is also an adapter. It connects the terminal to your domain.</p></blockquote><br><h2 id="ê²°ë¡ "><a href="#ê²°ë¡ " class="headerlink" title="ê²°ë¡ "></a>ê²°ë¡ </h2><p>ì–´í”Œë¦¬ì¼€ì´ì…˜ ë””ìì¸ì€ ë§¤ìš° ì–´ë ¤ìš´ ë¬¸ì œì…ë‹ˆë‹¤. ë„ˆë¬´ë‚˜ ë§ì€ ë””ìì¸ ê²°ì •ë“¤ì´ ì¡´ì¬í•˜ê³  ì—¬ëŸ¬ë¶„ì—ê²Œ ê°€ì´ë“œí•´ì¤„ ê²¬ê³ í•œ ì´ë¡ ë“¤ì˜ ë¶€ì¬ëŠ” ë¬¸ì œë¥¼ ë”ìš± ì‹¬ê°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” Go ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í˜„ì¬ ì‚¬ìš©ë˜ëŠ” ëª‡ê°€ì§€ ì ‘ê·¼ ë°©ì‹ì„ ì‚´í´ë³´ì•˜ê³  ê·¸ê²ƒë“¤ì˜ ë§ì€ ê²°í•¨ë“¤ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.</p><blockquote><p>Application design is a hard problem. There are so many design decisions to make and without a set of solid principles to guide you the problem is made even worse. Weâ€™ve looked at several current approaches to Go application design and weâ€™ve seen many of their flaws.</p></blockquote><p>ì €ëŠ” ì˜ì¡´ì„±ì˜ ê´€ì ì„ í†µí•´ ë””ìì¸ì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹ì´ ì½”ë“œ êµ¬ì„±ì„ ë” ë‹¨ìˆœí•˜ê³  ì‰½ê²Œ ì¶”ë¡ í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ ì¤€ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ë¨¼ì € ìš°ë¦¬ëŠ” ë„ë©”ì¸ ì–¸ì–´ë¥¼ ë””ìì¸ í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³ ë‚˜ì„œ ì˜ì¡´ì„±ë“¤ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ mocksë¥¼ ë„ì…í•©ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ ë©”ì¸ íŒ¨í‚¤ì§€ ì•ˆì—ì„œ ì´ ëª¨ë“  ê²ƒë“¤ì„ í•˜ë‚˜ë¡œ ì—®ìŠµë‹ˆë‹¤.</p><blockquote><p>I believe approaching design from the standpoint of dependencies makes code organization simpler and easier to reason about. First we design our domain language. Then we isolate our dependencies. Next we introduce mocks to isolate our tests. Finally, we tie everything together within our main package.</p></blockquote><p>ì—¬ëŸ¬ë¶„ì´ ë””ìì¸í•  ë‹¤ìŒ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì´ëŸ¬í•œ ì´ë¡ ë“¤ì„ ê³ ë ¤í•´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤. ì§ˆë¬¸ì´ ìˆìœ¼ì‹œê±°ë‚˜ ë””ìì¸ì— ëŒ€í•œ í† ë¡ ì„ ì›í•˜ì‹ ë‹¤ë©´ @benbjohnson íŠ¸ìœ„í„°ë¥¼ í†µí•´ ì—°ë½ì£¼ì‹œê±°ë‚˜ Gopher ìŠ¬ë™ì—ì„œ benbjohnsonì„ ì°¾ì•„ì£¼ì„¸ìš”.</p><blockquote><p>Consider these principles in the next application you design. If you have any questions or want to discuss design, contact me at @benbjohnson on Twitter or find me as benbjohnson on the Gopher slack.</p></blockquote><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>Reference</strong></p><ul><li><a href="https://www.gobeyond.dev/standard-package-layout/">https://www.gobeyond.dev/standard-package-layout/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/Go/">Go</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/go/">go</category>
      
      <category domain="https://chelseafandev.github.io/tags/golang/">golang</category>
      
      <category domain="https://chelseafandev.github.io/tags/go-layout/">go layout</category>
      
      <category domain="https://chelseafandev.github.io/tags/organize-go-code/">organize go code</category>
      
      <category domain="https://chelseafandev.github.io/tags/package-layout/">package layout</category>
      
      
      <comments>https://chelseafandev.github.io/2022/09/06/translate-standard-package-layout-in-go/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>CMakeì— ëŒ€í•´ ì•Œì•„ë³´ì</title>
      <link>https://chelseafandev.github.io/2022/03/05/cmake-tutorial/</link>
      <guid>https://chelseafandev.github.io/2022/03/05/cmake-tutorial/</guid>
      <pubDate>Sat, 05 Mar 2022 13:24:52 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;em&gt;&lt;strong&gt;ë­í•˜ëŠ” ë†ˆì¸ì§€ëŠ” ì•Œê³  ì“°ì&lt;/strong&gt;&lt;/em&gt; ì‹œë¦¬ì¦ˆì˜ ì„¸ë²ˆì§¸ ì£¼ì œëŠ” &lt;code&gt;CMake&lt;/code&gt;ì…ë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><em><strong>ë­í•˜ëŠ” ë†ˆì¸ì§€ëŠ” ì•Œê³  ì“°ì</strong></em> ì‹œë¦¬ì¦ˆì˜ ì„¸ë²ˆì§¸ ì£¼ì œëŠ” <code>CMake</code>ì…ë‹ˆë‹¤.</p><span id="more"></span><p>í•´ë‹¹ í¬ìŠ¤íŒ…ì—ì„œëŠ” <a href="https://cmake.org/cmake/help/v3.22/guide/tutorial/index.html">CMake ê³µì‹ í™ˆí˜ì´ì§€</a>ì˜ íŠœí† ë¦¬ì–¼ ë‚´ìš©ì„ ë²ˆì—­í•´ë³´ì•˜ìŠµë‹ˆë‹¤. <a href="https://github.com/Kitware/CMake">CMake ê³µì‹ github</a>ì—ì„œ ì œê³µí•´ì£¼ëŠ” í”„ë¡œì íŠ¸ í´ë” êµ¬ì„±ê³¼ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì°¸ì¡°í•˜ì—¬ ì¢€ ë” ìƒì„¸íˆ CMakeì˜ ì‚¬ìš©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ëŠ” ì‹œê°„ì„ ê°–ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. (íŠœí† ë¦¬ì–¼ ê´€ë ¨ ì†ŒìŠ¤ ì½”ë“œëŠ” <a href="https://github.com/Kitware/CMake/tree/master/Help/guide/tutorial">ì´ê³³</a>ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.)</p><p>í•œêµ­ì–´ë¡œ ëœ CMake ê´€ë ¨ ì„¤ëª…ì´ í•„ìš”í•˜ì‹œë‹¤ë©´ <a href="https://gist.github.com/luncliff/6e2d4eb7ca29a0afd5b592f72b80cb5c">CMake í• ë•Œ ìª¼ì˜¤ì˜¤ê¸ˆ ë„ì›€ì´ ë˜ëŠ” ë¬¸ì„œ</a>ë„ êµ‰ì¥íˆ ì˜ ì •ë¦¬ë˜ì–´ìˆìœ¼ë‹ˆ ì°¸ê³ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</p><br><!-- toc --><br><hr><h1 id="CMake-Tutorial"><a href="#CMake-Tutorial" class="headerlink" title="CMake Tutorial"></a>CMake Tutorial</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>CMake íŠœí† ë¦¬ì–¼ì€ ì¼ë°˜ì ì¸ ë¹Œë“œ ì‹œìŠ¤í…œ ì´ìŠˆë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë‹¨ê³„ë³„ ê°€ì´ë“œë¥¼ ì œê³µí•´ì¤ë‹ˆë‹¤. ì˜ˆì‹œë¡œ ì œê³µë˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œ ë‹¤ì–‘í•œ ì£¼ì œë“¤ì´ í•¨ê»˜ ì²˜ë¦¬ë˜ëŠ” ë°©ì‹ì„ ì‚´í´ë³´ëŠ” ê²ƒì€ ì•„ì£¼ í° ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>The CMake tutorial provides a step-by-step guide that covers common build system issues that CMake helps address. Seeing how various topics all work together in an example project can be very helpful.</p></blockquote><hr><h2 id="Step-1-A-Basic-Starting-Point"><a href="#Step-1-A-Basic-Starting-Point" class="headerlink" title="Step 1: A Basic Starting Point"></a>Step 1: A Basic Starting Point</h2><p>ê°€ì¥ ê¸°ë³¸ì ì¸ í”„ë¡œì íŠ¸ëŠ” ì†ŒìŠ¤ ì½”ë“œë¡œë¶€í„° ë¹Œë“œë˜ëŠ” ì‹¤í–‰ íŒŒì¼ì…ë‹ˆë‹¤. ì´ ê°„ë‹¨í•œ í”„ë¡œì íŠ¸ì—ì„œëŠ” <code>CMakeLists.txt</code> íŒŒì¼ì— ë‹¨ 3ì¤„ë§Œì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ê²ƒì´ ìš°ë¦¬ì˜ íŠœí† ë¦¬ì–¼ ì‹œì‘ ì§€ì ì´ ë  ê²ƒì…ë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ì‘ì„±ëœ <code>CMakeLists.txt</code> íŒŒì¼ì„ <code>Step1</code> ë””ë ‰í† ë¦¬ì•ˆì— ìƒì„±í•´ë´…ì‹œë‹¤.</p><blockquote><p>The most basic project is an executable built from source code files. For simple projects, a three line <code>CMakeLists.txt</code> file is all that is required. This will be the starting point for our tutorial. Create a <code>CMakeLists.txt</code> file in the <code>Step1</code> directory that looks like:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.10)</span><br><span class="line"></span><br><span class="line"># set the project name</span><br><span class="line">project(Tutorial)</span><br><span class="line"></span><br><span class="line"># add the executable</span><br><span class="line">add_executable(Tutorial tutorial.cxx)</span><br></pre></td></tr></table></figure><p>ì´ ì˜ˆì œì—ì„œëŠ” <code>CMakeLists.txt</code> íŒŒì¼ì— ì†Œë¬¸ìë¡œ ì´ë£¨ì–´ì§„ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì— ì£¼ëª©í•˜ê¸°ë°”ëë‹ˆë‹¤. CMakeì—ì„œëŠ” ëŒ€ë¬¸ì, ì†Œë¬¸ì ê·¸ë¦¬ê³  ì´ ë‘˜ì´ í˜¼í•©ëœ ëª…ë ¹ì–´ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. <code>tutorial.cxx</code>ì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” <code>Step1</code> ë””ë ‰í† ë¦¬ì—ì„œ í™•ì¸ê°€ëŠ¥í•˜ë©° ì´ ì½”ë“œëŠ” ì œê³±ê·¼ì„ ê³„ì‚°í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Note that this example uses lower case commands in the <code>CMakeLists.txt</code> file. Upper, lower, and mixed case commands are supported by CMake. The source code for <code>tutorial.cxx</code> is provided in the <code>Step1</code> directory and can be used to compute the square root of a number.</p></blockquote><h3 id="Build-and-Run"><a href="#Build-and-Run" class="headerlink" title="Build and Run"></a>Build and Run</h3><p>ì´ê²ƒì´ í•„ìš”í•œ ëª¨ë“ ê²ƒì…ë‹ˆë‹¤ - ì§€ê¸ˆ ë‹¹ì¥ì— ìš°ë¦¬ì˜ í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ë¨¼ì €, í”„ë¡œì íŠ¸ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ <code>cmake</code> ì‹¤í–‰ íŒŒì¼ ë˜ëŠ” <code>cmake-gui</code> ì‹¤í–‰í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³ ë‚˜ì„œ ì—¬ëŸ¬ë¶„ì´ ì„ íƒí•œ ë¹Œë“œ íˆ´ì„ ê°€ì§€ê³  ë¹Œë“œí•©ë‹ˆë‹¤.</p><blockquote><p>Thatâ€™s all that is needed - we can build and run our project now! First, run the <code>cmake</code> executable or the <code>cmake-gui</code> to configure the project and then build it with your chosen build tool.</p></blockquote><p>ì˜ˆë¥¼ ë“¤ì–´, ì—¬ëŸ¬ë¶„ì€ ì»¤ë§¨ë“œ ë¼ì¸ì—ì„œ CMake ì†ŒìŠ¤ ì½”ë“œ íŠ¸ë¦¬ì˜ <code>Help/guide/tutorial</code> ê²½ë¡œë¡œ ì´ë™í•  ìˆ˜ ìˆê³  ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ë¹Œë“œ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p><blockquote><p>For example, from the command line we could navigate to the <code>Help/guide/tutorial</code> directory of the CMake source code tree and create a build directory:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir Step1_build</span><br></pre></td></tr></table></figure><p>ë‹¤ìŒìœ¼ë¡œ, ìƒì„±í•œ ë¹Œë“œ ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•œ ë’¤ í”„ë¡œì íŠ¸ë¥¼ ì„¤ì •í•˜ê³  ë„¤ì´í‹°ë¸Œ ë¹Œë“œ ì‹œìŠ¤í…œì„ ìƒì„±í•˜ê¸° ìœ„í•´ CMakeë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:</p><blockquote><p>Next, navigate to the build directory and run CMake to configure the project and generate a native build system:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd Step1_build</span><br><span class="line">cmake ../Step1</span><br></pre></td></tr></table></figure><p>ê·¸ë¦¬ê³ ë‚˜ì„œ ì‹¤ì§ˆì ìœ¼ë¡œ í”„ë¡œì íŠ¸ë¥¼ ì»´íŒŒì¼í•˜ê³  ë§í¬í•˜ê¸° ìœ„í•´ ë¹Œë“œ ì‹œìŠ¤í…œì„ í˜¸ì¶œí•©ë‹ˆë‹¤:</p><blockquote><p>Then call that build system to actually compile/link the project:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake --build</span><br></pre></td></tr></table></figure><p>ë§ˆì§€ë§‰ìœ¼ë¡œ, ì•„ë˜ ëª…ë ¹ì–´ë“¤ì„ í†µí•´ ë¹Œë“œëœ <code>Tutorial</code>ì„ ì‚¬ìš©í•´ë´…ì‹œë‹¤:</p><blockquote><p>Finally, try to use the newly built <code>Tutorial</code> with these commands:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Tutorial 4294967296</span><br><span class="line">Tutorial 10</span><br><span class="line">Tutorial</span><br></pre></td></tr></table></figure><h3 id="Adding-a-Version-Number-and-Configured-Header-File"><a href="#Adding-a-Version-Number-and-Configured-Header-File" class="headerlink" title="Adding a Version Number and Configured Header File"></a>Adding a Version Number and Configured Header File</h3><p>ìš°ë¦¬ê°€ ì¶”ê°€í•˜ê²Œ ë  ì²«ë²ˆì§¸ ê¸°ëŠ¥ì€ ìš°ë¦¬ì˜ ì‹¤í–‰ íŒŒì¼ê³¼ í”„ë¡œì íŠ¸ì— ë²„ì „ ë²ˆí˜¸ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë²„ì „ ë²ˆí˜¸ë¥¼ ì†ŒìŠ¤ ì½”ë“œ ìƒì— ì¶”ê°€í•˜ëŠ” ê²ƒë„ í•˜ë‚˜ì˜ ë°©ë²•ì´ì§€ë§Œ <code>CMakeLists.txt</code>ì˜ ì‚¬ìš©ì€ ì´ë¥¼ ì¢€ ë” ìœ ì—°í•˜ê²Œ í•´ì¤ë‹ˆë‹¤.</p><blockquote><p>The first feature we will add is to provide our executable and project with a version number. While we could do this exclusively in the source code, using <code>CMakeLists.txt</code> provides more flexibility.</p></blockquote><p>ë¨¼ì €, í”„ë¡œì íŠ¸ì˜ ì´ë¦„ê³¼ ë²„ì „ ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•œ ëª…ë ¹ì–´ì¸ project()ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ <code>CMakeLists.txt</code> íŒŒì¼ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.</p><blockquote><p>First, modify the <code>CMakeLists.txt</code> file to use the project() command to set the project name and version number.</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.10)</span><br><span class="line"></span><br><span class="line"># set the project name and version</span><br><span class="line">project(Tutorial VERSION 1.0)</span><br></pre></td></tr></table></figure><p>ê·¸ë¦¬ê³ ë‚˜ì„œ, ë²„ì „ ë²ˆí˜¸ë¥¼ ì†ŒìŠ¤ ì½”ë“œë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•´ í—¤ë” íŒŒì¼ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p><blockquote><p>Then, configure a header file to pass the version number to the source code:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configure_file(TutorialConfig.h.in TutorialConfig.h)</span><br></pre></td></tr></table></figure><p>ì„¤ì •ëœ íŒŒì¼ì€ ë°”ì´ë„ˆë¦¬ íŠ¸ë¦¬ ì•ˆì— ì‘ì„±ë  ê²ƒì´ê¸°ë•Œë¬¸ì— í¬í•¨ íŒŒì¼ì„ ì°¾ê¸° ìœ„í•´ ê²½ë¡œ ë¦¬ìŠ¤íŠ¸ì— í•´ë‹¹ ë””ë ‰í† ë¦¬ë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤. <code>CMakeLists.txt</code> íŒŒì¼ì˜ ëì— ì•„ë˜ ë¼ì¸ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.</p><blockquote><p>Since the configured file will be written into the binary tree, we must add that directory to the list of paths to search for include files. Add the following lines to the end of the <code>CMakeLists.txt</code> file:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target_include_directories(Tutorial PUBLIC &quot;$&#123;PROJECT_BINARY_DIR&#125;&quot;)</span><br></pre></td></tr></table></figure><p>ì—¬ëŸ¬ë¶„ì´ ì„ í˜¸í•˜ëŠ” í¸ì§‘ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ë˜ ë‚´ìš©ì„ í¬í•¨í•˜ê³  ìˆëŠ” <code>TutorialConfig.h.in</code> íŒŒì¼ì„ ì†ŒìŠ¤ ë””ë ‰í† ë¦¬ì— ìƒì„±í•´ì¤ì‹œë‹¤.</p><blockquote><p>Using your favorite editor, create <code>TutorialConfig.h.in</code> in the source directory with the following contents:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// the configured options and settings for Tutorial</span><br><span class="line">#define Tutorial_VERSION_MAJOR @Tutorial_VERSION_MAJOR@</span><br><span class="line">#define Tutorial_VERSION_MINOR @Tutorial_VERSION_MINOR@</span><br></pre></td></tr></table></figure><p>CMakeê°€ ì´ í—¤ë” íŒŒì¼ì„ ì„¤ì •í•˜ëŠ” ë™ì•ˆ <code>@Tutorial_VERSION_MAJOR@</code>ì™€ <code>@Tutorial_VERSION_MINOR@</code> ê°’ì€ ëŒ€ì²´ë  ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>When CMake configures this header file the values for <code>@Tutorial_VERSION_MAJOR@</code> and <code>@Tutorial_VERSION_MINOR@</code> will be replaced.</p></blockquote><p>ë‹¤ìŒìœ¼ë¡œ ì„¤ì •ëœ í—¤ë” íŒŒì¼ì¸ <code>TutorialConfig.h</code>ë¥¼ í¬í•¨í•˜ê¸° ìœ„í•´ <code>tutorial.cxx</code> íŒŒì¼ì„ ìˆ˜ì •í•©ì‹œë‹¤.</p><blockquote><p>Next modify <code>tutorial.cxx</code> to include the configured header file, <code>TutorialConfig.h</code>.</p></blockquote><p>ë§ˆì§€ë§‰ìœ¼ë¡œ, ì•„ë˜ì™€ ê°™ì´ <code>tutorial.cxx</code> íŒŒì¼ì„ ìˆ˜ì •í•´ì„œ ì‹¤í–‰ íŒŒì¼ì˜ ì´ë¦„ê³¼ ë²„ì „ ë²ˆí˜¸ë¥¼ ì¶œë ¥í•´ë´…ì‹œë‹¤.</p><blockquote><p>Finally, letâ€™s print out the executable name and version number by updating <code>tutorial.cxx</code> as follows:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (argc &lt; 2) &#123;</span><br><span class="line">    // report version</span><br><span class="line">    std::cout &lt;&lt; argv[0] &lt;&lt; &quot; Version &quot; &lt;&lt; Tutorial_VERSION_MAJOR &lt;&lt; &quot;.&quot;</span><br><span class="line">              &lt;&lt; Tutorial_VERSION_MINOR &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; number&quot; &lt;&lt; std::endl;</span><br><span class="line">    return 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Specify-the-C-Standard"><a href="#Specify-the-C-Standard" class="headerlink" title="Specify the C++ Standard"></a>Specify the C++ Standard</h3><p>ë‹¤ìŒìœ¼ë¡œ <code>tutorial.cxx</code> ì†ŒìŠ¤ ë‚´ì— <code>atof</code>ë¥¼ <code>std::stod</code>ë¡œ ë³€ê²½í•¨ìœ¼ë¡œì¨ C++11 ê¸°ëŠ¥ì„ ìš°ë¦¬ í”„ë¡œì íŠ¸ì— ì¶”ê°€í•´ë´…ì‹œë‹¤. ë™ì‹œì— <code>#include &lt;cstdlib&gt;</code> ì„ ì–¸ë„ ì œê±°í•´ì¤ë‹ˆë‹¤.</p><blockquote><p>Next letâ€™s add some C++11 features to our project by replacing <code>atof</code> with <code>std::stod</code> in <code>tutorial.cxx</code>. At the same time, remove <code>#include &lt;cstdlib&gt;</code>.</p></blockquote><p>ìš°ë¦¬ëŠ” ì˜¬ë°”ë¥¸ í”Œë˜ê·¸ ê°’ì„ ì‚¬ìš©í•˜ë„ë¡ CMake ì½”ë“œì— ëª…ì‹œì ìœ¼ë¡œ ì–¸ê¸‰í•  í•„ìš”ê°€ ìˆì„ê²ƒì…ë‹ˆë‹¤. CMakeì—ì„œ íŠ¹ì • C++ ë²„ì „ì„ ì§€ì›í•˜ë„ë¡ í•˜ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì€ CMAKE_CXX_STANDARD ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. í˜„ì¬ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” <code>CMakeLists.txt</code> íŒŒì¼ì˜ CMAKE_CXX_STANDARD ë³€ìˆ˜ë¥¼ <code>11</code>ë¡œ ì„¤ì •í•˜ê³ , CMAKE_CXX_STANDARD_REQUIRED ë³€ìˆ˜ë¥¼ <code>True</code>ë¡œ ì„¤ì •í•´ë³´ê² ìŠµë‹ˆë‹¤. <code>CMAKE_CXX_STANDARD</code>ëŠ” <code>add_executable</code> ëª…ë ¹ì–´ í˜¸ì¶œ ì´ì „ì— ì„ ì–¸ë˜ì–´ì•¼í•œë‹¤ëŠ” ê²ƒì„ ìŠì§€ë§ê¸° ë°”ëë‹ˆë‹¤.</p><blockquote><p>We will need to explicitly state in the CMake code that it should use the correct flags. The easiest way to enable support for a specific C++ standard in CMake is by using the CMAKE_CXX_STANDARD variable. For this tutorial, set the CMAKE_CXX_STANDARD variable in the <code>CMakeLists.txt</code> file to <code>11</code> and CMAKE_CXX_STANDARD_REQUIRED to <code>True</code>. Make sure to add the <code>CMAKE_CXX_STANDARD</code> declarations above the call to <code>add_executable</code>.</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.10)</span><br><span class="line"></span><br><span class="line"># set the project name and version</span><br><span class="line">project(Tutorial VERSION 1.0)</span><br><span class="line"></span><br><span class="line"># specify the C++ standard</span><br><span class="line">set(CMAKE_CXX_STANDARD 11)</span><br><span class="line">set(CMAKE_CXX_STANDARD_REQUIRED True)</span><br></pre></td></tr></table></figure><h3 id="Rebuild"><a href="#Rebuild" class="headerlink" title="Rebuild"></a>Rebuild</h3><p>ìš°ë¦¬ì˜ í”„ë¡œì íŠ¸ë¥¼ ë‹¤ì‹œ ë¹Œë“œí•´ë´…ì‹œë‹¤. ìš°ë¦¬ëŠ” ì´ë¯¸ ë¹Œë“œ ë””ë ‰í† ë¦¬ ìƒì„±í–ˆê³  CMakeë¥¼ ì‹¤í–‰í–ˆê¸°ë•Œë¬¸ì— ë¹Œë“œ ê³¼ì •ìœ¼ë¡œ ê±´ë„ˆë›¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p><blockquote><p>Letâ€™s build our project again. We already created a build directory and ran CMake, so we can skip to the build step:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd Step1_build</span><br><span class="line">cmake --build .</span><br></pre></td></tr></table></figure><p>ì´ì œ ì´ì „ê³¼ ë™ì¼í•œ ëª…ë ¹ì–´ë¥¼ í†µí•´ ìƒˆë¡­ê²Œ ë¹Œë“œëœ <code>Tutorial</code>ì„ ì‹¤í–‰í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Now we can try to use the newly built <code>Tutorial</code> with same commands as before:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Tutorial 4294967296</span><br><span class="line">Tutorial 10</span><br><span class="line">Tutorial</span><br></pre></td></tr></table></figure><p>ì¸ì ì—†ì´ ì‹¤í–‰ íŒŒì¼ì„ êµ¬ë™ í• ë•Œ ë²„ì „ ë²ˆí˜¸ê°€ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì‹œê¸¸ ë°”ëë‹ˆë‹¤.</p><blockquote><p>Check that the version number is now reported when running the executable without any arguments.</p></blockquote><hr><h2 id="Step-2-Adding-a-Library"><a href="#Step-2-Adding-a-Library" class="headerlink" title="Step 2: Adding a Library"></a>Step 2: Adding a Library</h2><p>ì´ì œ ìš°ë¦¬ì˜ í”„ë¡œì íŠ¸ì— ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•´ë³¼ ê²ƒì…ë‹ˆë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì œê³±ê·¼ ê³„ì‚°ì„ ì§ì ‘ êµ¬í˜„í•œ ë‚´ìš©ì´ í¬í•¨ë˜ì–´ ìˆì„ ê²ƒì…ë‹ˆë‹¤. í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•œ ì´í›„ì—ëŠ” ì‹¤í–‰ íŒŒì¼ì´ ì»´íŒŒì¼ëŸ¬ê°€ ì œê³µí•˜ëŠ” ì¼ë°˜ì ì¸ ì œê³±ê·¼ í•¨ìˆ˜ ëŒ€ì‹ ì— ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œë©ë‹ˆë‹¤.</p><blockquote><p>Now we will add a library to our project. This library will contain our own implementation for computing the square root of a number. The executable can then use this library instead of the standard square root function provided by the compiler.</p></blockquote><p>ì´ë²ˆ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ <code>MathFunctions</code>ì´ë¼ëŠ” í•˜ìœ„ ë””ë ‰í† ë¦¬ì— í¬í•¨ì‹œí‚¬ ê²ƒì…ë‹ˆë‹¤. ì´ ë””ë ‰í† ë¦¬ì—ëŠ” í—¤ë” íŒŒì¼ì¸ <code>MathFunctions.h</code>ì™€ ì†ŒìŠ¤ íŒŒì¼ì¸ <code>mysqrt.cxx</code>ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì†ŒìŠ¤ íŒŒì¼ì—ëŠ” ì»´íŒŒì¼ëŸ¬ì˜ sqrt í•¨ìˆ˜ì™€ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” <code>mysqrt</code>ë¼ëŠ” í•¨ìˆ˜ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</p><blockquote><p>For this tutorial we will put the library into a subdirectory called <code>MathFunctions</code>. This directory already contains a header file, <code>MathFunctions.h</code>, and a source file <code>mysqrt.cxx</code>. The source file has one function called <code>mysqrt</code> that provides similar functionality to the compilerâ€™s sqrt function.</p></blockquote><p><code>MathFunctions</code> ë””ë ‰í† ë¦¬ì˜ <code>CMakeLists.txt</code> íŒŒì¼ì— ì•„ë˜ì™€ ê°™ì´ í•œ ì¤„ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p><blockquote><p>Add the following one line <code>CMakeLists.txt</code> file to the <code>MathFunctions</code> directory:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_library(MathFunctions mysqrt.cxx)</span><br></pre></td></tr></table></figure><p>ìƒˆë¡­ê²Œ ì¶”ê°€í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ <U>â‘ ìµœìƒìœ„ <code>CMakeLists.txt</code> íŒŒì¼ì— <strong>add_subdirectory()</strong> í˜¸ì¶œì„ ì¶”ê°€</U>í•  ê²ƒì´ë©°, ì´ í˜¸ì¶œì„ í†µí•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¹Œë“œë  ê²ƒ ì…ë‹ˆë‹¤. <U>â‘¡ì‹¤í–‰ íŒŒì¼ì— ìƒˆë¡œìš´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€</U>í•˜ê³  <code>mysqrt.h</code> <U>â‘¢í—¤ë” íŒŒì¼ì„ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ <code>MathFunctions</code>ë¥¼ í¬í•¨ ë””ë ‰í† ë¦¬ë¡œ ì¶”ê°€</U>í•©ë‹ˆë‹¤. ì´ì œ ìµœìƒìœ„ <code>CMakeLists.txt</code> íŒŒì¼ì˜ ë§ˆì§€ë§‰ ëª‡ ê°œì˜ ë¼ì¸ì€ ì•„ë˜ì™€ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤:</p><blockquote><p>To make use of the new library we will add an <strong>add_subdirectory()</strong> call in the top-level <code>CMakeLists.txt</code> file so that the library will get built. We add the new library to the executable, and add <code>MathFunctions</code> as an include directory so that the <code>mysqrt.h</code> header file can be found. The last few lines of the top-level <code>CMakeLists.txt</code> file should now look like:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># â‘  add the MathFunctions library</span><br><span class="line">add_subdirectory(MathFunctions)</span><br><span class="line"></span><br><span class="line"># add the executable</span><br><span class="line">add_executable(Tutorial tutorial.cxx)</span><br><span class="line"></span><br><span class="line"># â‘¡ add the new library(= MathFUnction) to the executable</span><br><span class="line">target_link_libraries(Tutorial PUBLIC MathFunctions)</span><br><span class="line"></span><br><span class="line"># â‘¢ add the binary tree to the search path for include files so that we will find TutorialConfig.h</span><br><span class="line">target_include_directories(Tutorial PUBLIC </span><br><span class="line">                           &quot;$&#123;PROJECT_BINARY_DIR&#125;&quot;</span><br><span class="line">                           &quot;$&#123;PROJECT_SOURCE_DIR&#125;/MathFunctions&quot;</span><br><span class="line">                          )</span><br></pre></td></tr></table></figure><p>ì´ë²ˆì—” <code>MathFunctions</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì˜µì…˜í™”í•´ë´…ì‹œë‹¤. ì´ë²ˆ íŠœí† ë¦¬ì–¼ì„ ì§„í–‰í•˜ëŠ”ë° ìˆì–´ì„œ ì´ ì‘ì—…ì´ ë°˜ë“œì‹œ í•„ìš”í•œ ê²ƒì€ ì•„ë‹ˆì§€ë§Œ, ê·œëª¨ê°€ ë” í° í”„ë¡œì íŠ¸ë“¤ì—ì„œ ì´ëŸ¬í•œ ì˜µì…˜í™” ì‘ì—…ì€ ì¼ë°˜ì ì…ë‹ˆë‹¤. ê°€ì¥ ë¨¼ì € ìµœìƒìœ„ <code>CMakeLists.txt</code> íŒŒì¼ì— optionì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p><blockquote><p>Now let us make the <code>MathFunctions</code> library optional. While for the tutorial there really isnâ€™t any need to do so, for larger projects this is a common occurrence. The first step is to add an option to the top-level <code>CMakeLists.txt</code> file.</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">option(USE_MYMATH &quot;Use tutorial provided math implementation&quot; ON)</span><br><span class="line"></span><br><span class="line"># configure a header file to pass some of the CMake settings</span><br><span class="line"># to the source code</span><br><span class="line">configure_file(TutorialConfig.h.in TutorialConfig.h)</span><br></pre></td></tr></table></figure><p>ì´ ì˜µì…˜ì€ <strong>cmake-gui</strong>ì™€ <strong>ccmake</strong>ì—ì„œ ê¸°ë³¸ ê°’ì¸ <code>ON</code>ìœ¼ë¡œ ë³´ì—¬ì§€ê²Œ ë  ê²ƒì´ë©° ì´ ê°’ì€ ì‚¬ìš©ìê°€ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì„¤ì •ì€ ìºì‹œì— ì €ì¥ë  ê²ƒì´ê¸° ë•Œë¬¸ì— ì‚¬ìš©ìëŠ” ë¹Œë“œ ë””ë ‰í† ë¦¬ì—ì„œ CMakeë¥¼ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ì´ ê°’ì„ ì„¤ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p><blockquote><p>This option will be displayed in the <strong>cmake-gui</strong> and <strong>ccmake</strong> with a default value of <code>ON</code> that can be changed by the user. This setting will be stored in the cache so that the user does not need to set the value each time they run CMake on a build directory.</p></blockquote><p>ë‹¤ìŒ ë³€í™”ëŠ” <code>MathFunctions</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¡°ê±´ì— ë”°ë¼ ë¹Œë“œí•˜ê³  ë§í‚¹í•˜ë„ë¡ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì˜µì…˜ ê°’ì„ ì²´í¬í•˜ëŠ” if êµ¬ë¬¸ì„ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤. if ë¸”ë¡ ë‚´ë¶€ì— ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§í¬í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  í•˜ìœ„ ë””ë ‰í† ë¦¬ë¥¼ íŠœí† ë¦¬ì–¼ íƒ€ê²Ÿì˜ í¬í•¨ ë””ë ‰í† ë¦¬ë¡œ ì¶”ê°€í•˜ê¸° ìœ„í•œ list ëª…ë ¹ì–´ì™€ í•¨ê»˜  <strong>add_subdirectory()</strong> ëª…ë ¹ì–´ë¥¼ ì¶”ê°€í•©ì‹œë‹¤.</p><blockquote><p>The next change is to make building and linking the <code>MathFunctions</code> library conditional. To do this, we will create an <code>if</code> statement which checks the value of the option. Inside the if block, put the <strong>add_subdirectory()</strong> command from above with some additional list commands to store information needed to link to the library and add the subdirectory as an include directory in the <code>Tutorial</code> target. The end of the top-level <code>CMakeLists.txt</code> file will now look like the following:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">if(USE_MYMATH)</span><br><span class="line">  add_subdirectory(MathFunctions)</span><br><span class="line">  list(APPEND EXTRA_LIBS MathFunctions)</span><br><span class="line">  list(APPEND EXTRA_INCLUDES &quot;$&#123;PROJECT_SOURCE_DIR&#125;/MathFunctions&quot;)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line"># add the executable</span><br><span class="line">add_executable(Tutorial tutorial.cxx)</span><br><span class="line"></span><br><span class="line">target_link_libraries(Tutorial PUBLIC $&#123;EXTRA_LIBS&#125;)</span><br><span class="line"></span><br><span class="line"># add the binary tree to the search path for include files</span><br><span class="line"># so that we will find TutorialConfig.h</span><br><span class="line">target_include_directories(Tutorial PUBLIC </span><br><span class="line">                           &quot;$&#123;PROJECT_BINARY_DIR&#125;&quot;</span><br><span class="line">                           $&#123;EXTRA_INCLUDES&#125;</span><br><span class="line">                          )</span><br></pre></td></tr></table></figure><p>ë‚˜ì¤‘ì— ì‹¤í–‰íŒŒì¼ì— ë§í¬ë˜ëŠ” ì˜µì…˜í™”ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ëª¨ìœ¼ê¸° ìœ„í•´ <code>EXTRA_LIBS</code> ë¼ëŠ” ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì£¼ëª©í•˜ê¸° ë°”ëë‹ˆë‹¤. <code>EXTRA_INCLUDES</code> ë³€ìˆ˜ëŠ” ì˜µì…˜í™”ëœ í—¤ë” íŒŒì¼ì„ ëŒ€ìƒìœ¼ë¡œ ì´ì™€ ìœ ì‚¬í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ê²ƒì€ ë§ì€ ì˜µì…˜ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ê³ ì „ì ì¸ ë°©ì‹ì´ë©°, ë‹¤ìŒ ë‹¨ê³„ì—ì„œ í˜„ëŒ€ì ì¸ ì ‘ê·¼ ë°©ì‹ì— ëŒ€í•´ ì‚´í´ë³¼ ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>Note the use of the variable <code>EXTRA_LIBS</code> to collect up any optional libraries to later be linked into the executable. The variable <code>EXTRA_INCLUDES</code> is used similarly for optional header files. This is a classic approach when dealing with many optional components, we will cover the modern approach in the next step.</p></blockquote><p>ìœ„ ì‘ì—…ì— ë”°ë¥¸ ì†ŒìŠ¤ ì½”ë“œ ìƒì˜ ë³€ê²½ì ì€ ê½¤ ê°„ë‹¨í•©ë‹ˆë‹¤. ë¨¼ì €, í•„ìš” ì‹œì— <code>tutorial.cxx</code>ì—ì„œ <code>MathFunctions.h</code>ë¥¼ í¬í•¨ì‹œì¼œì¤ë‹ˆë‹¤.</p><blockquote><p>The corresponding changes to the source code are fairly straightforward. First, in <code>tutorial.cxx</code>, include the <code>MathFunctions.h</code> header if we need it:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#ifdef USE_MYMATH</span><br><span class="line">#  include &quot;MathFunctions.h&quot;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>ê·¸ë¦¬ê³  ë‚˜ì„œ, <code>USE_MYMATH</code>ë¥¼ ì œê³±ê·¼ í•¨ìˆ˜ê°€ ì‚¬ìš©ë˜ëŠ” ì¡°ê±´ìœ¼ë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p><blockquote><p>Then, in the same file, make <code>USE_MYMATH</code> control which square root function is used:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ifdef USE_MYMATH</span><br><span class="line">  const double outputValue = mysqrt(inputValue);</span><br><span class="line">#else</span><br><span class="line">  const double outputValue = sqrt(inputValue);</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>ì´ì œ ì†ŒìŠ¤ ì½”ë“œì—ì„œ <code>USE_MYMATH</code> ë³€ìˆ˜ë¥¼ ìš”êµ¬í•˜ê³  ìˆê¸°ë•Œë¬¸ì— ì´ ê°’ì„ <code>TutorialConfig.h.in</code> íŒŒì¼ì— ì•„ë˜ì™€ ê°™ì´ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p><blockquote><p>Since the source code now requires <code>USE_MYMATH</code> we can add it to <code>TutorialConfig.h.in</code> with the following line:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#cmakedefine USE_MYMATH</span><br></pre></td></tr></table></figure><p>í”„ë¡œì íŠ¸ë¥¼ ì„¤ì •(configure)í•˜ê¸° ìœ„í•´ <strong>cmake</strong> ì‹¤í–‰ íŒŒì¼ ë˜ëŠ” <strong>cmake-gui</strong>ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  ì—¬ëŸ¬ë¶„ì˜ ë¹Œë“œ ë„êµ¬ì— ë§ê²Œ ë¹Œë“œí•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¹Œë“œëœ Tutorial ì‹¤í–‰ íŒŒì¼ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><blockquote><p>Run the <strong>cmake</strong> executable or the <strong>cmake-gui</strong> to configure the project and then build it with your chosen build tool. Then run the built Tutorial executable.</p></blockquote><p>ì´ì œ <code>USE_MYMATH</code> ê°’ì„ ì—…ë°ì´íŠ¸ í•´ë´…ì‹œë‹¤. ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì€ <strong>cmake-gui</strong>ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ í„°ë¯¸ë„ í™˜ê²½ì´ë¼ë©´ <strong>ccmake</strong>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë˜ëŠ” command-lineì˜ ì˜µì…˜ì„ ë³€ê²½í•˜ê¸°ë¥¼ ì›í•œë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì‹œë„í•´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤:</p><blockquote><p>Now letâ€™s update the value of <code>USE_MYMATH</code>. The easiest way is to use the <strong>cmake-gui</strong> or <strong>ccmake</strong> if youâ€™re in the terminal. Or, alternatively, if you want to change the option from the command-line, try:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake ../Step2 -DUSE_MYMATH=OFF</span><br></pre></td></tr></table></figure><hr><h2 id="Step-3-Adding-Usage-Requirements-for-a-Library"><a href="#Step-3-Adding-Usage-Requirements-for-a-Library" class="headerlink" title="Step 3: Adding Usage Requirements for a Library"></a>Step 3: Adding Usage Requirements for a Library</h2><p>ì‚¬ìš© ìš”êµ¬ ì‚¬í•­ì„ í†µí•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë˜ëŠ” ì‹¤í–‰ íŒŒì¼ì˜ ë§í¬ ë° í¬í•¨ ë¼ì¸ì„ í›¨ì”¬ ë” ì˜ ì œì–´í•  ìˆ˜ ìˆìœ¼ë©° CMake ë‚´ ëŒ€ìƒì˜ ì „ì´ ì†ì„±ì„ ë” ë§ì´ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš© ìš”êµ¬ ì‚¬í•­ì„ í™œìš©í•˜ëŠ” ê¸°ë³¸ ëª…ë ¹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p><blockquote><p>Usage requirements allow for far better control over a library or executableâ€™s link and include line while also giving more control over the transitive property of targets inside CMake. The primary commands that leverage usage requirements are:</p><ul><li>target_compile_definitions()</li><li>target_compile_options()</li><li>target_include_directories()</li><li>target_link_libraries()</li></ul></blockquote><p>ì‚¬ìš© ìš”êµ¬ ì‚¬í•­ì˜ í˜„ëŒ€ì ì¸ CMake ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì•ì„  ì±•í„°ì˜€ë˜ <strong>Adding a Library</strong>ì—ì„œ ì‚¬ìš©í•œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§ í•´ë³´ê² ìŠµë‹ˆë‹¤. ë¨¼ì € <code>MathFunctions</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§í‚¹í•˜ê³ ì í•œë‹¤ë©´ í˜„ì¬ ì†ŒìŠ¤ ë””ë ‰í† ë¦¬ë¥¼ í¬í•¨í•´ì•¼í•˜ì§€ë§Œ <code>MathFunctions</code> ìì²´ëŠ” í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì´ê²ƒì¸ <code>INTERFACE</code> ì‚¬ìš© ìš”êµ¬ì‚¬í•­ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>Letâ€™s refactor our code from <strong>Adding a Library</strong> to use the modern CMake approach of usage requirements. We first state that anybody linking to <code>MathFunctions</code> needs to include the current source directory, while <code>MathFunctions</code> itself doesnâ€™t. So this can become an <code>INTERFACE</code> usage requirement.</p></blockquote><p><code>INTERFACE</code>ëŠ” ì†Œë¹„ìê°€ í•„ìš”ë¡œ í•˜ì§€ë§Œ ìƒì‚°ìëŠ” ê·¸ë ‡ì§€ ì•Šë‹¤ëŠ” ê²ƒì„ ê¸°ì–µí•˜ê¸° ë°”ëë‹ˆë‹¤. <code>MathFunctions/CMakeLists.txt</code> íŒŒì¼ì˜ ëì— ì•„ë˜ ë¼ì¸ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p><blockquote><p>Remember <code>INTERFACE</code> means things that consumers require but the producer doesnâ€™t. Add the following lines to the end of <code>MathFunctions/CMakeLists.txt</code>:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target_include_directories(MathFunctions</span><br><span class="line">          INTERFACE $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span><br><span class="line">          )</span><br></pre></td></tr></table></figure><p>ì´ì œ <code>MathFunctions</code>ì— ëŒ€í•œ ì‚¬ìš© ìš”êµ¬ ì‚¬í•­ì„ ëª…ì‹œí–ˆìœ¼ë¯€ë¡œ ìµœìƒìœ„ <code>CMakeLists.txt</code>ì—ì„œ <code>EXTRA_INCLUDES</code>ë³€ìˆ˜ ì‚¬ìš©ì„ ì•ˆì „í•˜ê²Œ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p><blockquote><p>Now that weâ€™ve specified usage requirements for <code>MathFunctions</code> we can safely remove our uses of the <code>EXTRA_INCLUDES</code> variable from the top-level <code>CMakeLists.txt</code>, here:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(USE_MYMATH)</span><br><span class="line">  add_subdirectory(MathFunctions)</span><br><span class="line">  list(APPEND EXTRA_LIBS MathFunctions)</span><br><span class="line">endif()</span><br></pre></td></tr></table></figure><blockquote><p>And here:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target_include_directories(Tutorial PUBLIC</span><br><span class="line">                           &quot;$&#123;PROJECT_BINARY_DIR&#125;&quot;</span><br><span class="line">                           )</span><br></pre></td></tr></table></figure><p>ìœ„ì™€ ê°™ì´ ìˆ˜ì •ì„ ì™„ë£Œí•˜ì˜€ë‹¤ë©´ í”„ë¡œì íŠ¸ë¥¼ ì„¤ì •(configure)í•˜ê¸° ìœ„í•´ <strong>cmake</strong> ì‹¤í–‰ íŒŒì¼ ë˜ëŠ” <strong>cmake-gui</strong>ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  ì—¬ëŸ¬ë¶„ì˜ ë¹Œë“œ ë„êµ¬ì— ë§ê²Œ ë¹Œë“œí•˜ê±°ë‚˜ ë¹Œë“œ ë””ë ‰í† ë¦¬ì—ì„œ <code>cmake --build</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œí•©ë‹ˆë‹¤.</p><blockquote><p>Once this is done, run the <strong>cmake</strong> executable or the <strong>cmake-gui</strong> to configure the project and then build it with your chosen build tool or by using <code>cmake --build .</code> from the build directory.</p></blockquote><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>reference</strong></p><ul><li><a href="https://cmake.org/cmake/help/v3.22/guide/tutorial/index.html">https://cmake.org/cmake/help/v3.22/guide/tutorial/index.html</a></li><li><a href="https://github.com/Kitware/CMake/tree/master/Help/guide/tutorial">https://github.com/Kitware/CMake/tree/master/Help/guide/tutorial</a></li><li><a href="https://gist.github.com/luncliff/6e2d4eb7ca29a0afd5b592f72b80cb5c">https://gist.github.com/luncliff/6e2d4eb7ca29a0afd5b592f72b80cb5c</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/C/">C++</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/cmake/">cmake</category>
      
      <category domain="https://chelseafandev.github.io/tags/CMakeFile-txt/">CMakeFile.txt</category>
      
      <category domain="https://chelseafandev.github.io/tags/CMake-tutorial/">CMake tutorial</category>
      
      
      <comments>https://chelseafandev.github.io/2022/03/05/cmake-tutorial/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>io_context::run í•¨ìˆ˜ê°€ ë°˜í™˜ë˜ëŠ” ê²ƒì„ ë§‰ëŠ” ë°©ë²•</title>
      <link>https://chelseafandev.github.io/2022/01/11/prevent-io-context-run-from-returning/</link>
      <guid>https://chelseafandev.github.io/2022/01/11/prevent-io-context-run-from-returning/</guid>
      <pubDate>Tue, 11 Jan 2022 07:17:36 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;em&gt;&lt;strong&gt;ë­í•˜ëŠ” ë†ˆì¸ì§€ëŠ” ì•Œê³  ì“°ì&lt;/strong&gt;&lt;/em&gt; ì‹œë¦¬ì¦ˆì˜ ë‘ë²ˆì§¸ ì£¼ì œëŠ” &lt;code&gt;boost io_context::run í•¨ìˆ˜ë¥¼ ì‹¤í–‰ ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ë°©ë²•&lt;/code&gt;ì…ë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><em><strong>ë­í•˜ëŠ” ë†ˆì¸ì§€ëŠ” ì•Œê³  ì“°ì</strong></em> ì‹œë¦¬ì¦ˆì˜ ë‘ë²ˆì§¸ ì£¼ì œëŠ” <code>boost io_context::run í•¨ìˆ˜ë¥¼ ì‹¤í–‰ ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ë°©ë²•</code>ì…ë‹ˆë‹¤.</p><span id="more"></span><p>í•´ë‹¹ í¬ìŠ¤íŒ…ì—ì„œëŠ” io_contextë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ run í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼í•œë‹¤ëŠ” ì£¼ì…ì‹(?) êµìœ¡ì—ì„œ ë²—ì–´ë‚˜ê³ ì boost io_context::run í•¨ìˆ˜ì— ëŒ€í•´ ê°„ëµíˆ ì•Œì•„ë³´ê³ , ìš°ë¦¬ì˜ ìµœì¢… ëª©í‘œì¸ io_contextì— ë‹¹ì¥ì— í• ë‹¹ëœ ì‘ì—…ì´ ì—†ë”ë¼ë„ io_context::run í•¨ìˆ˜ë¥¼ ì‹¤í–‰ ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. <a href="https://dens.website/tutorials/cpp-asio/work">Prevent io_context::run from returning</a> ì‚¬ì´íŠ¸ì˜ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë‹ˆ ì°¸ê³ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</p><br><!-- toc --><br><h2 id="io-context-run-í•¨ìˆ˜ë€"><a href="#io-context-run-í•¨ìˆ˜ë€" class="headerlink" title="io_context::run í•¨ìˆ˜ë€?"></a>io_context::run í•¨ìˆ˜ë€?</h2><p>ë¨¼ì € <a href="https://www.boost.org/doc/libs/1_78_0/doc/html/boost_asio/reference/io_context/run/overload1.html">Boost ê³µì‹ ë§¤ë‰´ì–¼</a>ì˜ ë‚´ìš©ì„ ì°¸ê³ í•˜ì—¬ io_context::run í•¨ìˆ˜ì— ëŒ€í•´ ê°„ëµíˆ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><br><p>io_context::run í•¨ìˆ˜ëŠ” io_context ê°ì²´ì˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ ë£¨í”„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><blockquote><p>Run the io_context objectâ€™s event processing loop.</p></blockquote><p>run() í•¨ìˆ˜ëŠ” ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ê±°ë‚˜ ë”ì´ìƒ ì²˜ë¦¬í•  í•¸ë“¤ëŸ¬ê°€ ì—†ì„ë•Œê¹Œì§€ ë¸”ë¡ìƒíƒœë¥¼ ìœ ì§€í•©ë‹ˆë‹¤. </p><blockquote><p>The run() function blocks until all work has finished and there are no more handlers to be dispatched, or until the io_context has been stopped.</p></blockquote><p>io_contextê°€ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•˜ëŠ” ê³µê°„ì¸ ì“°ë ˆë“œ í’€ì„ ì„¤ì •í•˜ê¸° ìœ„í•´ ë‹¤ì¤‘ ì“°ë ˆë“œì—ì„œë„ run() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì“°ë ˆë“œ í’€ì—ì„œ ëŒ€ê¸° ì¤‘ì¸ ì“°ë ˆë“œë“¤ì€ ëª¨ë‘ ë™ë“±í•œ ìê²©ì„ ê°€ì§€ë©° io_contextëŠ” í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸°ìœ„í•´ ì„ì˜ë¡œ ê·¸ë“¤ì¤‘ í•œê°œë¥¼ ì„ íƒí•˜ê²Œë©ë‹ˆë‹¤.</p><blockquote><p>Multiple threads may call the run() function to set up a pool of threads from which the io_context may execute handlers. All threads that are waiting in the pool are equivalent and the io_context may choose any one of them to invoke a handler.</p></blockquote><p>run() í•¨ìˆ˜ë¡œ ë¶€í„° ë¹ ì ¸ë‚˜ì˜¤ê¸° ìœ„í•œ ì¼ë°˜ì ì¸ ë°©ë²•ì€ io_context ê°ì²´ê°€ ì¢…ë£Œë˜ë„ë¡í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. run(), run_one(), poll() ë˜ëŠ” poll_one() í•¨ìˆ˜ë¥¼ restart() í•¨ìˆ˜ í˜¸ì¶œì—†ì´ ì—°ì†í•´ì„œ í˜¸ì¶œí•˜ëŠ” ê²½ìš°ì—ëŠ” ê³§ë°”ë¡œ í•´ë‹¹ í•¨ìˆ˜ë¥¼ ë¹ ì ¸ë‚˜ì˜¤ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>A normal exit from the run() function implies that the io_context object is stopped (the stopped() function returns true). Subsequent calls to run(), run_one(), poll() or poll_one() will return immediately unless there is a prior call to restart().</p></blockquote><p>ì—¬ê¸°ì„œ ì €í¬ê°€ ì£¼ëª©í•  ë‚´ìš©ì€ io_context::run í•¨ìˆ˜ëŠ” (ì˜ë„ì ì¸ ì¢…ë£Œ í•¨ìˆ˜ì˜ í˜¸ì¶œì„ ì œì™¸í•˜ê³ ëŠ”) io_context ìƒì˜ ëª¨ë“  ì‘ì—…ì´ ì¢…ë£Œë˜ê³ , ë”ì´ìƒ io_contextì— í• ë‹¹(dispatch)ëœ í•¸ë“¤ëŸ¬ê°€ ì—†ì„ë•Œê¹Œì§€ë§Œ ë¸”ë¡(block)ìƒíƒœë¥¼ ìœ ì§€í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><br><h2 id="io-context-run-í•¨ìˆ˜ê°€-ë°˜í™˜ë˜ì§€-ì•Šë„ë¡-í•˜ëŠ”-ë°©ë²•"><a href="#io-context-run-í•¨ìˆ˜ê°€-ë°˜í™˜ë˜ì§€-ì•Šë„ë¡-í•˜ëŠ”-ë°©ë²•" class="headerlink" title="io_context::run í•¨ìˆ˜ê°€ ë°˜í™˜ë˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ë°©ë²•"></a>io_context::run í•¨ìˆ˜ê°€ ë°˜í™˜ë˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ë°©ë²•</h2><p>ê·¸ë ‡ë‹¤ë©´ io_contextì— ë‹¹ì¥ì— í• ë‹¹í•  ì‘ì—…ì€ ì—†ë”ë¼ë„ run í•¨ìˆ˜ë¥¼ ë¸”ë¡ìƒíƒœë¡œ ìœ ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œìš”? ì—¬ê¸°ì„œ ë¶€í„°ëŠ” ì›ë¬¸ í¬ìŠ¤íŒ…ì— ëŒ€í•œ ë²ˆì—­ ë‚´ìš©ì…ë‹ˆë‹¤.</p><br><p><strong>io_context::run</strong>ì€ ëª¨ë“  ì˜ˆì•½ëœ ì‘ì—…ì´ ì™„ë£Œë ë•Œê¹Œì§€ ì‹¤í–‰ ìƒíƒœë¥¼ ìœ ì§€í•©ë‹ˆë‹¤. ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œëœ ì´í›„ì— <strong>io_context::run</strong>ì€ ë°˜í™˜ë ê²ƒì´ë©°, í•´ë‹¹ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ì“°ë ˆë“œëŠ” ë¸”ë¡ì´ í•´ì œë  ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p><strong>io_context::run</strong> runs until all scheduled tasks are completed. After that <strong>io_context::run</strong> will return and the caller thread will unblock:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">boost::asio::io_context io_context;</span><br><span class="line"><span class="comment">// Schedule some tasks</span></span><br><span class="line">io_context.run();</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Job's done! Continue the execution\n"</span>;</span><br></pre></td></tr></tbody></table></figure></div></figure><p>í•˜ì§€ë§Œ ë•Œë•Œë¡œ ìˆ˜í–‰í•  ì‘ì—…ì˜ ìœ ë¬´ì— ê´€ê³„ì—†ì´ io_context::runì˜ ì‹¤í–‰ ìƒíƒœë¥¼ ìœ ì§€í•´ì•¼í•˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. ì§€ê¸ˆê¹Œì§€ ì‚´í´ë³´ì•˜ë˜ ì„œë²„ë“¤ì€ í•­ìƒ <strong>async_accept</strong>ë¥¼ ìˆ˜í–‰ì¤‘ì´ì—ˆê¸°ë•Œë¬¸ì— ì ì–´ë„ í•˜ë‚˜ì˜ ì˜ˆì•½ëœ ì‘ì—…ì„ ê³„ì†í•´ì„œ ê°€ì§€ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸°ë•Œë¬¸ì— ìš°ë¦¬ëŠ” íŠ¹ì •í•œ ë°©ë²•ì„ í™œìš©í•˜ì—¬ ê·¸ë“¤ì„ ì‹¤í–‰ì¤‘ì¸ ìƒíƒœë¡œ ìœ ì§€í•´ì•¼í•  í•„ìš”ê°€ ì—†ì—ˆìŠµë‹ˆë‹¤.</p><blockquote><p>However sometimes you may need to keep it running regardless if there are tasks to execute or not. Servers weâ€™ve reviewed so far were always doing <strong>async_accept</strong>, so they always had at least one task scheduled, so we didnâ€™t really need to keep them running in such a way. </p></blockquote><p>í•˜ì§€ë§Œ í´ë¼ì´ì–¸íŠ¸ëŠ” <strong>async_accept</strong> ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•Šìœ¼ë©°, ê·¸ê²ƒì˜ ì…ì¥ì—ì„œ ì–´ë– í•œ íŠ¹ì • ì‹œì ì— ì˜ˆì•½ëœ ì‘ì—…ì´ ì—†ë‹¤ëŠ” ê²ƒì€ ì§€ê·¹íˆ ì¼ë°˜ì ì¸ ìƒí™©ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ìƒí™©ì—ì„œ <strong>io_context::run</strong> í•¨ìˆ˜ê°€ ë°˜í™˜ë˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ ì—¬ëŸ¬ë¶„ì€ <strong>boost::asio::executor_work_guard</strong> í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ê²ƒì˜ ì´ë¦„ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ëŠ” ê´€ê³„ë¡œ ë³„ì¹­(alias)ì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><blockquote><p>However a client doesnâ€™t do <strong>async_accept</strong> and itâ€™s a normal thing for it not to have scheduled tasks at some point at all. To prevent <strong>io_context::run</strong> from returning you should use <strong>boost::asio::executor_work_guard</strong>(a former <strong>io_context::work</strong> which is currently deprecated) class instance. Its name is too long, so letâ€™s alias it right away:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> work_guard_type = boost::asio::executor_work_guard&lt;boost::asio::io_context::executor_type&gt;;</span><br><span class="line"></span><br><span class="line">boost::asio::io_context io_context;</span><br><span class="line"><span class="function">work_guard_type <span class="title">work_guard</span><span class="params">(io_context.get_executor())</span></span>;</span><br><span class="line"><span class="comment">// Schedule some tasks or not</span></span><br><span class="line">io_context.run();</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Sorry, we'll never reach this!\n"</span>;</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ì—¬ëŸ¬ë¶„ì€ ì—¬ì „íˆ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ê°•ì œë¡œ í˜¹ì€ ìš°ì•„í•˜ê²Œ ì¢…ë£Œí•˜ê¸° ìœ„í•œ ë°©ë²•ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ <strong>io_context::stop</strong> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>You still need a way to stop your application somehow, and to stop it gracefully. You may use <strong>io_context::stop</strong> function:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">boost::asio::io_context io_context;</span><br><span class="line"><span class="function">work_guard_type <span class="title">work_guard</span><span class="params">(io_context.get_executor())</span></span>;</span><br><span class="line"><span class="comment">// Schedule some tasks or not</span></span><br><span class="line"><span class="function"><span class="built_in">std</span>::thread <span class="title">watchdog</span><span class="params">([&amp;]</span></span></span><br><span class="line"><span class="function"><span class="params">{</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="built_in">std</span>::this_thread::sleep_for(<span class="number">10</span>s);</span></span></span><br><span class="line"><span class="function"><span class="params">    io_context.stop(); <span class="comment">// That's OK, io_context::stop is thread-safe</span></span></span></span><br><span class="line"><span class="function"><span class="params">})</span></span>;</span><br><span class="line">io_context.run();</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"We stopped after 10 seconds of running\n"</span>;</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ìœ„ ê²½ìš°ì— <strong>io_context::run</strong> í•¨ìˆ˜ëŠ” ê·¸ ì¦‰ì‹œ ì¢…ë£Œë˜ì§€ëŠ” ì•Šì„ ê²ƒì´ì§€ë§Œ ê°€ì¥ ì ì ˆí•œ ì‹œì ì— ì¢…ë£Œë  ê²ƒì´ë©° ë‚¨ì•„ìˆëŠ” ì˜ˆì•½ ì‘ì—…ë“¤ì€ ë²„ë ¤ì§€ê²Œ ë  ê²ƒì…ë‹ˆë‹¤. ì´ê²ƒì€ ì •í™•íˆ ìš°ë¦¬ê°€ ì›í•˜ë˜ ë™ì‘ì¼ ê²ë‹ˆë‹¤.</p><blockquote><p>In that case <strong>io_context::run</strong> wonâ€™t stop right away but do this in the nearest suitable point of time, and the rest of scheduled tasks will be discarded. And that may be exactly what youâ€™re needed.</p></blockquote><p>ì—¬ëŸ¬ë¶„ì€ ë˜í•œ ì˜ˆì•½ëœ ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ë‹¤ ê·¸ ì´í›„ì— <strong>io_context::run</strong> í•¨ìˆ˜ê°€ ë°˜í™˜ë˜ê¸¸ ì›í• ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ìœ„í•´ <strong>io_context::work</strong> í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ íŒŒê´´í•´ì£¼ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤. íŒŒê´´í•˜ëŠ” ì—°ì‚° ë˜í•œ ì“°ë ˆë“œì— ì•ˆì „í•©ë‹ˆë‹¤.</p><blockquote><p>You may also need to wait until all scheduled tasks are completed and return from <strong>io_context::run</strong> after that. To do so you just need to destroy <strong>io_context::work</strong> class instance. This operation is also thread-safe:</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">boost::asio::io_context io_context;</span><br><span class="line"><span class="keyword">auto</span> work_guard = <span class="built_in">std</span>::make_unique&lt;work_guard_type&gt;(io_context.get_executor());</span><br><span class="line"><span class="comment">// Schedule some tasks or not</span></span><br><span class="line"><span class="function"><span class="built_in">std</span>::thread <span class="title">watchdog</span><span class="params">([&amp;]</span></span></span><br><span class="line"><span class="function"><span class="params">{</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="built_in">std</span>::this_thread::sleep_for(<span class="number">10</span>s);</span></span></span><br><span class="line"><span class="function"><span class="params">    work_guard.reset(); <span class="comment">// Work guard is destroyed, io_context::run is free to return</span></span></span></span><br><span class="line"><span class="function"><span class="params">})</span></span>;</span><br><span class="line">io_context.run();</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"We stopped after 10+ seconds of running\n"</span>;</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ë§Œì•½ <strong>io_context::run</strong> í•¨ìˆ˜ê°€ ë°˜í™˜ëœ í›„ ê·¸ê²ƒì„ ë‹¤ì‹œ í˜¸ì¶œí•˜ê³  ì‹¶ë‹¤ë©´ ê·¸ ì „ì— <strong>io_context::restart</strong> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼í•©ë‹ˆë‹¤.</p><blockquote><p>If youâ€™re going to call <strong>io_context::run</strong> once again after it returned, then you should call <strong>io_context::restart</strong> before that.</p></blockquote><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">boost::asio::io_context context;</span><br><span class="line">boost::asio::post(context, [](){ <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"hello boost::asio::post in context first"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; });</span><br><span class="line">temp_context.run();</span><br><span class="line">boost::asio::post(temp_context, [](){ <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"hello boost::asio::post in context second"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; });</span><br><span class="line">temp_context.restart();</span><br><span class="line">temp_context.run();</span><br></pre></td></tr></tbody></table></figure></div></figure><br><h2 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h2><p>ì§€ê¸ˆê¹Œì§€ io_contextì— ë‹¹ì¥ì— í• ë‹¹ëœ ì‘ì—…ì´ ì—†ë”ë¼ë„ io_context::run í•¨ìˆ˜ë¥¼ ì‹¤í–‰ ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ì •ë¦¬í•´ë³´ë©´ì„œ í¬ìŠ¤íŒ…ì„ ë§ˆì¹˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.<br><br></p><ul><li>io_contextì— í• ë‹¹ëœ ì‘ì—…ì´ ì—†ìœ¼ë©´ io_context::run í•¨ìˆ˜ëŠ” ì¦‰ì‹œ ë°˜í™˜ëœë‹¤.</li><li>io_contextì— ë‹¹ì¥ì— í• ë‹¹ëœ ì‘ì—…ì´ ì—†ëŠ” ìƒí™©ì—ì„œ io_context::run í•¨ìˆ˜ê°€ ë°˜í™˜ë˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ì„œëŠ” boost::asio::executor_work_guard í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë¼.</li><li>io_context::run í•¨ìˆ˜ê°€ ë°˜í™˜ëœ í›„ ë‹¤ì‹œ í•œë²ˆ í˜¸ì¶œí•˜ê³  ì‹¶ë‹¤ë©´ io_context::restart í•¨ìˆ˜ë¥¼ ë¨¼ì € í˜¸ì¶œí•˜ë¼.</li></ul><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>Reference</strong></p><ul><li><a href="https://www.boost.org/doc/libs/1_78_0/doc/html/boost_asio/reference/io_context/run/overload1.html">https://www.boost.org/doc/libs/1_78_0/doc/html/boost_asio/reference/io_context/run/overload1.html</a></li><li><a href="https://dens.website/tutorials/cpp-asio/work">https://dens.website/tutorials/cpp-asio/work</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/C/">C++</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/boost-asio/">boost asio</category>
      
      <category domain="https://chelseafandev.github.io/tags/io-context/">io_context</category>
      
      <category domain="https://chelseafandev.github.io/tags/io-context-run/">io_context run</category>
      
      <category domain="https://chelseafandev.github.io/tags/io-context-block/">io_context block</category>
      
      
      <comments>https://chelseafandev.github.io/2022/01/11/prevent-io-context-run-from-returning/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>boost io_contextì— ëŒ€í•œ ê³ ì°°</title>
      <link>https://chelseafandev.github.io/2021/12/28/boost-io-context/</link>
      <guid>https://chelseafandev.github.io/2021/12/28/boost-io-context/</guid>
      <pubDate>Tue, 28 Dec 2021 01:54:29 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;em&gt;&lt;strong&gt;ë­í•˜ëŠ” ë†ˆì¸ì§€ëŠ” ì•Œê³  ì“°ì&lt;/strong&gt;&lt;/em&gt; ì‹œë¦¬ì¦ˆì˜ ì²«ë²ˆì§¸ ì£¼ì œëŠ” &lt;code&gt;boost io_context&lt;/code&gt;ì…ë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><em><strong>ë­í•˜ëŠ” ë†ˆì¸ì§€ëŠ” ì•Œê³  ì“°ì</strong></em> ì‹œë¦¬ì¦ˆì˜ ì²«ë²ˆì§¸ ì£¼ì œëŠ” <code>boost io_context</code>ì…ë‹ˆë‹¤.</p><span id="more"></span><p>ì´ë²ˆ ê¸°íšŒì— boost ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë‹¤ë³´ë©´ í•œë²ˆì¯¤ì€ ë§ˆì£¼ì¹˜ê²Œë˜ëŠ” io_contextì— ëŒ€í•´ ìƒê°í•´ë³´ëŠ” ì‹œê°„ì„ ê°–ê² ìŠµë‹ˆë‹¤.</p><br><!-- toc --><br><hr><h1 id="Boost-Asio"><a href="#Boost-Asio" class="headerlink" title="Boost Asio"></a>Boost Asio</h1><p>ìš°ì„  io_contextì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ê¸° ì „ì— Boost Asioë¥¼ ê°„ëµí•˜ê²Œ ì†Œê°œí•˜ê³  ë„˜ì–´ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. boost ê³µì‹ í™ˆí˜ì´ì§€ì˜ ë‚´ìš©ì„ ì°¸ê³ í•˜ì—¬ ì‘ì„±í•˜ì˜€ìœ¼ë‹ˆ ì›ë¬¸ ë‚´ìš©ì€ <a href="https://www.boost.org/doc/libs/1_78_0/doc/html/boost_asio/overview.html">ì—¬ê¸°</a>ë¥¼ ì°¸ì¡°í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p><br><p>Boost.AsioëŠ” ì“°ë ˆë“œì™€ ëª…ì‹œì  Lockingì„ ê¸°ë°˜ìœ¼ë¡œí•œ ë™ì‹œì„± ëª¨ë¸ì˜ ì‚¬ìš©ì„ í”„ë¡œê·¸ë¨ì—ê²Œ ìš”êµ¬í•˜ì§€ ì•Šìœ¼ë©´ì„œ ëŠë¦° I/O operationì„ ê´€ë¦¬í•˜ëŠ” ë„êµ¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤. (ì´ëŠ” Boost.Asio ë‚´ë¶€ì ìœ¼ë¡œ ë™ì‹œì„± ì²˜ë¦¬ë¥¼ í• ê±°ë‹ˆê¹ ì‚¬ìš©ìë“¤ì€ ê±±ì •ë§ê³  ì‚¬ìš©í•˜ë¼ëŠ” ì˜ë¯¸ë¡œë„ ë³¼ ìˆ˜ ìˆì£ .)</p><blockquote><p>Boost.Asio provides the tools to manage these long running operations, without requiring programs to use concurrency models based on threads and explicit locking.</p></blockquote><p>ì†Œì¼“ì„ ì˜ˆë¡œ ë“¤ì–´ Boost.Asioì—ì„œ ì‚¬ìš©í•˜ëŠ” ìš©ì–´ë“¤ì— ëŒ€í•´ ì¡°ê¸ˆ ë” ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><br><h2 id="ë™ê¸°-ì—°ê²°"><a href="#ë™ê¸°-ì—°ê²°" class="headerlink" title="ë™ê¸° ì—°ê²°"></a>ë™ê¸° ì—°ê²°</h2><p>ì—¬ëŸ¬ë¶„ì˜ í”„ë¡œê·¸ë¨ì€ ì ì–´ë„ í•œ ê°œ ì´ìƒì˜ (boost::asio::io_contextë‚˜ boost::asio::thread_pool ë˜ëŠ” boost::asio::system_context ê°ì²´ì™€ ê°™ì€)I/O execution contextë¥¼ ê°€ì§€ê³  ìˆì„ ê²ƒì…ë‹ˆë‹¤. I/O execution contextëŠ” OSì˜ I/O ì„œë¹„ìŠ¤ì— ëŒ€í•œ í”„ë¡œê·¸ë¨ì˜ ë§í¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p><blockquote><p><strong>Your program</strong> will have at least one <strong>I/O execution context</strong>, such as an boost::asio::io_context object, boost::asio::thread_pool object, or boost::asio::system_context. This <strong>I/O execution context</strong> represents <strong>your program</strong>â€˜s link to the <strong>operating system</strong>â€˜s I/O services.</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">boost::asio::io_context io_context;</span><br></pre></td></tr></table></figure><br><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/boost-asio-sync-socket.png" alt=""></div><br><ol><li>I/O object(ì—¬ê¸°ì„œëŠ” socket)ì—ì„œ connect í˜¸ì¶œ<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">boost::asio::ip::<span class="function">tcp::socket <span class="title">socket</span><span class="params">(io_context)</span></span>;</span><br><span class="line">socket.<span class="built_in">connect</span>(server_endpoint);</span><br></pre></td></tr></table></figure></li><li>I/O objectëŠ” I/O execution contextì—ê²Œ ìš”ì²­ ì „ë‹¬</li><li>I/O execution contextëŠ” connect ë™ì‘ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ OS í˜¸ì¶œ</li><li>OSëŠ” I/O execution contextì—ê²Œ ìˆ˜í–‰ ê²°ê³¼ë¥¼ ë¦¬í„´</li><li>I/O execution contextëŠ” boost::system::error_codeì— ìˆ˜í–‰ ê²°ê³¼ ë°œìƒí•œ ì—ëŸ¬ë¥¼ í•´ì„í•˜ê³  ì´ë¥¼ I/O objectì—ê²Œ ë‹¤ì‹œ ì „ë‹¬</li><li>I/O objectëŠ” ìˆ˜í–‰ì— ì‹¤íŒ¨í–ˆì„ ê²½ìš° ì˜ˆì™¸ë¥¼ ë˜ì§</li></ol><br><h2 id="ë¹„ë™ê¸°-ì—°ê²°"><a href="#ë¹„ë™ê¸°-ì—°ê²°" class="headerlink" title="ë¹„ë™ê¸° ì—°ê²°"></a>ë¹„ë™ê¸° ì—°ê²°</h2><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/boost-asio-async-socket.png" alt=""></div><br><ol><li><p>I/O objectì—ì„œ async_connect í˜¸ì¶œ(your_completion_handlerëŠ” í•¨ìˆ˜ ë˜ëŠ” í•¨ìˆ˜ ê°ì²´ì„)</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">your_completion_handler</span><span class="params">(<span class="keyword">const</span> boost::system::error_code&amp; ec)</span></span>;</span><br><span class="line">socket.<span class="built_in">async_connect</span>(server_endpoint, your_completion_handler);</span><br></pre></td></tr></table></figure></li><li><p>I/O objectëŠ” I/O execution contextì—ê²Œ ìš”ì²­ ì „ë‹¬</p></li><li><p>I/O execution contextëŠ” async_connect ë™ì‘ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ OS í˜¸ì¶œ(ë™ê¸° ì—°ê²°ê³¼ ë‹¤ë¥´ê²Œ async_connectì˜ ìˆ˜í–‰ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ì§€ëŠ” ì•ŠìŒ)</p></li></ol><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/boost-asio-async-socket-2.png" alt=""></div><ol start="4"><li>OSëŠ” íì— ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨ async_connect ìˆ˜í–‰ì´ ì™„ë£Œëë‹¤ëŠ” ê²ƒì„ ì•Œë¦¼</li><li>I/O execution contextë¡œ io_contextë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” io_context::run()í•¨ìˆ˜ë¥¼ ë°˜ë“œì‹œ í˜¸ì¶œí•´ì•¼í•¨. io_context::run()í•¨ìˆ˜ëŠ” ì™„ë£Œë˜ì§€ ì•Šì€ ë¹„ë™ê¸° ìˆ˜í–‰ì´ ìˆëŠ” ê²½ìš°ì—ëŠ” block ìƒíƒœì´ë¯€ë¡œ ëŒ€ê²Œ ìµœì´ˆ ë¹„ë™ê¸° ìˆ˜í–‰ì„ ì‹œì‘í•˜ìë§ˆì í•´ë‹¹ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•¨</li><li>io_context::run()í•¨ìˆ˜ ë‚´ì—ì„œ I/O execution contextëŠ” íì— ì¶”ê°€ëœ ìˆ˜í–‰ ê²°ê³¼ë“¤ì„ ë½‘ì•„ë‚´ì–´ error_codeì— í•´ì„ ê²°ê³¼ë¥¼ ì €ì¥í•˜ê³  handler í•¨ìˆ˜ì—ê²Œ ì „ë‹¬í•¨</li></ol><p>ë™ê¸° ë° ë¹„ë™ê¸° ì†Œì¼“ ì—°ê²°ì— ëŒ€í•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ io_contextì˜ ê°œë…ì„ ì •ë¦¬í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.  </p><blockquote><p>ìœ ì € ê³µê°„ì—ì„œ ì»¤ë„ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì‹œìŠ¤í…œ ì½œì„ ë‚ ë¦¬ë ¤ê³  í• ë•Œ ì‹¤ì œ ì»¤ë„ê³¼ì˜ í†µì‹ ì„ ì¤‘ê³„í•˜ëŠ” ì£¼ì²´ì´ë‹¤. ì¦‰, ì‹¤ì œ ì‹œìŠ¤í…œ ì½œ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ëŠ” ê³µê°„ì´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.</p></blockquote><br> <hr><h1 id="Execution-Context"><a href="#Execution-Context" class="headerlink" title="Execution Context"></a>Execution Context</h1><p>io_contextëŠ” I/O ì‘ì—…ì„ ìœ„í•œ ë§¤ê°œì²´ì´ì ì¼ì¢…ì˜ ì‘ì—… ê³µê°„ì´ë¼ëŠ”ê±´ ì–´ëŠì •ë„ ëŠë‚Œì´ ì˜¨ ê²ƒê°™ìŠµë‹ˆë‹¤. ì´ì œëŠ” io_contextë¥¼ í¬í•¨í•˜ëŠ” ê°œë…ì¸ execution contextì— ëŒ€í•´ ì¡°ê¸ˆ ë” ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. (í•´ë‹¹ ë‚´ìš©ì€ <a href="https://think-async.com/executors/Executors_and_Asynchronous_Operations_Slides.pdf">Executors and Asynchronous Operations</a>ë¥¼ ì°¸ì¡°í•˜ì—¬ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.)</p><p>execution contextëŠ” <U>í•¨ìˆ˜ ê°ì²´ê°€ ì‹¤í–‰ë˜ëŠ” ê³µê°„</U>ì…ë‹ˆë‹¤.</p><blockquote><ul><li>An execution context is <U>a place where function objects are executed.</U></li><li>Examples<ul><li>A fixed-size thread pool</li><li>A loop scheduler</li><li>An asio::io_context</li><li>The set of all threads in the process</li></ul></li></ul></blockquote><p>ë§ê·¸ëŒ€ë¡œ í•¨ìˆ˜ ê°ì²´(ìš°ë¦¬ê°€ í”íˆ í•¸ë“¤ëŸ¬ë¼ê³  ë¶€ë¥´ëŠ”)ê°€ ì‹¤ì œë¡œ ì‹¤í–‰ë˜ëŠ” ê³µê°„ì´ë¼ëŠ” ê²ë‹ˆë‹¤. ëŒ€í‘œì ì¸ execution contextì¸ io_contextì™€ thread pool ì‚¬ìš© ì˜ˆì œë¥¼ í•œë²ˆ ì‚´í´ë´…ì‹œë‹¤.</p><br><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/asio.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  boost::asio::io_context context;</span><br><span class="line">  boost::asio::post(context, [](){ <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"hello boost::asio::post in context"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; });</span><br><span class="line">  context.run();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><p>ìœ„ ì½”ë“œëŠ” boost::asio::post í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒë‹¤ ì‹ìœ¼ë¡œ ì •ì˜ëœ í•¨ìˆ˜ ê°ì²´ë¥¼ ìœ„ì—ì„œ ì •ì˜í•œ io_contextì—ì„œ ì‹¤í–‰ì‹œí‚¤ê² ë‹¤ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤. (ëŒë‹¤ ì‹ì€ closureë¼ëŠ” ì´ë¦„ì—†ëŠ” í•¨ìˆ˜ ê°ì²´ë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤. <a href="https://en.cppreference.com/w/cpp/language/lambda">ëŒë‹¤ ì‹ì˜ ì •ì˜</a>ëŠ” ì—¬ê¸°ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.)  </p><p>ì•„ ê·¸ë¦¬ê³  post í•¨ìˆ˜ ì•„ë˜ io_contextì˜ run í•¨ìˆ˜ëŠ” í•¨ìˆ˜ ê°ì²´ë¥¼ ì‹¤í–‰ì‹œí‚¬ ê³µê°„(ì—¬ê¸°ì„œëŠ” io_context)ì„ í™œì„±í™”ì‹œì¼œì£¼ëŠ” ì—­í• ì„ í•œë‹¤ê³  ìƒê°í•˜ì‹œë©´ ë  ê²ƒê°™ìŠµë‹ˆë‹¤. (run í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê³ ì„œëŠ” ëŒë‹¤ ì‹ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!)</p><br><p>ì•„ë˜ ì½”ë“œëŠ” ë§ˆì°¬ê°€ì§€ë¡œ boost::asio::post í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë²ˆì—ëŠ” ì§ì ‘ ì •ì˜í•œ í•¨ìˆ˜ test_functionì„ io_contextê°€ ì•„ë‹Œ thread_pool(ë˜ ë‹¤ë¥¸ execution contextë“¤ ì¤‘ í•˜ë‚˜ì£ )ì—ì„œ ì‹¤í–‰ì‹œí‚¤ê² ë‹¤ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤.</p><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/asio.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_function</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"hello boost::asio::post in thread pool"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  boost::asio::thread_pool tp;</span><br><span class="line">  boost::asio::post(tp, test_function);</span><br><span class="line">  tp.join();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><br><hr><h1 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h1><p>ì§€ê¸ˆê¹Œì§€ io_contextë¥¼ ì‹œì‘ìœ¼ë¡œ execution contextë¼ëŠ” ê°œë…ì„ ì¡°ê¸ˆì´ë‚˜ë§ˆ êµ¬ì²´í™”í•˜ëŠ” ì‹œê°„ì„ ê°€ì ¸ë´¤ìŠµë‹ˆë‹¤. í•œì¤„ë¡œ ì •ë¦¬í•˜ë©° ë§ˆì¹˜ê² ìŠµë‹ˆë‹¤.</p><blockquote><p>Execution ContextëŠ” í•¨ìˆ˜ ë˜ëŠ” í•¨ìˆ˜ ê°ì²´ê°€ ì‹¤í–‰ë˜ëŠ” ê³µê°„ì´ë‹¤.</p></blockquote><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>Reference</strong></p><ul><li><a href="https://www.boost.org/doc/libs/1_78_0/doc/html/boost_asio/overview.html">https://www.boost.org/doc/libs/1_78_0/doc/html/boost_asio/overview.html</a></li><li><a href="https://www.boost.org/doc/libs/1_78_0/doc/html/boost_asio/overview/rationale.html">https://www.boost.org/doc/libs/1_78_0/doc/html/boost_asio/overview/rationale.html</a></li><li><a href="https://www.boost.org/doc/libs/1_78_0/doc/html/boost_asio/overview/core/basics.html">https://www.boost.org/doc/libs/1_78_0/doc/html/boost_asio/overview/core/basics.html</a></li><li><a href="https://think-async.com/executors/Executors_and_Asynchronous_Operations_Slides.pdf">https://think-async.com/executors/Executors_and_Asynchronous_Operations_Slides.pdf</a></li><li><a href="https://en.cppreference.com/w/cpp/language/lambda">https://en.cppreference.com/w/cpp/language/lambda</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/C/">C++</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/boost-asio/">boost asio</category>
      
      <category domain="https://chelseafandev.github.io/tags/io-context/">io_context</category>
      
      <category domain="https://chelseafandev.github.io/tags/io-service/">io_service</category>
      
      <category domain="https://chelseafandev.github.io/tags/execution-context/">execution context</category>
      
      
      <comments>https://chelseafandev.github.io/2021/12/28/boost-io-context/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>IP ë¼ìš°íŒ… ê³¼ì •ì— ëŒ€í•´ ì•Œì•„ë³´ì</title>
      <link>https://chelseafandev.github.io/2021/12/06/ip-routing-flow/</link>
      <guid>https://chelseafandev.github.io/2021/12/06/ip-routing-flow/</guid>
      <pubDate>Mon, 06 Dec 2021 03:33:13 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;a href=&quot;https://chelseafandev.github.io/2021/12/06/ethernet-switching-flow/&quot;&gt;ì €ë²ˆ í¬ìŠ¤íŒ…&lt;/a&gt;ì— ì´ì–´ì„œ ì´ë²ˆì—ëŠ” L3 ìŠ¤ìœ„ì¹˜ì—ì„œì˜ IP ë¼ìš°íŒ… ê³¼ì •ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><a href="https://chelseafandev.github.io/2021/12/06/ethernet-switching-flow/">ì €ë²ˆ í¬ìŠ¤íŒ…</a>ì— ì´ì–´ì„œ ì´ë²ˆì—ëŠ” L3 ìŠ¤ìœ„ì¹˜ì—ì„œì˜ IP ë¼ìš°íŒ… ê³¼ì •ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p><span id="more"></span><p><a href="https://www.netmanias.com/ko/">ë„·ë§¤ë‹ˆì•„ì¦ˆ</a>ë¼ëŠ” ì‚¬ì´íŠ¸ì— ì´ 4í¸ì˜ ì‹œë¦¬ì¦ˆë¡œ ì—°ì¬ëœ L3 ìŠ¤ìœ„ì¹˜ì˜ íŒ¨í‚· ì „ë‹¬ì— ëŒ€í•œ ì•„ì£¼ ì–‘ì§ˆì˜ ê²Œì‹œë¬¼ì„ ì°¸ê³ í•˜ì—¬ ì •ë¦¬í•´ë³´ì•˜ìœ¼ë©°, ì‹¤ì œ ì—°ì¬ê¸€ì—ì„œëŠ” ìƒì„¸í•œ ê·¸ë¦¼ê³¼ í•¨ê»˜ L3 ìŠ¤ìœ„ì¹˜ ë‚´ë¶€ êµ¬ì¡°ë¥¼ ì¢€ ë” ì„¸ë¶„í™”í•˜ì—¬ ì„¤ëª…í•˜ê³  ìˆìœ¼ë‹ˆ ê´€ì‹¬ì´ ìˆìœ¼ì‹ ë¶„ë“¤ì€ <a href="https://www.netmanias.com/ko/?m=view&id=blog&no=5529">ì—¬ê¸°</a>ë¥¼ ì°¸ì¡°í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p><br><!-- toc --><p>ì„œë²„1ê³¼ ì„œë²„4ëŠ” ì„œë¡œ ë‹¤ë¥¸ VLAN(ì„œë²„1ì€ VLAN ID: 10, ì„œë²„4ëŠ” VLAN ID: 20)ì— ì¡´ì¬í•˜ë©°, ì„œë²„1ì˜ ARP í…Œì´ë¸”ì—ëŠ” L3 ìŠ¤ìœ„ì¹˜(ì—¬ê¸°ì„œëŠ” Gateway)ì˜ ì—”íŠ¸ë¦¬ê°€ ì´ë¯¸ ì¡´ì¬í•œë‹¤ê³  ê°€ì •í•˜ê² ìŠµë‹ˆë‹¤.<br><br></p><h3 id="ì„œë²„1ì—ì„œ-ì„œë²„4ë¡œ-íŒ¨í‚·-ì „ë‹¬-ARP-Request-Flooding"><a href="#ì„œë²„1ì—ì„œ-ì„œë²„4ë¡œ-íŒ¨í‚·-ì „ë‹¬-ARP-Request-Flooding" class="headerlink" title="ì„œë²„1ì—ì„œ ì„œë²„4ë¡œ íŒ¨í‚· ì „ë‹¬ - ARP Request Flooding"></a>ì„œë²„1ì—ì„œ ì„œë²„4ë¡œ íŒ¨í‚· ì „ë‹¬ - ARP Request Flooding</h3><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/ip-routing-arp-request-flooding.png" alt="ARP Request Flooding"><span class="caption">ARP Request Flooding</span></div><ol><li>ì„œë²„1ì—ì„œ ì„œë²„4ë¡œ íŒ¨í‚·ì„ ë³´ë‚´ë ¤ê³  í•©ë‹ˆë‹¤.</li><li>ì„œë²„1ì˜ <strong>ë¼ìš°íŒ… í…Œì´ë¸”</strong>ì„ ì°¸ì¡°(Destination ì£¼ì†Œ ë³„ ê²Œì´íŠ¸ì›¨ì´ IPì™€ ì¶œë ¥ í¬íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ)í•˜ì—¬ ì„œë²„4ì˜ IPì£¼ì†ŒëŠ” ë””í´íŠ¸ ë¼ìš°íŠ¸ì— ë§¤ì¹­ëœë‹¤ëŠ” ì‚¬ì‹¤ê³¼ Gateway IPì£¼ì†Œ(ì—¬ê¸°ì„œëŠ” L3 ìŠ¤ìœ„ì¹˜ì˜ ì£¼ì†Œì„) ë° ì¶œë ¥ í¬íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li>ì„œë²„1ì€ <strong>ARP í…Œì´ë¸”</strong>ì„ ì°¸ì¡°í•˜ì—¬ Gateway IPì£¼ì†Œì— ëŒ€í•œ MAC ì£¼ì†Œë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</li><li>ì¶œë ¥ í¬íŠ¸ì™€ MAC ì£¼ì†Œë¥¼ í™•ì¸í–ˆìœ¼ë‹ˆ ì„œë²„1ì€ ì„œë²„4ë¡œ íŒ¨í‚·ì„ ì†¡ì‹ í•©ë‹ˆë‹¤.</li><li>í•´ë‹¹ íŒ¨í‚·ì€ ì¶œë ¥ í¬íŠ¸ë¥¼ í†µí•´ L3 ìŠ¤ìœ„ì¹˜ë¡œ ì´ë™í•©ë‹ˆë‹¤.</li><li>íŒ¨í‚·ì„ ìˆ˜ì‹ í•œ L3 ìŠ¤ìœ„ì¹˜ëŠ” í•´ë‹¹ íŒ¨í‚·ì„ ë²„í¼(Ingress Packet Buffer)ì— ì ì‹œ ì €ì¥í•´ë‘¡ë‹ˆë‹¤.</li><li>ì´ì œ L3 ìŠ¤ìœ„ì¹˜ì—ì„œ ìˆ˜ì‹ í•œ íŒ¨í‚·ì˜ <strong>Source MAC ì£¼ì†Œë¥¼ í•™ìŠµ</strong>í•  ì°¨ë¡€ì…ë‹ˆë‹¤. ë™ì¼ VLANì„ ì†Œìœ í•œ Line Cardë“¤ì—ë§Œ Source MAC ì£¼ì†Œ ì •ë³´ë¥¼ ê³µìœ í•˜ì—¬ ê°ê°ì˜ <strong>MAC í…Œì´ë¸”</strong>ì— ê·¸ ê°’(VLAN, Source MAC ì£¼ì†Œ, í¬íŠ¸)ì„ ì €ì¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.</li><li>ë‹¤ìŒìœ¼ë¡œ í•´ë‹¹ íŒ¨í‚·ì„ <strong>IP ë¼ìš°íŒ…</strong>ì‹œí‚¬ì§€ <strong>Ethernet ìŠ¤ìœ„ì¹­</strong>ì‹œí‚¬ê²ƒì¸ì§€ë¥¼ ê²°ì •í•˜ëŠ”ë° ì´ë¥¼ ìœ„í•´ Destination MAC ì£¼ì†Œë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.<div class="alert info"><p>Destination MAC ì£¼ì†Œê°€ L3 ìŠ¤ìœ„ì¹˜ì˜ MAC ì£¼ì†Œì¸ ê²½ìš°ì—ëŠ”, <strong>IP ë¼ìš°íŒ…</strong><br>Destination MAC ì£¼ì†Œê°€ L3 ìŠ¤ìœ„ì¹˜ì˜ MAC ì£¼ì†Œê°€ ì•„ë‹Œ ê²½ìš°ì—ëŠ”, <strong>Ethernet ìŠ¤ìœ„ì¹­</strong></p></div><br></li><li>ì´ ê²½ìš°ì—ëŠ” í•´ë‹¹ íŒ¨í‚·ì˜ Destination MAC ì£¼ì†Œê°€ Gateway ì¦‰, L3 ìŠ¤ìœ„ì¹˜ì˜ MAC ì£¼ì†Œì´ë¯€ë¡œ IP ë¼ìš°íŒ…ì„ ì‹œí‚µë‹ˆë‹¤.</li><li>IP ë¼ìš°íŒ…ì„ ìœ„í•´ L3 ìŠ¤ìœ„ì¹˜ëŠ” Destination IP ì£¼ì†Œì— ëŒ€í•œ FIB lookup(LPM: Longest Prefix Match)ì„ ìˆ˜í–‰í•˜ì—¬ í•´ë‹¹ íŒ¨í‚·ì´ L3 ìŠ¤ìœ„ì¹˜ì™€ ë°”ë¡œ ì—°ê²°ë˜ì–´ ìˆëŠ” ëª©ì ì§€ì¸ ì„œë²„4ë¡œ ê°€ê³ ìí•œë‹¤ëŠ” ê²ƒì„ í™•ì¸í•©ë‹ˆë‹¤.</li><li>ë‹¤ìŒìœ¼ë¡œ L3 ìŠ¤ìœ„ì¹˜ëŠ” ARP í…Œì´ë¸”ì„ í™•ì¸í•˜ì—¬ Destination IP ì£¼ì†Œì— ëŒ€í•œ MAC ì£¼ì†Œê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</li><li>ë§Œì•½ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤(ARP Miss!)ë©´ ë™ì¼í•œ VLANì— ì†í•œ Line Cardë“¤ì—ê²Œ ARP Request íŒ¨í‚·ì„ Floodingí•©ë‹ˆë‹¤.</li></ol><hr><h3 id="ì„œë²„1ì—ì„œ-ì„œë²„4ë¡œ-íŒ¨í‚·-ì „ë‹¬-ARP-Reply-ìˆ˜ì‹ "><a href="#ì„œë²„1ì—ì„œ-ì„œë²„4ë¡œ-íŒ¨í‚·-ì „ë‹¬-ARP-Reply-ìˆ˜ì‹ " class="headerlink" title="ì„œë²„1ì—ì„œ ì„œë²„4ë¡œ íŒ¨í‚· ì „ë‹¬ - ARP Reply ìˆ˜ì‹ "></a>ì„œë²„1ì—ì„œ ì„œë²„4ë¡œ íŒ¨í‚· ì „ë‹¬ - ARP Reply ìˆ˜ì‹ </h3><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/ip-routing-arp-reply-receiving.png" alt="ARP Reply ìˆ˜ì‹ "><span class="caption">ARP Reply ìˆ˜ì‹ </span></div><ol><li>ARP Request íŒ¨í‚·ì„ ìˆ˜ì‹ í•œ ì„œë²„4, ì„œë²„5, ì„œë²„6ì¤‘ì— í•´ë‹¹ IP ì£¼ì†Œë¥¼ ì†Œìœ í•œ ì„œë²„4ê°€ ì´ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ARP Replyë¥¼ L3 ìŠ¤ìœ„ì¹˜ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.</li><li>ARP Reply íŒ¨í‚·ì„ ìˆ˜ì‹ í•œ L3 ìŠ¤ìœ„ì¹˜ëŠ” í•´ë‹¹ íŒ¨í‚·ì„ ë²„í¼(Ingress Packet Buffer)ì— ì ì‹œ ì €ì¥í•´ë‘¡ë‹ˆë‹¤.</li><li>ì´ì œ L3 ìŠ¤ìœ„ì¹˜ì—ì„œ ìˆ˜ì‹ í•œ íŒ¨í‚·ì˜ <strong>Source MAC ì£¼ì†Œë¥¼ í•™ìŠµ</strong>í•  ì°¨ë¡€ì…ë‹ˆë‹¤. ë™ì¼ VLANì„ ì†Œìœ í•œ Line Cardë“¤ì—ë§Œ Source MAC ì£¼ì†Œ ì •ë³´ë¥¼ ê³µìœ í•˜ì—¬ ê°ê°ì˜ <strong>MAC í…Œì´ë¸”</strong>ì— ê·¸ ê°’(VLAN, Source MAC ì£¼ì†Œ, í¬íŠ¸)ì„ ì €ì¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.</li><li>ë‹¤ìŒìœ¼ë¡œ í•´ë‹¹ íŒ¨í‚·ì„ <strong>IP ë¼ìš°íŒ…</strong>ì‹œí‚¬ì§€ <strong>Ethernet ìŠ¤ìœ„ì¹­</strong>ì‹œí‚¬ê²ƒì¸ì§€ë¥¼ ê²°ì •í•˜ëŠ”ë° ì´ë¥¼ ìœ„í•´ Destination MAC ì£¼ì†Œë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.</li><li>ì´ ê²½ìš°ì—ëŠ” í•´ë‹¹ íŒ¨í‚·ì˜ Destination MAC ì£¼ì†Œê°€ L3 ìŠ¤ìœ„ì¹˜ì˜ MAC ì£¼ì†Œì´ë¯€ë¡œ IP ë¼ìš°íŒ…ì„ ì‹œí‚µë‹ˆë‹¤.</li><li>ì—¬ê¸°ì„œ ë§Œì•½ í•´ë‹¹ íŒ¨í‚·ì˜ íƒ€ì…(Ethernet Headerì— ìˆëŠ” EtherType)ì´ ARP íŒ¨í‚·(EtherType = 0x0806)ì¸ ê²½ìš°ì—ëŠ” ë¼ìš°íŒ… ì‹œí‚¤ì§€ ì•Šê³  ë¬´ì¡°ê±´ Control Module(L3 ìŠ¤ìœ„ì¹˜ ë‚´ì— ì¡´ì¬í•˜ëŠ” íŠ¹ì • ëª¨ë“ˆ)ì´ë¼ëŠ” ê³³ìœ¼ë¡œ ì˜¬ë ¤ì¤ë‹ˆë‹¤.</li><li>ARP Reply íŒ¨í‚·ì„ ìˆ˜ì‹ í•œ Control Moduleì€ ARP í…Œì´ë¸”ì— ì„œë²„4ì˜ IP ì£¼ì†Œì— ëŒ€í•œ MACì£¼ì†Œë¥¼ ì €ì¥í•©ë‹ˆë‹¤.</li><li>ì—¬ê¸°ê¹Œì§€ ì™„ë£Œí•˜ë©´ ì´ì œ L3 ìŠ¤ìœ„ì¹˜ëŠ” ì„œë²„1ì—ì„œ ë°›ì€ íŒ¨í‚·ì„ ì„œë²„4ë¡œ ì†¡ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ol><hr><h3 id="ì„œë²„1ì—ì„œ-ì„œë²„4ë¡œ-íŒ¨í‚·-ì „ë‹¬-IP-ë¼ìš°íŒ…"><a href="#ì„œë²„1ì—ì„œ-ì„œë²„4ë¡œ-íŒ¨í‚·-ì „ë‹¬-IP-ë¼ìš°íŒ…" class="headerlink" title="ì„œë²„1ì—ì„œ ì„œë²„4ë¡œ íŒ¨í‚· ì „ë‹¬ - IP ë¼ìš°íŒ…"></a>ì„œë²„1ì—ì„œ ì„œë²„4ë¡œ íŒ¨í‚· ì „ë‹¬ - IP ë¼ìš°íŒ…</h3><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/ip-routing.png" alt="IP ë¼ìš°íŒ…"><span class="caption">IP ë¼ìš°íŒ…</span></div><ol><li>ì„œë²„1ì´ ëª©ì ì§€ ì£¼ì†Œê°€ ì„œë²„4ì¸ íŒ¨í‚·ì„ L3 ìŠ¤ìœ„ì¹˜ë¡œ ë³´ëƒ…ë‹ˆë‹¤.</li><li>íŒ¨í‚·ì„ ìˆ˜ì‹ í•œ L3 ìŠ¤ìœ„ì¹˜ëŠ” í•´ë‹¹ íŒ¨í‚·ì„ ë²„í¼(Ingress Packet Buffer)ì— ì ì‹œ ì €ì¥í•´ë‘¡ë‹ˆë‹¤.</li><li>Source MAC ì£¼ì†Œë¥¼ í•™ìŠµí•´ë³¼ê¹Œ í–ˆì§€ë§Œ í•´ë‹¹ íŒ¨í‚·ì˜ Source MAC ì£¼ì†ŒëŠ” ì´ë¯¸ í•™ìŠµëœ ì„œë²„1ì˜ ì •ë³´ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ ê±´ë„ˆëœë‹ˆë‹¤.</li><li>ì´ì œ ìˆ˜ì‹  íŒ¨í‚·ì˜ Destination IP ì£¼ì†Œë¡œ FIB lookupì„í•´ì„œ OIF(Outgoing Interface)ë¥¼ í™•ì¸(ì—¬ê¸°ì„œëŠ” ì„œë²„4ê°€ ì†í•œ VLAN IDë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ)í•©ë‹ˆë‹¤.</li><li>ê·¸ë¦¬ê³  ARP í…Œì´ë¸”ì„ ì°¸ì¡°í•˜ì—¬ Destination IPì— ëŒ€í•œ MAC ì£¼ì†Œë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</li><li>ë§ˆì§€ë§‰ìœ¼ë¡œ 5ë²ˆì—ì„œ ì°¾ì€ MAC ì£¼ì†Œë¥¼ í†µí•´ MAC í…Œì´ë¸”ì—ì„œ ì¶œë ¥ í¬íŠ¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</li><li>L3 ìŠ¤ìœ„ì¹˜ëŠ” ì•ì„œ ë²„í¼ì— ì ì‹œ ì €ì¥í•´ë‘” íŒ¨í‚·(2ë²ˆ ê³¼ì •ì„ ì°¸ê³ )ì„ ì¶œë ¥ì„ ìœ„í•œ ë²„í¼(Egress Packet Buffer)ë¡œ ì˜®ê¸´ í›„ 6ë²ˆì—ì„œ í™•ì¸ëœ MACì£¼ì†Œë¡œ í•´ë‹¹ íŒ¨í‚·ì„ ì†¡ì‹ í•©ë‹ˆë‹¤.</li><li>ì„œë²„1ì´ ì†¡ì‹ í•œ íŒ¨í‚·ì€ ìµœì¢…ì ìœ¼ë¡œ ì„œë²„4ì— ë„ë‹¬í•˜ê²Œë©ë‹ˆë‹¤.</li></ol><hr><h3 id="L3-ìŠ¤ìœ„ì¹˜-ë™ì‘ì˜-í•µì‹¬-ì •ë¦¬"><a href="#L3-ìŠ¤ìœ„ì¹˜-ë™ì‘ì˜-í•µì‹¬-ì •ë¦¬" class="headerlink" title="L3 ìŠ¤ìœ„ì¹˜ ë™ì‘ì˜ í•µì‹¬ ì •ë¦¬"></a>L3 ìŠ¤ìœ„ì¹˜ ë™ì‘ì˜ í•µì‹¬ ì •ë¦¬</h3><ul><li>L3 ìŠ¤ìœ„ì¹˜ëŠ” ìˆ˜ì‹  íŒ¨í‚·ì— ëŒ€í•´ í•­ìƒ Source MAC í•™ìŠµë¶€í„° ìˆ˜í–‰í•œë‹¤.</li><li>L3 ìŠ¤ìœ„ì¹˜ëŠ” ìˆ˜ì‹  íŒ¨í‚·ì˜ Destination MAC ì£¼ì†Œê°€ L3 ìŠ¤ìœ„ì¹˜ì˜ MAC ì£¼ì†Œì´ë©´ IP ë¼ìš°íŒ…ì‹œí‚¤ê³ , ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš°ëŠ” Ethernet ìŠ¤ìœ„ì¹­ì‹œí‚¨ë‹¤.</li><li>L3 ìŠ¤ìœ„ì¹˜ëŠ” IP ë¼ìš°íŒ… ê³¼ì •ì—ì„œ RIB/FIBì— ëª…ì‹œëœ OIF(Outgoing Interface)ê°€ ë¬¼ë¦¬ì  í¬íŠ¸ê°€ ì•„ë‹Œ VLAN ID ì •ë³´ê°€ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì‹¤ì œ íŒ¨í‚·ì„ ì†¡ì‹ í•  ì¶œë ¥ í¬íŠ¸ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ” MAC í…Œì´ë¸”ì„ ì°¸ì¡°í•´ì•¼í•œë‹¤. ì¦‰,<ol><li><strong>FIB</strong> lookupì„ í†µí•´ <strong>Next Hop IPì™€ OIF</strong>ë¥¼ ì•Œì•„ë‚´ê³ </li><li><strong>ARP í…Œì´ë¸”</strong> lookupì„ í†µí•´ Next Hop IPì— ëŒ€í•œ <strong>MAC ì£¼ì†Œ</strong>ë¥¼ ì•Œì•„ë‚´ê³  (ë§Œì•½ ëª©ì ì§€ê°€ L3 ìŠ¤ìœ„ì¹˜ì™€ ë°”ë¡œ ì—°ê²°ëœ ê²½ìš°ë¼ë©´, Destination IP ì£¼ì†Œì— ëŒ€í•œ MAC ì£¼ì†Œë¥¼ ì•Œì•„ëƒ„)</li><li><strong>MAC í…Œì´ë¸”</strong> lookupì„ í†µí•´ MAC ì£¼ì†Œì— ëŒ€í•œÂ <strong>ë¬¼ë¦¬ì  í¬íŠ¸</strong>ë¥¼ ì•Œì•„ë‚¸ë‹¤ (ë§Œì•½ IP ë¼ìš°íŒ… ê³¼ì •ì—ì„œ MAC í…Œì´ë¸”ì— í•´ë‹¹ ì—”íŠ¸ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´, VLAN í…Œì´ë¸”ì„ ì°¸ì¡°í•˜ì—¬ OIFì— ì†í•œ ëª¨ë“  ë¬¼ë¦¬ì  í¬íŠ¸ë¡œ íŒ¨í‚·ì„ Flooding í•¨)</li></ol></li></ul><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>Reference</strong></p><ul><li><a href="https://www.netmanias.com/ko/?m=view&amp;id=blog&amp;no=5529">https://www.netmanias.com/ko/?m=view&amp;id=blog&amp;no=5529</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC/">ë„¤íŠ¸ì›Œí¬</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/L3-%EC%8A%A4%EC%9C%84%EC%B9%98/">L3 ìŠ¤ìœ„ì¹˜</category>
      
      <category domain="https://chelseafandev.github.io/tags/ip-routing/">ip routing</category>
      
      <category domain="https://chelseafandev.github.io/tags/ip-%EB%9D%BC%EC%9A%B0%ED%8C%85/">ip ë¼ìš°íŒ…</category>
      
      <category domain="https://chelseafandev.github.io/tags/ARP-Request/">ARP Request</category>
      
      <category domain="https://chelseafandev.github.io/tags/ARP-Reply/">ARP Reply</category>
      
      
      <comments>https://chelseafandev.github.io/2021/12/06/ip-routing-flow/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Ethernet ìŠ¤ìœ„ì¹­ ê³¼ì •ì— ëŒ€í•´ ì•Œì•„ë³´ì</title>
      <link>https://chelseafandev.github.io/2021/12/06/ethernet-switching-flow/</link>
      <guid>https://chelseafandev.github.io/2021/12/06/ethernet-switching-flow/</guid>
      <pubDate>Mon, 06 Dec 2021 03:06:07 GMT</pubDate>
      
      <description>&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” L3 ìŠ¤ìœ„ì¹˜ì—ì„œì˜ Ethernet ìŠ¤ìœ„ì¹­ ê³¼ì •ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” L3 ìŠ¤ìœ„ì¹˜ì—ì„œì˜ Ethernet ìŠ¤ìœ„ì¹­ ê³¼ì •ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p><span id="more"></span><p><a href="https://www.netmanias.com/ko/">ë„·ë§¤ë‹ˆì•„ì¦ˆ</a>ë¼ëŠ” ì‚¬ì´íŠ¸ì— ì´ 4í¸ì˜ ì‹œë¦¬ì¦ˆë¡œ ì—°ì¬ëœ L3 ìŠ¤ìœ„ì¹˜ì˜ íŒ¨í‚· ì „ë‹¬ì— ëŒ€í•œ ì•„ì£¼ ì–‘ì§ˆì˜ ê²Œì‹œë¬¼ì„ ì°¸ê³ í•˜ì—¬ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì‹¤ì œ ì—°ì¬ê¸€ì—ì„œëŠ” ìƒì„¸í•œ ê·¸ë¦¼ê³¼ í•¨ê»˜ L3 ìŠ¤ìœ„ì¹˜ ë‚´ë¶€ êµ¬ì¡°ë¥¼ ì¢€ ë” ì„¸ë¶„í™”í•˜ì—¬ ì„¤ëª…í•˜ê³  ìˆìœ¼ë‹ˆ ê´€ì‹¬ì´ ìˆìœ¼ì‹ ë¶„ë“¤ì€ <a href="https://www.netmanias.com/ko/?m=view&id=blog&no=5526">ì—¬ê¸°</a>ë¥¼ ì°¸ì¡°í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p><br><!-- toc --><p>ì„œë²„1ê³¼ ì„œë²„3ì€ í˜„ì¬ ë™ì¼í•œ VLAN(VLAN ID: 10)ë‚´ì— ìˆìœ¼ë©°, ì„œë²„1ì˜ ARP í…Œì´ë¸”ì—ëŠ” ì„œë²„3ì˜ ì—”íŠ¸ë¦¬ê°€ ì´ë¯¸ ì¡´ì¬í•œë‹¤ê³  ê°€ì •(ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” ARP Request/Reply ë©”ì‹œì§€ë¥¼ í†µí•´ ARP í…Œì´ë¸”ì„ ì±„ì›Œì£¼ì–´ì•¼í•¨)í•˜ê² ìŠµë‹ˆë‹¤.<br><br></p><h3 id="ì„œë²„1ì—ì„œ-ì„œë²„3ìœ¼ë¡œ-íŒ¨í‚·-ì „ë‹¬-Flooding"><a href="#ì„œë²„1ì—ì„œ-ì„œë²„3ìœ¼ë¡œ-íŒ¨í‚·-ì „ë‹¬-Flooding" class="headerlink" title="ì„œë²„1ì—ì„œ ì„œë²„3ìœ¼ë¡œ íŒ¨í‚· ì „ë‹¬(Flooding)"></a>ì„œë²„1ì—ì„œ ì„œë²„3ìœ¼ë¡œ íŒ¨í‚· ì „ë‹¬(Flooding)</h3><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/ehternet-switching-flooding.png" alt="Flooding"><span class="caption">Flooding</span></div><ol><li>ì„œë²„1ì—ì„œ ì„œë²„3ìœ¼ë¡œ Ping íŒ¨í‚·ì„ ë³´ë‚´ë ¤ê³ í•©ë‹ˆë‹¤.</li><li>ì„œë²„1ì˜ <strong>ë¼ìš°íŒ… í…Œì´ë¸”</strong>ì„ ì°¸ì¡°(Destination ì£¼ì†Œ ë³„ ê²Œì´íŠ¸ì›¨ì´ IPì™€ ì¶œë ¥ í¬íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ)í•˜ì—¬ ì„œë²„3ì´ ì„œë²„1ê³¼ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ë¼ëŠ” ê²ƒê³¼ íŒ¨í‚·ì„ ë‚´ë³´ë‚¼ ì¶œë ¥ í¬íŠ¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</li><li>ì„œë²„1ì˜ <strong>ARP í…Œì´ë¸”</strong>ì„ ì°¸ì¡°í•˜ì—¬ ì„œë²„3ì˜ IPì£¼ì†Œì— ëŒ€í•œ MAC ì£¼ì†Œë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</li><li>ì¶œë ¥ í¬íŠ¸ì™€ MAC ì£¼ì†Œë¥¼ í™•ì¸í–ˆìœ¼ë‹ˆ ì„œë²„1ì€ ì„œë²„3ìœ¼ë¡œ Ping íŒ¨í‚·ì„ ì†¡ì‹ í•©ë‹ˆë‹¤.</li><li>Ping íŒ¨í‚·ì€ ì¶œë ¥ í¬íŠ¸ë¥¼ í†µí•´ L3 ìŠ¤ìœ„ì¹˜ë¡œ ì´ë™í•©ë‹ˆë‹¤.</li><li>Ping íŒ¨í‚·ì„ ìˆ˜ì‹ í•œ L3 ìŠ¤ìœ„ì¹˜ëŠ” í•´ë‹¹ íŒ¨í‚·ì„ ë²„í¼(Ingress Packet Buffer)ì— ì ì‹œ ì €ì¥í•´ë‘¡ë‹ˆë‹¤.</li><li>ì´ì œ L3 ìŠ¤ìœ„ì¹˜ì—ì„œ ìˆ˜ì‹ í•œ Ping íŒ¨í‚·ì˜ <strong>Source MAC ì£¼ì†Œë¥¼ í•™ìŠµ</strong>í•  ì°¨ë¡€ì…ë‹ˆë‹¤. ë™ì¼ VLANì„ ì†Œìœ í•œ Line Cardë“¤ì—ë§Œ Source MAC ì£¼ì†Œ ì •ë³´ë¥¼ ê³µìœ í•˜ì—¬ ê°ê°ì˜ <strong>MAC í…Œì´ë¸”</strong>ì— ê·¸ ê°’(VLAN, Source MAC ì£¼ì†Œ, í¬íŠ¸)ì„ ì €ì¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.</li><li>ë‹¤ìŒìœ¼ë¡œ í•´ë‹¹ íŒ¨í‚·ì„ <strong>IP ë¼ìš°íŒ…</strong>ì‹œí‚¬ì§€ <strong>Ethernet ìŠ¤ìœ„ì¹­</strong>ì‹œí‚¬ê²ƒì¸ì§€ë¥¼ ê²°ì •í•˜ëŠ”ë° ì´ë¥¼ ìœ„í•´ Destination MAC ì£¼ì†Œë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.<div class="alert info"><p>Destination MAC ì£¼ì†Œê°€ L3 ìŠ¤ìœ„ì¹˜ì˜ MAC ì£¼ì†Œì¸ ê²½ìš°ì—ëŠ”, <strong>IP ë¼ìš°íŒ…</strong><br>Destination MAC ì£¼ì†Œê°€ L3 ìŠ¤ìœ„ì¹˜ì˜ MAC ì£¼ì†Œê°€ ì•„ë‹Œ ê²½ìš°ì—ëŠ”, <strong>Ethernet ìŠ¤ìœ„ì¹­</strong></p></div><br></li><li>ì´ ê²½ìš°ì—ëŠ” í•´ë‹¹ íŒ¨í‚·ì˜ Destination MAC ì£¼ì†Œê°€ ì„œë²„3ì˜ MAC ì£¼ì†Œì´ë¯€ë¡œ Ethernet ìŠ¤ìœ„ì¹­ì„ ì‹œí‚µë‹ˆë‹¤.</li><li>Ethernet ìŠ¤ìœ„ì¹­ì„ ìœ„í•´ L3 ìŠ¤ìœ„ì¹˜ì—ì„œëŠ” í•´ë‹¹ íŒ¨í‚·ì˜ Destination MAC ì£¼ì†Œê°€ MAC í…Œì´ë¸”ì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</li><li>ë§Œì•½ ë“±ë¡ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ë™ì¼ VLANì— ì†í•œ í¬íŠ¸ë“¤ ì¤‘ì—ì„œ ìˆ˜ì‹  í¬íŠ¸(ì„œë²„1ì˜ í¬íŠ¸)ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ëª¨ë“  í¬íŠ¸(ì—¬ê¸°ì„œëŠ” ì„œë²„2ì™€ ì„œë²„3ì˜ í¬íŠ¸ë¼ê³  ê°€ì •)ë¡œ ìˆ˜ì‹ í•œ Ping íŒ¨í‚·ì„ <strong>Flooding</strong>í•´ì•¼í•¨ì„ ì•Œê²Œë©ë‹ˆë‹¤.</li><li>L3 ìŠ¤ìœ„ì¹˜ëŠ” ì•ì„œ ë²„í¼ì— ì ì‹œ ì €ì¥í•´ë‘” íŒ¨í‚·(6ë²ˆ ê³¼ì •ì„ ì°¸ê³ )ì„ ì¶œë ¥ì„ ìœ„í•œ ë²„í¼(Egress Packet Buffer)ë¡œ ì˜®ê¸´ í›„ 11ë²ˆì—ì„œ í™•ì¸ëœ í¬íŠ¸ë“¤ë¡œ í•´ë‹¹ íŒ¨í‚·ì„ Floodingí•©ë‹ˆë‹¤.</li><li>ì´ì œ ì„œë²„2ì™€ ì„œë²„3ì´ ì„œë²„1ì´ ë³´ë‚¸ Ping íŒ¨í‚·ì„ ìˆ˜ì‹ í•˜ê²Œ ë©ë‹ˆë‹¤.</li></ol><hr><h3 id="ì„œë²„3ì—ì„œ-ì„œë²„1ë¡œ-íŒ¨í‚·-ì „ë‹¬-Unicasting"><a href="#ì„œë²„3ì—ì„œ-ì„œë²„1ë¡œ-íŒ¨í‚·-ì „ë‹¬-Unicasting" class="headerlink" title="ì„œë²„3ì—ì„œ ì„œë²„1ë¡œ íŒ¨í‚· ì „ë‹¬(Unicasting)"></a>ì„œë²„3ì—ì„œ ì„œë²„1ë¡œ íŒ¨í‚· ì „ë‹¬(Unicasting)</h3><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/ehternet-switching-unicasting.png" alt="Unicasting"><span class="caption">Unicasting</span></div><ol><li>Ping íŒ¨í‚·ì˜ Destination MAC ì£¼ì†ŒëŠ” ì„œë²„3ì˜ MAC ì£¼ì†Œì´ê¸°ë•Œë¬¸ì— ì„œë²„2ì—ì„œëŠ” ìˆ˜ì‹ í•œ Ping íŒ¨í‚·ì„ ë²„ë¦½ë‹ˆë‹¤.</li><li>ì„œë²„3ì€ ìˆ˜ì‹ í•œ Ping íŒ¨í‚·ì— ëŒ€í•œ ì‘ë‹µ íŒ¨í‚·ì„ ì„œë²„1ë¡œ ì†¡ì‹ í•©ë‹ˆë‹¤.(ì„œë²„1ì—ì„œì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì„œë²„3ì€ ìì‹ ì˜ ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ ARP í…Œì´ë¸”ì„ ì°¸ì¡°í•˜ì—¬ ì¶œë ¥ í¬íŠ¸ì™€ ì„œë²„1ì˜ MACì£¼ì†Œë¥¼ í™•ì¸í•¨)</li><li>ì‘ë‹µ íŒ¨í‚·ì€ ì¶œë ¥ í¬íŠ¸ë¥¼ í†µí•´ L3 ìŠ¤ìœ„ì¹˜ë¡œ ì´ë™í•©ë‹ˆë‹¤.</li><li>ì‘ë‹µ íŒ¨í‚·ì„ ìˆ˜ì‹ í•œ L3 ìŠ¤ìœ„ì¹˜ëŠ” í•´ë‹¹ íŒ¨í‚·ì„ ë²„í¼(Ingress Packet Buffer)ì— ì ì‹œ ì €ì¥í•´ë‘¡ë‹ˆë‹¤.</li><li>ì´ì œ L3 ìŠ¤ìœ„ì¹˜ì—ì„œ ìˆ˜ì‹ í•œ ì‘ë‹µ íŒ¨í‚·ì˜ <strong>Source MAC ì£¼ì†Œë¥¼ í•™ìŠµ</strong>í•  ì°¨ë¡€ì…ë‹ˆë‹¤. ë™ì¼ VLANì„ ì†Œìœ í•œ Line Cardë“¤ì—ë§Œ Source MAC ì£¼ì†Œ ì •ë³´ë¥¼ ê³µìœ í•˜ì—¬ ê°ê°ì˜ <strong>MAC í…Œì´ë¸”</strong>ì— ê·¸ ê°’(VLAN, Source MAC ì£¼ì†Œ, í¬íŠ¸)ì„ ì €ì¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.</li><li>ë‹¤ìŒìœ¼ë¡œ í•´ë‹¹ íŒ¨í‚·ì„ <strong>IP ë¼ìš°íŒ…</strong>ì‹œí‚¬ì§€ <strong>Ethernet ìŠ¤ìœ„ì¹­</strong>ì‹œí‚¬ê²ƒì¸ì§€ë¥¼ ê²°ì •í•˜ëŠ”ë° ì´ë¥¼ ìœ„í•´ Destination MAC ì£¼ì†Œë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.</li><li>ì´ ê²½ìš°ì—ëŠ” í•´ë‹¹ íŒ¨í‚·ì˜ Destination MAC ì£¼ì†Œê°€ ì„œë²„1ì˜ MAC ì£¼ì†Œì´ë¯€ë¡œ Ethernet ìŠ¤ìœ„ì¹­ì„ ì‹œí‚µë‹ˆë‹¤.</li><li>Ethernet ìŠ¤ìœ„ì¹­ì„ ìœ„í•´ L3 ìŠ¤ìœ„ì¹˜ì—ì„œëŠ” í•´ë‹¹ íŒ¨í‚·ì˜ Destination MAC ì£¼ì†Œê°€ MAC í…Œì´ë¸”ì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì´ë²ˆì—ëŠ” ì¡´ì¬(ì´ì „ì˜ Source MAC ì£¼ì†Œ í•™ìŠµì„ í†µí•´ ì„œë²„1ì˜ MAC ì£¼ì†Œê°€ ì €ì¥ëœ ìƒíƒœì´ë¯€ë¡œ)í•©ë‹ˆë‹¤.</li><li>L3 ìŠ¤ìœ„ì¹˜ëŠ” ì•ì„œ ë²„í¼ì— ì ì‹œ ì €ì¥í•´ë‘” íŒ¨í‚·(4ë²ˆ ê³¼ì •ì„ ì°¸ê³ )ì„ ì¶œë ¥ì„ ìœ„í•œ ë²„í¼(Egress Packet Buffer)ë¡œ ì˜®ê¸´ í›„ 8ë²ˆì—ì„œ í™•ì¸ëœ MACì£¼ì†Œë¡œ í•´ë‹¹ íŒ¨í‚·ì„ ì†¡ì‹ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ MAC í…Œì´ë¸”ì— ë§¤ì¹­ë˜ì–´ í•˜ë‚˜ì˜ í¬íŠ¸ë¡œ íŒ¨í‚·ì´ ë‚˜ê°€ëŠ” ê²½ìš°ë¥¼ Unicastingì´ë¼ê³  í•©ë‹ˆë‹¤.</li></ol><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>Reference</strong></p><ul><li><a href="https://www.netmanias.com/ko/?m=view&amp;id=blog&amp;no=5526">https://www.netmanias.com/ko/?m=view&amp;id=blog&amp;no=5526</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC/">ë„¤íŠ¸ì›Œí¬</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/ethernet-switching/">ethernet switching</category>
      
      <category domain="https://chelseafandev.github.io/tags/%EC%9D%B4%EB%8D%94%EB%84%B7-%EC%8A%A4%EC%9C%84%EC%B9%98/">ì´ë”ë„· ìŠ¤ìœ„ì¹˜</category>
      
      <category domain="https://chelseafandev.github.io/tags/Source-MAC-Learning/">Source MAC Learning</category>
      
      <category domain="https://chelseafandev.github.io/tags/ARP-Table/">ARP Table</category>
      
      <category domain="https://chelseafandev.github.io/tags/L3-%EC%8A%A4%EC%9C%84%EC%B9%98/">L3 ìŠ¤ìœ„ì¹˜</category>
      
      
      <comments>https://chelseafandev.github.io/2021/12/06/ethernet-switching-flow/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Seg FaultëŠ” ì™œ ë°œìƒí•˜ëŠ”ê°€?</title>
      <link>https://chelseafandev.github.io/2021/11/09/gdb-chapter4-program-crash/</link>
      <guid>https://chelseafandev.github.io/2021/11/09/gdb-chapter4-program-crash/</guid>
      <pubDate>Tue, 09 Nov 2021 07:59:54 GMT</pubDate>
      
      <description>&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” &lt;a href=&quot;https://nostarch.com/debugging.htm&quot;&gt;The Art of Debugging with GDB, DDD and Eclipse&lt;/a&gt;ì˜ &lt;strong&gt;Chatper 4 WHEN A PROGRAM CRASHES&lt;/strong&gt; ë‚´ìš©ì„ ë²ˆì—­í•´ë³´ì•˜ìŠµë‹ˆë‹¤. í•´ë‹¹ ì±•í„°ì˜ ì•ë¶€ë¶„ì—ì„œëŠ” ê°€ìƒ ì£¼ì†Œ ê³µê°„ì—ì„œì˜ í˜ì´ì§€(page)ì— ëŒ€í•œ ê°œë…ì„ ì†Œê°œí•˜ê³  seg faultê°€ ë°œìƒí•˜ëŠ” ì›ì¸ì„ í˜ì´ì§€(page)ì™€ ì—°ê´€ì§€ì–´ ì˜ ì„¤ëª…í•´ì£¼ê³  ìˆìŠµë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” <a href="https://nostarch.com/debugging.htm">The Art of Debugging with GDB, DDD and Eclipse</a>ì˜ <strong>Chatper 4 WHEN A PROGRAM CRASHES</strong> ë‚´ìš©ì„ ë²ˆì—­í•´ë³´ì•˜ìŠµë‹ˆë‹¤. í•´ë‹¹ ì±•í„°ì˜ ì•ë¶€ë¶„ì—ì„œëŠ” ê°€ìƒ ì£¼ì†Œ ê³µê°„ì—ì„œì˜ í˜ì´ì§€(page)ì— ëŒ€í•œ ê°œë…ì„ ì†Œê°œí•˜ê³  seg faultê°€ ë°œìƒí•˜ëŠ” ì›ì¸ì„ í˜ì´ì§€(page)ì™€ ì—°ê´€ì§€ì–´ ì˜ ì„¤ëª…í•´ì£¼ê³  ìˆìŠµë‹ˆë‹¤.</p><span id="more"></span><br><!-- toc --><br><h2 id="Background-Material-Memory-Management"><a href="#Background-Material-Memory-Management" class="headerlink" title="Background Material: Memory Management"></a>Background Material: Memory Management</h2><h3 id="Why-does-a-program-crash"><a href="#Why-does-a-program-crash" class="headerlink" title="Why does a program crash?"></a>Why does a program crash?</h3><p>ë‹¨ì—°ì½” ì¶©ëŒì´ ë°œìƒí•˜ëŠ” ê°€ì¥ ì¼ë°˜ì ì¸ ì›ì¸ì€ í”„ë¡œê·¸ë¨ì´ ì ‘ê·¼ ê¶Œí•œì´ ì—†ëŠ” ë©”ëª¨ë¦¬ ê³µê°„ì— ì ‘ê·¼í•˜ë ¤ê³  ì‹œë„í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p><blockquote><p>By far the most common cause of a crash is for a program to attempt to access a memory location without having the permission to do so.</p></blockquote><br><p>Unix ê³„ì—´ì˜ í”Œë«í¼ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ í”„ë¡œê·¸ë¨ì´ segmentation fault(seg faultë¡œ ì•Œë ¤ì ¸ìˆëŠ”)ë¥¼ ë°œìƒì‹œì¼°ë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì£¼ê³  í•´ë‹¹ í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ì„ ì¤‘ë‹¨í•  ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>On Unix-family platforms, the OS will normally announce that the program has caused a segmentation fault, commonly referred to as a seg fault, and discontinue execution of the program.</p></blockquote><br><p>seg faultë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ìš©ë„ë¡œ GDBë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ”, ë©”ëª¨ë¦¬ ì ‘ê·¼ ì—ëŸ¬ê°€ ì–´ë–»ê²Œ ë°œìƒí•˜ëŠ”ì§€ì— ëŒ€í•´ ì •í™•íˆ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</p><blockquote><p>In order to effectively use GDB to deal with seg faults, it is important to understand exactly how memory access errors occur.</p></blockquote><br><h3 id="Program-layout-in-memory"><a href="#Program-layout-in-memory" class="headerlink" title="Program layout in memory"></a>Program layout in memory</h3><p>Unix í”Œë«í¼ì—ì„œ í”„ë¡œê·¸ë¨ì— í• ë‹¹ëœ ê°€ìƒ ì£¼ì†Œë“¤ì˜ ì§‘í•©ì€ Figure 4-1 ê·¸ë¦¼ê³¼ ê°™ì€ í˜•íƒœë¡œ ë°°ì¹˜ë˜ì–´ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>On Unix platforms, a programâ€™s set of allocated virtual addresses typically is laid out something like the diagram in Figure 4-1.</p></blockquote><div class="figure " style="width:;"><img class="fig-img" src="/assets/images/figure-4-1-program-memory-layout.png" alt=""></div><br><p><strong>text section</strong>ì€ ì»´íŒŒì¼ëŸ¬ê°€ ë‹¹ì‹ ì˜ í”„ë¡œê·¸ë¨ ì†ŒìŠ¤ ì½”ë“œë¥¼ í†µí•´ ìƒì„±í•´ë‚¸ ê¸°ê³„ ì§€ì‹œì–´ë“¤ë¡œ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>The <strong>text section</strong> consists of the machine instructions produced by the compiler from your programâ€™s source code.</p></blockquote><br><p><strong>data section</strong>ì€ ì»´íŒŒì¼ íƒ€ì„ì— í• ë‹¹ë˜ëŠ” ëª¨ë“  í”„ë¡œê·¸ë¨ ë³€ìˆ˜ë“¤ì„ í¬í•¨í•©ë‹ˆë‹¤. (ì´ˆê¸°í™”ëœ ë³€ìˆ˜ëŠ” dataì˜ì—­ì— ì´ˆê¸°í™”ë˜ì§€ì•Šì€ ë³€ìˆ˜ëŠ” bssì˜ì—­ì— ì €ì¥ë¨)</p><blockquote><p>The <strong>data section</strong> contains all the program variables that are allocated at compile time. </p></blockquote><br><p>ë‹¹ì‹ ì˜ í”„ë¡œê·¸ë¨ì´ ëŸ°íƒ€ì„ì— OSë¡œë¶€í„° ì¶”ê°€ì ì¸ ë©”ëª¨ë¦¬ë¥¼ ìš”ì²­í•˜ëŠ” ê²½ìš°ì— í•´ë‹¹ ë©”ëª¨ë¦¬ëŠ” <strong>heap</strong>ì´ë¼ëŠ” ê³µê°„ì— í• ë‹¹ë©ë‹ˆë‹¤.</p><blockquote><p>When your program requests additional memory from the operating system at run time the requested memory is allocated in an area called the <strong>heap</strong>.</p></blockquote><br><p><strong>stack section</strong>ì€ ë™ì ìœ¼ë¡œ í• ë‹¹ëœ ë°ì´í„°ë¥¼ ìœ„í•œ ê³µê°„ì…ë‹ˆë‹¤. í•¨ìˆ˜ í˜¸ì¶œ ì‹œ ì‚¬ìš©ë˜ëŠ” ì¸ìë“¤ì´ë‚˜ ì§€ì—­ ë³€ìˆ˜ë“¤ ê·¸ë¦¬ê³  ë°˜í™˜ ì£¼ì†Œê°’ë“¤ì´ stack ê³µê°„ì— ì €ì¥ë©ë‹ˆë‹¤. stackì˜ í¬ê¸°ëŠ” í•¨ìˆ˜ í˜¸ì¶œì´ ë°œìƒí•  ë•Œ ì¦ê°€í•˜ê³  í˜¸ì¶œìì—ê²Œ í•¨ìˆ˜ê°€ ë‹¤ì‹œ ë°˜í™˜ë ë•Œ ê°ì†Œí•©ë‹ˆë‹¤.</p><blockquote><p>The <strong>stack section</strong> is space for dynamically allocated data. The data for function calls â€” including arguments, local variables, and return addresses â€” are stored on the stack. The stack grows each time a function call is made and shrinks each time a function returns to its caller.</p></blockquote><br><h3 id="The-notion-of-pages"><a href="#The-notion-of-pages" class="headerlink" title="The notion of pages"></a>The notion of pages</h3><p>ê°€ìƒ ì£¼ì†Œ ê³µê°„ì€ <strong>í˜ì´ì§€</strong>ë¼ê³  ë¶ˆë¦¬ëŠ” ë©ì–´ë¦¬(chunk)ë“¤ì˜ êµ¬ì„±ìœ¼ë¡œ í‘œí˜„ë©ë‹ˆë‹¤. RAMì´ë‚˜ ROMê³¼ ê°™ì€ ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ ë˜í•œ í˜ì´ì§€ë“¤ë¡œ ë‚˜ëˆ„ì–´ì§„ ë¬´ì–¸ê°€ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.</p><blockquote><p>A virtual address space is viewed as organized into chunks called <strong>pages</strong>. Physical memory (both RAM and ROM) is also viewed as divided into pages.</p></blockquote><br><p>ì‹¤í–‰ì— ì˜í•´ í”„ë¡œê·¸ë¨ì´ ë©”ëª¨ë¦¬ì— ë¡œë“œë  ë•Œ, OSëŠ” í”„ë¡œê·¸ë¨ì˜ ëª‡ëª‡ í˜ì´ì§€ë“¤ì„ ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ì˜ í˜ì´ì§€ì— ì €ì¥ë˜ë„ë¡ ë°°ì—´ì‹œí‚µë‹ˆë‹¤. ì´ëŸ¬í•œ í˜ì´ì§€ë“¤ì„ <strong>resident</strong>ë¼ê³  ë¶€ë¥´ë©° residentë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í˜ì´ì§€ë“¤ì€ ë””ìŠ¤í¬ì— ì €ì¥ë©ë‹ˆë‹¤.</p><blockquote><p>When a program is loaded into memory for execution, the OS arranges for some of the pages of the program to be stored in pages of physical memory. These pages are said to be <strong>resident</strong>, and the rest are stored on disk.</p></blockquote><br><p>ì§€ê¸ˆ í˜„ì¬ëŠ” resident(ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ì˜ í˜ì´ì§€ì— ì €ì¥ëœ í”„ë¡œê·¸ë¨ì˜ í˜ì´ì§€)ê°€ ì•„ë‹Œ ëª‡ëª‡ í”„ë¡œê·¸ë¨ í˜ì´ì§€ë“¤ì´ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ ì¤‘ì¸ ë™ì•ˆì˜ ë‹¤ì–‘í•œ ì‹œì ì— í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì‹œì ì— ê·¸ê²ƒì€ í•˜ë“œì›¨ì–´ì— ì˜í•´ ê°ì§€ë˜ê³  ì´ë¥¼ í†µí•´ ë‹¹ì‹ ì˜ í”„ë¡œê·¸ë¨ì€ ì œì–´ê¶Œì„ OSë¡œ ë„˜ê²¨ì£¼ê²Œ ë©ë‹ˆë‹¤. OSëŠ” í•„ìš”í•œ í”„ë¡œê·¸ë¨ì˜ í˜ì´ì§€ë¥¼ ë©”ëª¨ë¦¬ë¡œ ë¡œë”©í•˜ê³ ë‚˜ì„œ ì œì–´ê¶Œ ë‹¤ì‹œ í”„ë¡œê·¸ë¨ì—ê²Œ ë„˜ê²¨ì¤ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ë”ì´ìƒ residentê°€ ì•„ë‹Œ í”„ë¡œê·¸ë¨ í˜ì´ì§€(= nonresident)ëŠ” ë””ìŠ¤í¬ì— ì €ì¥ë  ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>At various times during execution, some program page that is not currently resident will be needed. When this occurs, it will be sensed by the hardware, which transfers control to the OS. The latter brings the required page into memory and then returns control to our program. The evicted program page, if any, becomes nonresident and will be stored on disk.</p></blockquote><br><p>ìœ„ì˜ ëª¨ë“  ê³¼ì •ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œ OSëŠ” ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ë§ˆë‹¤ <strong>í˜ì´ì§€ í…Œì´ë¸”</strong>ì´ë¼ëŠ” ê²ƒì„ ìœ ì§€í•˜ê²Œ ë©ë‹ˆë‹¤. í”„ë¡œì„¸ìŠ¤ì˜ ê°€ìƒ í˜ì´ì§€ë“¤ ê°ê°ì€ í…Œì´ë¸” ë‚´ì— entryë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©° ì´ entryì—ëŠ” ì•„ë˜ ì •ë³´ë“¤ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>To manage all of this, the OS maintains a <strong>page table</strong> for each process. Each of the processâ€™s virtual pages has an entry in the table, which includes the following information:</p></blockquote><br><ul><li>í˜ì´ì§€ì˜ ë©”ëª¨ë¦¬ í˜¹ì€ ë””ìŠ¤í¬ ìƒì˜ í˜„ì¬ ë¬¼ë¦¬ì  ìœ„ì¹˜ ì •ë³´</li><li>í˜ì´ì§€ì˜ read, write, execute ê¶Œí•œ ì •ë³´</li></ul><blockquote><ul><li>The current physical location of this page in memory or on disk.</li><li>Permissions â€” read, write, execute â€” for this page.</li></ul></blockquote><br><p>OSê°€ ë¶€ë¶„ì ì¸ í˜ì´ì§€ë“¤ì„ í”„ë¡œê·¸ë¨ì— í• ë‹¹í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ëŠ” ê²ƒì— ì£¼ëª©í•©ì‹œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œê·¸ë¨ì´ ì•½ 10,000 bytesì˜ ì‚¬ì´ì¦ˆë¥¼ ê°–ëŠ”ë‹¤ê³  í•œë‹¤ë©´, ì´ í”„ë¡œê·¸ë¨ì´ ì˜¨ì „íˆ ë¡œë“œëì„ ê²½ìš° ë©”ëª¨ë¦¬ì˜ 3ê°œ í˜ì´ì§€ë¥¼ ì°¨ì§€(í˜ì´ì§€ ê¸°ë³¸ ì‚¬ì´ì¦ˆê°€ 4,096 bytesì¸ ê²½ìš°)í•  ê²ƒì…ë‹ˆë‹¤. í˜ì´ì§€ëŠ” VM ì‹œìŠ¤í…œì— ì˜í•´ ì¡°ì‘ë˜ëŠ” ë©”ëª¨ë¦¬ì˜ ê°€ì¥ ì‘ì€ ë‹¨ìœ„ì´ê¸° ë•Œë¬¸ì— ì•½ 2.5 í˜ì´ì§€ë¥¼ ì°¨ì§€í•œë‹¤ê±°ë‚˜ í•˜ì§€ëŠ” ì•Šì„ê²ƒì…ë‹ˆë‹¤. ë°”ë¡œ ì´ ì§€ì ì´ ë””ë²„ê¹… ì‹œì— ë§¤ìš° ì¤‘ìš”í•œ í¬ì¸íŠ¸ì…ë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì´ê²ƒì€ í”„ë¡œê·¸ë¨ì— ì˜í•´ ë°œìƒí•˜ëŠ” ëª‡ëª‡ ì˜ëª»ëœ ë©”ëª¨ë¦¬ ì ‘ê·¼ë“¤ì´ seg faultë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•Šì„ ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. </p><blockquote><p>Note that the OS will not allocate partial pages to a program. For example, if the program to be run has a total size of about 10,000 bytes, it would occupy three pages of memory if fully loaded. It would not merely occupy about 2.5 pages, as pages are the smallest unit of memory manipulated by the VM system. This is an important point to understand when debugging, because it implies that some erroneous memory accesses by the program will not trigger seg faults, as you will see below.</p></blockquote><br><p>ë‹¤ì‹œ ë§í•´, ë””ë²„ê¹… ì„¸ì…˜ì— ìˆëŠ” ë™ì•ˆì— ë‹¹ì‹ ì€ â€œì†ŒìŠ¤ ì½”ë“œì˜ ì´ ë¼ì¸ì€ seg faultë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— í‹€ë¦¼ì—†ì´ ê´œì°®ì„ ê²ƒì´ë‹¤â€ì™€ ê°™ì´ ì´ì•¼ê¸° í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>In other words, during your debugging session, you cannot say something like, â€œThis line of source code must be okay, since it didnâ€™t cause a seg fault.â€</p></blockquote><br><h3 id="Details-on-the-role-of-the-page-table"><a href="#Details-on-the-role-of-the-page-table" class="headerlink" title="Details on the role of the page table"></a>Details on the role of the page table</h3><div class="alert info"><p>ì•„ë˜ ì„¤ëª…ì— ë‚˜ì˜¤ëŠ” í˜ì´ì§€ì˜ í¬ê¸°ëŠ” 4,096 bytes ë¼ê³  ê°€ì •í•˜ì</p><p>virtual page 0 : 0 ~ 4,095 bytes<br>virtual page 1 : 4,096 ~ 8,191 bytes<br>â€¦</p><p>Keep the virtual address space in Table 4-1 in mind, and continue to assume that the page size is 4,096 bytes. Then virtual page 0 comprises bytes 0 though 4,095 of the virtual address space, page 1 comprises bytes 4,096 through 8,191, and so on.</p></div><br><p>ìœ„ì—ì„œ ì–¸ê¸‰í–ˆë“¯ì´, ìš°ë¦¬ê°€ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰ì‹œí‚¬ë•Œ, OSëŠ” í”„ë¡œê·¸ë¨ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ê°€ìƒ ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” í˜ì´ì§€ í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤. í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì´ë¼ë©´ ì–¸ì œë“ ì§€, í•˜ë“œì›¨ì–´ì˜ page table registerëŠ” í˜ì´ì§€ í…Œì´ë¸”ì„ ê°€ë¦¬í‚¤ê³  ìˆì„ê²ë‹ˆë‹¤.</p><blockquote><p>As mentioned, when we run a program, the OS creates a page table that it uses to manage the virtual memory of the process that executes the program code. Whenever that process runs, the hardwareâ€™s page table register will point to that table.</p></blockquote><br><p>ê°œë…ì ìœ¼ë¡œ ì´ì•¼ê¸°í•˜ìë©´, í”„ë¡œì„¸ìŠ¤ ê°€ìƒ ì£¼ì†Œ ê³µê°„ì˜ ê°ê°ì˜ í˜ì´ì§€ëŠ” í˜ì´ì§€ í…Œì´ë¸” ì•ˆì˜ entryë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤. ì´ í˜ì´ì§€ í…Œì´ë¸” entryëŠ” í˜ì´ì§€ì™€ ê´€ë ¨ëœ ë‹¤ì–‘í•œ ì •ë³´ë“¤ì„ ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì •ë³´ë“¤ ì¤‘ì—ì„œ seg faultsì™€ ê´€ë ¨ëœ ë°ì´í„°ëŠ” í˜ì´ì§€ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì…ë‹ˆë‹¤. ì´ëŠ” read, write, executeì™€ ê°™ì€ íŒŒì¼ ì ‘ê·¼ ê¶Œí•œê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ í˜ì´ì§€ 3ë²ˆì— ëŒ€í•œ í˜ì´ì§€ í…Œì´ë¸” entryëŠ” ì—¬ëŸ¬ë¶„ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ê·¸ í˜ì´ì§€ë¡œë¶€í„° ë°ì´í„°ë¥¼ ì½ì„ ê¶Œí•œì´ ìˆëŠ”ì§€, ê·¸ í˜ì´ì§€ì— ë°ì´í„°ë¥¼ ì“¸ ê¶Œí•œì´ ìˆëŠ”ì§€, ê·¸ í˜ì´ì§€ì— ì§€ì‹œì–´ë¥¼ ì‹¤í–‰í•  ê¶Œí•œì´ ìˆëŠ”ì§€ ê°€ë¦¬í‚¬ ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>Conceptually speaking, each page of the virtual address space of the process has an entry in the page table. This page table entry stores various pieces of information related to the page. The data of interest in relation to seg faults are the access permissions for the page, which are similar to file access permissions: read, write, and execute. For example, the page table entry for page 3 will indicate whether your process has the right to read data from that page, the right to write data to it, and the right to execute instructions on it.</p></blockquote><br><p>í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ ê³¼ì •ì—ì„œ, í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ì— ì˜í•´ ìƒì„±ë˜ëŠ” ì£¼ì†Œë“¤ì€ ê°€ìƒì˜ ê°’ì¼ ê²ƒì…ë‹ˆë‹¤. í”„ë¡œê·¸ë¨ì´ yë¼ê³ í•˜ëŠ” íŠ¹ì •í•œ ê°€ìƒ ì£¼ì†Œë¥¼ ê°–ëŠ” ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•˜ë ¤ê³  í• ë•Œ, í•˜ë“œì›¨ì–´ëŠ” ì´ ê°€ìƒ ì£¼ì†Œ yë¥¼ ê°€ìƒ í˜ì´ì§€ ë²ˆí˜¸ vë¡œ ë³€í™˜í•  ê²ƒì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ ê°€ìƒ í˜ì´ì§€ ë²ˆí˜¸ì¸ vëŠ” ê°€ìƒ ì£¼ì†Œ yë¥¼ 4,096ìœ¼ë¡œ ë‚˜ëˆˆ ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³ ë‚˜ì„œ í•˜ë“œì›¨ì–´ëŠ” í˜ì´ì§€ í…Œì´ë¸”ë‚´ì—ì„œ entryê°’ì¸ vê°€ ìˆ˜í–‰í•˜ê³ ì í•˜ëŠ” ì—°ì‚°ê³¼ ì¼ì¹˜í•˜ëŠ” ê¶Œí•œì„ ê°€ì§€ê³ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•  ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ ì¼ì¹˜í•œë‹¤ë©´, í•˜ë“œì›¨ì–´ëŠ” ì´ í…Œì´ë¸” entryë¡œë¶€í„° ì‹¤ì œ ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ ê³µê°„ì˜ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ì–»ì–´ë‚¼ ê²ƒì´ë©° ìš”ì²­ëœ ë©”ëª¨ë¦¬ ì—°ì‚°ì„ ìˆ˜í–‰í•  ê²ƒì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ë§Œì•½ í…Œì´ë¸” entryê°€ ìš”ì²­í•œ ì—°ì‚°ì— ëŒ€í•œ ì ì ˆí•œ ê¶Œí•œì´ ì—†ì„ë•Œì—ëŠ” ë‚´ë¶€ì ì¸ ì¸í„°ëŸ½íŠ¸ë¥¼ ì‹¤í–‰í•  ê²ƒì…ë‹ˆë‹¤. ì´ ì¸í„°ëŸ½íŠ¸ëŠ” OSì˜ ì—ëŸ¬ í•¸ë“¤ë§ ë£¨í‹´ìœ¼ë¡œ jumpí•˜ë„ë¡ í•´ì¤ë‹ˆë‹¤. OSëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ ì ‘ê·¼ ìœ„ë°˜ì„ ì•Œë ¤ì£¼ê³  í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ì„ ì¤‘ë‹¨ì‹œí‚µë‹ˆë‹¤.</p><blockquote><p>During the execution of the program, the addresses it generates will be virtual. When the program attempts to access memory at a certain virtual address, say y, the hardware will convert that to a virtual page number v, which equals y divided by 4,096. The hardware will then check entry v in the page table to see whether the permissions for the page match the operation to be performed. If they do match, the hardware will get the desired locationâ€™s actual physical page number from this table entry and then carry out the requested memory operation. But if the table entry shows that the requested operation does not have the proper permission, the hardware will execute an internal interrupt. This will cause a jump to the OSâ€™s error-handling routine. The OS will normally then announce a memory access violation and discontinue execution of the program.</p></blockquote><br><h3 id="A-slight-memory-access-bug-might-not-cause-a-seg-fault"><a href="#A-slight-memory-access-bug-might-not-cause-a-seg-fault" class="headerlink" title="A slight memory-access bug might not cause a seg fault"></a>A slight memory-access bug might not cause a seg fault</h3><figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> q[<span class="number">200</span>];</span><br><span class="line">main()</span><br><span class="line">{</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">2000</span>; i++) {</span><br><span class="line">    q[i] = i;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><br><p>ê±°ì˜ ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì‹¤í–‰ ì‹œê°„ì— seg faultê°€ ë°œìƒí•  ê²ƒì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ì‹œì ì´ ë‹¹ì‹ ì„ ë†€ë¼ê²Œ í•  ê²ƒì…ë‹ˆë‹¤. ì—ëŸ¬ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ì‹œì ì— ë°œìƒí•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ìˆëŠ”ë°, ë‹¤ì‹œ ë§í•´, iê°€ 200ì¸ ê²½ìš°ê°€ ì•„ë‹Œ ê·¸ ì´í›„ ì‹œì ì— ë°œìƒí•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><blockquote><p>At execution time, a seg fault is quite likely to occur. However, the timing of the error may surprise you. The error is not likely to appear at the â€œnaturalâ€ time, that is, when i = 200; rather, it is likely to happen much later than that. </p></blockquote><br><p>ì´ í˜„ìƒì„ ì¬í˜„í•˜ê¸° ìœ„í•´ ìš°ë¦¬ëŠ” ì´ í”„ë¡œê·¸ë¨ì„ ë³€ìˆ˜ì˜ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ê¸°ì— í¸ë¦¬í•œ GDBë¥¼ í†µí•´ ì‹¤í–‰ì‹œì¼°ìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ seg faultëŠ” iê°€ 200ì´ ì•„ë‹Œ 728(í…ŒìŠ¤íŠ¸ í™˜ê²½ì— ë”°ë¼ iì˜ ê°’ì€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ)ì—ì„œ ë°œìƒí–ˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì™œ ì´ëŸ¬í•œ í˜„ìƒì´ ë°œìƒí•˜ëŠ”ì§€ ì‚´í´ë´…ì‹œë‹¤.</p><blockquote><p>To illustrate this, we ran this program on a Linux PC under GDB, in order to conveniently query addresses of variables. It turned out that the seg fault occurred not at i = 200, but at i = 728. Letâ€™s see why.</p></blockquote><br><p>GDBì— ì§ˆì˜ ê²°ê³¼, ìš°ë¦¬ëŠ” ë°°ì—´ q(q[])ì˜ ì£¼ì†Œê°’ì´ 0x80497bfë¡œ ëë‚œë‹¤ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ì¦‰, q[199]ì˜ ë§ˆì§€ë§‰ byteê°€ í•´ë‹¹ ë©”ëª¨ë¦¬ ì£¼ì†Œì— ì¡´ì¬í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. í˜ì´ì§€ í¬ê¸°ëŠ” 4,096 byteì— 32-bitì˜ word í¬ê¸°ë¥¼ ê°–ëŠ” ì¥ì¹˜ë¼ê³  ê³ ë ¤í•´ë³¸ë‹¤ë©´, ê°€ìƒ ì£¼ì†Œ ê³µê°„ì€ 20-bitì˜ í˜ì´ì§€ ë²ˆí˜¸ì™€ 12-bitì˜ ì˜¤í”„ì…‹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì§‘ë‹ˆë‹¤. ìš°ë¦¬ í”„ë¡œê·¸ë¨ì˜ ê²½ìš°, ë°°ì—´ q[]ëŠ” ê°€ìƒ í˜ì´ì§€ ë²ˆí˜¸ 0x8049 = 32841, ì˜¤í”„ì…‹ ê°’ 0x7bf = 1983ì´ ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ qê°€ í• ë‹¹ëœ ë©”ëª¨ë¦¬ì˜ í˜ì´ì§€ ìœ„ì— ì—¬ì „íˆ 2,112 byteì˜ ê³µê°„ì´ ë‚¨ì•„ìˆê²Œ ë©ë‹ˆë‹¤. ì´ ê³µê°„ì€ integer ë³€ìˆ˜ 528ê°œë¥¼ ì €ì¥í•  ìˆ˜ ìˆìœ¼ë©°, ìš°ë¦¬ í”„ë¡œê·¸ë¨ì€ ê·¸ê²ƒì„ ë§ˆì¹˜ qì˜ ìš”ì†Œë“¤ì´ í¬í•¨ëœ ê³µê°„ìœ¼ë¡œ ì²˜ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤(q[200] ~ q[727]).</p><blockquote><p>From queries to GDB we found that the array q[] ended at address 0x80497bf; that is, the last byte of q[199] was at that memory location. Taking into account the Intel page size of 4,096 bytes and the 32-bit word size of this machine, a virtual address breaks down into a 20-bit page number and a 12-bit offset. In our case, q[] ended in virtual page number 0x8049 = 32841, offset 0x7bf = 1983. So there were still 4,096 âˆ’ 1,984 = 2,112 bytes on the page of memory on which q was allocated. That space can hold 2112 / 4 = 528 integer variables (since each is 4 bytes wide on the machine used here), and our code treated it as if it contained elements of q at â€œpositionsâ€ 200 through 727.</p></blockquote><br><p>ë¬¼ë¡  q[] ë°°ì—´ì˜ ì´ëŸ¬í•œ ìš”ì†Œ(q[200] ~ q[727])ë“¤ì€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ì§€ ì•Šì§€ë§Œ, ì»´íŒŒì¼ëŸ¬ëŠ” ë¶ˆë§Œì„ ì œê¸°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì—¬ì „íˆ í•´ë‹¹ í˜ì´ì§€ëŠ” ì“°ê¸° ê¶Œí•œì„ ê°€ì§€ê³  ìˆê¸° ë–„ë¬¸ì— í•˜ë“œì›¨ì–´ ë˜í•œ ë¶ˆë§Œì„ ì œê¸°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜¤ë¡œì§€ iê°€ 728ì´ ë˜ëŠ” ì‹œì ì— q[i]ëŠ” ë‹¤ë¥¸ í˜ì´ì§€ë¥¼ ê°€ë¦¬í‚¤ê²Œ ë©ë‹ˆë‹¤. ë°”ë¡œ ì´ ê²½ìš°ì—, í•´ë‹¹ í˜ì´ì§€ì—ëŠ” ì“°ê¸° ê¶Œí•œì´ ì—†ê²Œë˜ê³  ê°€ìƒ ë©”ëª¨ë¦¬ í•˜ë“œì›¨ì–´ëŠ” ì´ë¥¼ ê°ì§€í•˜ì—¬ seg faultë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.</p><blockquote><p>Those elements of q[] donâ€™t exist, of course, but the compiler did not complain. Neither did the hardware, since the writes were still being performed to a page for which we certainly had write permission. Only when i became 728 did q[i] refer to an address on a different page. In this case, it was a page for which we didnâ€™t have write (or any other) permission; the virtual memory hardware detected this and triggered a seg fault.</p></blockquote><br><span class="highlight-text green">êµí›ˆ: ì´ì „ì— ì–¸ê¸‰í–ˆë“¯ì´, seg faultê°€ ë°œìƒí•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒì´ ë©”ëª¨ë¦¬ ì—°ì‚°ì— ì˜¤ë¥˜ê°€ ì—†ë‹¤ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.</span><blockquote><p>The moral: As stated earlier, we canâ€™t conclude from the absence of a seg fault that a memory operation is correct.</p></blockquote><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>Reference</strong></p><ul><li>Norman Matloff, Peter Jay Salzman. (2008). The Art of Debugging with GDB, DDD, and Eclipse. No Starch Press</li><li><a href="https://nostarch.com/debugging.htm">https://nostarch.com/debugging.htm</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/%EA%B8%B0%EC%88%A0%EB%AC%B8%EC%84%9C-%EB%B2%88%EC%97%AD/">ê¸°ìˆ ë¬¸ì„œ ë²ˆì—­</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/gdb/">gdb</category>
      
      <category domain="https://chelseafandev.github.io/tags/coredump/">coredump</category>
      
      <category domain="https://chelseafandev.github.io/tags/gdb-debugging/">gdb debugging</category>
      
      <category domain="https://chelseafandev.github.io/tags/page/">page</category>
      
      <category domain="https://chelseafandev.github.io/tags/page-table/">page table</category>
      
      <category domain="https://chelseafandev.github.io/tags/seg-fault/">seg fault</category>
      
      <category domain="https://chelseafandev.github.io/tags/segmentation-fault/">segmentation fault</category>
      
      
      <comments>https://chelseafandev.github.io/2021/11/09/gdb-chapter4-program-crash/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ì¸í…” Hyperscan API í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±</title>
      <link>https://chelseafandev.github.io/2021/10/12/hyperscan-phase2/</link>
      <guid>https://chelseafandev.github.io/2021/10/12/hyperscan-phase2/</guid>
      <pubDate>Tue, 12 Oct 2021 12:20:27 GMT</pubDate>
      
      <description>&lt;p&gt;ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” &lt;a href=&quot;https://chelseafandev.github.io/2021/09/24/hyperscan-phase1/&quot;&gt;ì¸í…” Hyperscan ë ˆí¼ëŸ°ìŠ¤ ê°€ì´ë“œ ë²ˆì—­&lt;/a&gt;ì— ì´ì–´ì„œ Hyperscan APIë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ ì •ê·œ í‘œí˜„ì‹ íŒ¨í„´ ë§¤ì¹­ì„ ìˆ˜í–‰í•˜ëŠ” ìƒ˜í”Œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  í…ŒìŠ¤íŠ¸ í•´ë³´ëŠ” ì‹œê°„ì„ ê°–ê² ìŠµë‹ˆë‹¤.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” <a href="https://chelseafandev.github.io/2021/09/24/hyperscan-phase1/">ì¸í…” Hyperscan ë ˆí¼ëŸ°ìŠ¤ ê°€ì´ë“œ ë²ˆì—­</a>ì— ì´ì–´ì„œ Hyperscan APIë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ ì •ê·œ í‘œí˜„ì‹ íŒ¨í„´ ë§¤ì¹­ì„ ìˆ˜í–‰í•˜ëŠ” ìƒ˜í”Œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  í…ŒìŠ¤íŠ¸ í•´ë³´ëŠ” ì‹œê°„ì„ ê°–ê² ìŠµë‹ˆë‹¤.</p><span id="more"></span><p>í•´ë‹¹ í¬ìŠ¤íŒ…ì˜ Hyperscan ì„¤ì¹˜ ë° í…ŒìŠ¤íŠ¸ í™˜ê²½ì€ <span class="highlight-text yellow">Ubuntu 18.04.5 LTS ê¸°ì¤€</span>ì…ë‹ˆë‹¤. ë‹¤ë¥¸ OSì—ì„œ Hyperscan í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³ ì í•˜ì‹œëŠ” ë¶„ë“¤ì€ <a href="http://intel.github.io/hyperscan/dev-reference/getting_started.html#requirements">Hyperscan ê³µì‹ í™ˆí˜ì´ì§€ì— ëª…ì‹œëœ ìš”êµ¬ì‚¬í•­ ì •ë³´</a>ë¥¼ í™•ì¸í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. </p><br><!-- toc --><br><p>ì•„ë˜ ê·¸ë¦¼ì€ Hyperscan ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì»´íŒŒì¼í•˜ê¸° ìœ„í•´ ë¯¸ë¦¬ ì„¤ì¹˜ë˜ì–´ì•¼í•  ì†Œí”„íŠ¸ì›¨ì–´ ëª©ë¡ê³¼ ìµœì†Œ ë²„ì „ ì •ë³´ì…ë‹ˆë‹¤. Pcapì€ hyperscanì—ì„œ ì œê³µí•˜ëŠ” ìƒ˜í”Œ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì„ê±°ë¼ë©´ êµ³ì´ ì„¤ì¹˜í•  í•„ìš”ëŠ” ì—†ê¸°ë•Œë¬¸ì— ì œì™¸í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. (ì„¤ì¹˜ ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ í”¼ë“œë°±ë“œë¦¬ê² ìŠµë‹ˆë‹¤ğŸ˜)</p><div class="figure center" style="width:;"><img class="fig-img" src="/assets/images/hyperscan_dependency.png" alt=""></div><br><h3 id="CMake-ì„¤ì¹˜"><a href="#CMake-ì„¤ì¹˜" class="headerlink" title="CMake ì„¤ì¹˜"></a>CMake ì„¤ì¹˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install cmake</span><br></pre></td></tr></table></figure><br><h3 id="Ragel-ì„¤ì¹˜"><a href="#Ragel-ì„¤ì¹˜" class="headerlink" title="Ragel ì„¤ì¹˜"></a>Ragel ì„¤ì¹˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install ragel</span><br></pre></td></tr></table></figure><br><h3 id="Python-ì„¤ì¹˜"><a href="#Python-ì„¤ì¹˜" class="headerlink" title="Python ì„¤ì¹˜"></a>Python ì„¤ì¹˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install python</span><br></pre></td></tr></table></figure><br><h3 id="Boost-ì„¤ì¹˜"><a href="#Boost-ì„¤ì¹˜" class="headerlink" title="Boost ì„¤ì¹˜"></a>Boost ì„¤ì¹˜</h3><p><a href="https://www.boost.org/doc/libs/1_77_0/more/getting_started/unix-variants.html">Boost ê³µì‹ í™ˆí˜ì´ì§€</a>ë¥¼ ì°¸ì¡°í•˜ì—¬ ìµœì‹  ë²„ì „(21.10.11 ê¸°ì¤€ 1.77.0) ì„¤ì¹˜ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://boostorg.jfrog.io/artifactory/main/release/1.77.0/source/boost_1_77_0.tar.bz2</span><br><span class="line">$ tar xvf boost_1_77_0.tar.bz2</span><br><span class="line">$ cd boost_1_77_0</span><br><span class="line">$ sudo ./bootstrap.sh</span><br><span class="line">$ sudo ./b2 install</span><br></pre></td></tr></table></figure><br><h3 id="Hyperscan-ì†ŒìŠ¤-ë¹Œë“œ"><a href="#Hyperscan-ì†ŒìŠ¤-ë¹Œë“œ" class="headerlink" title="Hyperscan ì†ŒìŠ¤ ë¹Œë“œ"></a>Hyperscan ì†ŒìŠ¤ ë¹Œë“œ</h3><p><a href="https://github.com/intel/hyperscan">í•´ë‹¹ ë§í¬</a>ì—ì„œ Hyperscan ìµœì‹  ì†ŒìŠ¤ ì½”ë“œ(21.10.11 ê¸°ì¤€ 5.4.0)ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ tar xvf v5.4.0.tar.gz</span><br><span class="line">$ cd hyperscan-5.4.0</span><br><span class="line">$ mkdir build</span><br><span class="line">$ cd build</span><br><span class="line">$ cmake -DBUILD_STATIC_AND_SHARED=1 ../</span><br><span class="line">$ sudo make</span><br><span class="line">$ sudo make install</span><br><span class="line">ln -s /usr/local/include/boost &lt;hyperscan-source-path&gt;/include/boost</span><br></pre></td></tr></table></figure><br><h3 id="í…ŒìŠ¤íŠ¸ì½”ë“œ-ì‘ì„±"><a href="#í…ŒìŠ¤íŠ¸ì½”ë“œ-ì‘ì„±" class="headerlink" title="í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„±"></a>í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„±</h3><p>í…ŒìŠ¤íŠ¸ì½”ë“œì— ëŒ€í•œ ì„¤ëª…ì€ ì½”ë“œ ë‚´ ì£¼ì„ìœ¼ë¡œ ëŒ€ì‹ í•˜ê² ìŠµë‹ˆë‹¤.</p><figure class="codeblock codeblock--tabbed"><figcaption><span>Hyperscan API test code</span><ul class="tabs"><li class="tab active">cpp</li></ul></figcaption><div class="tabs-content"><figure class="highlight cpp" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;hs.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HyperscanTest</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">HyperscanTest()</span><br><span class="line">{</span><br><span class="line">db_ = <span class="literal">nullptr</span>;</span><br><span class="line">scratch_ = <span class="literal">nullptr</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">~HyperscanTest()</span><br><span class="line">{</span><br><span class="line">hs_free_scratch(scratch_);</span><br><span class="line">hs_free_database(db_);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// ì •ê·œí‘œí˜„ì‹ ìƒ˜í”Œ íŒ¨í„´ì´ ì €ì¥ëœ íŒŒì¼ì„ Hyperscan Pattern DBë¥¼ ì»´íŒŒì¼í•˜ê¸° ìœ„í•œ í˜•íƒœë¡œ íŒŒì‹±í•´ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// íŒŒì‹±í•˜ëŠ” íŒŒì¼ì˜ êµ¬ì¡°ëŠ” &lt;id&gt;:/&lt;pattern&gt;/&lt;flags&gt; í˜•íƒœì´ë©°, </span></span><br><span class="line"><span class="comment">// id/pattern/flagsë¥¼ ê°ê° ë©¤ë²„ ë³€ìˆ˜ì¸ ids_, patterns_, flags_ì— ì €ì¥í•©ë‹ˆë‹¤.</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">parseFile</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;filename)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="function"><span class="built_in">std</span>::ifstream <span class="title">inFile</span><span class="params">(filename, <span class="built_in">std</span>::ifstream::in)</span></span>;</span><br><span class="line"><span class="keyword">if</span> (!inFile.good())</span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ERROR: unable to open file \""</span> &lt;&lt; filename &lt;&lt; <span class="string">"\""</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; !inFile.eof(); i++)</span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> line;</span><br><span class="line">getline(inFile, line);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (line.empty() || line[<span class="number">0</span>] == <span class="string">'#'</span>)</span><br><span class="line">{</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">size_t</span> colonIdx = line.find_first_of(<span class="string">':'</span>);</span><br><span class="line"><span class="keyword">if</span> (colonIdx == <span class="built_in">std</span>::<span class="built_in">string</span>::npos)</span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ERROR: Could not parse line "</span> &lt;&lt; i &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">inFile.close();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> id = <span class="built_in">std</span>::stoi(line.substr(<span class="number">0</span>, colonIdx).c_str());</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">expr</span><span class="params">(line.substr(colonIdx + <span class="number">1</span>))</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">size_t</span> flagsStart = expr.find_last_of(<span class="string">'/'</span>);</span><br><span class="line"><span class="keyword">if</span> (flagsStart == <span class="built_in">std</span>::<span class="built_in">string</span>::npos)</span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ERROR: no trailing '/' char"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">inFile.close();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">pcre</span><span class="params">(expr.substr(<span class="number">1</span>, flagsStart - <span class="number">1</span>))</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">flagsStr</span><span class="params">(expr.substr(flagsStart + <span class="number">1</span>, expr.size() - flagsStart))</span></span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> flag = parseFlags(flagsStr);</span><br><span class="line"></span><br><span class="line">patterns_.push_back(pcre);</span><br><span class="line">flags_.push_back(flag);</span><br><span class="line">ids_.push_back(id);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">inFile.close();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// íŒŒì‹±ëœ ë°ì´í„°ë“¤ì„ í™œìš©í•˜ì—¬ Hyperscanì—ì„œ ì‚¬ìš©í•˜ëŠ” Pattern DBë¥¼ ì»´íŒŒì¼í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compileDatabase</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="keyword">hs_database_t</span> *db = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">hs_compile_error_t</span> *compileErr;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">const</span> <span class="keyword">char</span> *&gt; cstrPatterns;</span><br><span class="line">cstrPatterns.reserve(patterns_.size());</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;pattern : patterns_)</span><br><span class="line">{</span><br><span class="line">cstrPatterns.push_back(pattern.c_str());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">hs_error_t</span> err_compile = hs_compile_multi(cstrPatterns.data(), flags_.data(), ids_.data(), cstrPatterns.size(), HS_MODE_BLOCK, <span class="literal">nullptr</span>, &amp;db, &amp;compileErr);</span><br><span class="line"><span class="keyword">if</span> (err_compile != HS_SUCCESS)</span><br><span class="line">{</span><br><span class="line"><span class="keyword">if</span> (compileErr-&gt;expression &lt; <span class="number">0</span>)</span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ERROR: "</span> &lt;&lt; compileErr-&gt;message &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">hs_free_compile_error(compileErr);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ERROR: Pattern '"</span> &lt;&lt; patterns_[compileErr-&gt;expression] &lt;&lt; <span class="string">"' failed with error '"</span> &lt;&lt; compileErr-&gt;message &lt;&lt; <span class="string">"'"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">hs_free_compile_error(compileErr);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (db_ != <span class="literal">nullptr</span>)</span><br><span class="line">hs_free_database(db_);</span><br><span class="line"></span><br><span class="line">db_ = db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">hs_error_t</span> err_scratch = hs_alloc_scratch(db_, &amp;scratch_);</span><br><span class="line"><span class="keyword">if</span> (err_scratch != HS_SUCCESS)</span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ERROR: hs_alloc_scratch failed."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// ì¸ìë¡œ ì „ë‹¬ëœ íŒ¨í„´ ì •ë³´ê°€ Hyperscan Pattern DBì— ì¡´ì¬í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">scanPattern</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> pattern)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> match_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ë§¤ì¹­ë˜ëŠ” íŒ¨í„´ì´ Hyperscan Pattern DBì— ì¡´ì¬í•œë‹¤ë©´ hs_scan í•¨ìˆ˜ì˜ 6ë²ˆì§¸ ì¸ìë¡œ ë“±ë¡ë˜ëŠ” </span></span><br><span class="line"><span class="comment">// ì½œë°± í•¨ìˆ˜(í•´ë‹¹ ì½”ë“œì—ì„œëŠ” ëŒë‹¤ í•¨ìˆ˜ë¡œ êµ¬í˜„)ë¥¼ í†µí•´ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°,</span></span><br><span class="line"><span class="comment">// 5ë²ˆì§¸ ì¸ìì¸ ctxë¥¼ í†µí•´ hs_scan ì™¸ë¶€ì˜ ë³€ìˆ˜ì— ì½œë°± í•¨ìˆ˜ì˜ ê²°ê³¼ë¥¼ ì €ì¥í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</span></span><br><span class="line"><span class="keyword">if</span> (hs_scan(</span><br><span class="line">db_,</span><br><span class="line">pattern.c_str(),</span><br><span class="line">pattern.length(),</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">scratch_,</span><br><span class="line">[](<span class="keyword">unsigned</span> <span class="keyword">int</span> id, <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> from, <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> to, <span class="keyword">unsigned</span> <span class="keyword">int</span> flags, <span class="keyword">void</span> *ctx) -&gt; <span class="keyword">int</span></span><br><span class="line">{</span><br><span class="line"><span class="keyword">size_t</span> *matches = (<span class="keyword">size_t</span> *)ctx;</span><br><span class="line">(*matches)++;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"id: "</span> &lt;&lt; id &lt;&lt; <span class="string">" from: "</span> &lt;&lt; from &lt;&lt; <span class="string">" to: "</span> &lt;&lt; to &lt;&lt; <span class="string">" flags: "</span> &lt;&lt; flags &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">},</span><br><span class="line">&amp;match_count) != HS_SUCCESS)</span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"hs_scan failed."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"match count: "</span> &lt;&lt; match_count &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">hs_database_t</span> *db_;</span><br><span class="line">   <span class="keyword">hs_stream_t</span> *stream_;</span><br><span class="line">   <span class="keyword">hs_scratch_t</span> *scratch_;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt; ids_;</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; patterns_;</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt; flags_;</span><br><span class="line"></span><br><span class="line"><span class="comment">// parseFile í•¨ìˆ˜ì—ì„œ í˜¸ì¶œí•˜ë©° íŒŒì¼ì— ë“±ë¡ëœ flags ì •ë³´ë¥¼ Hyperscanì—ì„œ ì •ì˜í•œ ìƒìˆ˜ ê°’ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì‘ì—…ì„ í•©ë‹ˆë‹¤.</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">parseFlags</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;flagsStr)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> flags = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;c : flagsStr)</span><br><span class="line">{</span><br><span class="line"><span class="keyword">switch</span> (c)</span><br><span class="line">{</span><br><span class="line"><span class="keyword">case</span> <span class="string">'i'</span>:</span><br><span class="line">flags |= HS_FLAG_CASELESS;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'m'</span>:</span><br><span class="line">flags |= HS_FLAG_MULTILINE;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'s'</span>:</span><br><span class="line">flags |= HS_FLAG_DOTALL;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'H'</span>:</span><br><span class="line">flags |= HS_FLAG_SINGLEMATCH;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'V'</span>:</span><br><span class="line">flags |= HS_FLAG_ALLOWEMPTY;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'8'</span>:</span><br><span class="line">flags |= HS_FLAG_UTF8;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'W'</span>:</span><br><span class="line">flags |= HS_FLAG_UCP;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'\r'</span>: <span class="comment">// stray carriage-return</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> flags;</span><br><span class="line">}</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">   HyperscanTest hst;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. ì •ê·œí‘œí˜„ì‹ ìƒ˜í”Œ íŒ¨í„´ë“¤ì´ ë“±ë¡ëœ íŒŒì¼ì„ Hyperscanì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ í˜•íƒœë¡œ íŒŒì‹±</span></span><br><span class="line"><span class="keyword">if</span>(!hst.parseFile(<span class="string">"./pattern.db"</span>))</span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"parseFile failed."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Hyperscan Pattern DB ì»´íŒŒì¼</span></span><br><span class="line"><span class="keyword">if</span>(!hst.compileDatabase())</span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"compileDatabase failed."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   {</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> pattren = <span class="string">""</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ì²´í¬í•  íŒ¨í„´ì„ ì…ë ¥í•˜ì„¸ìš” &gt;&gt; "</span>;</span><br><span class="line">    getline(<span class="built_in">std</span>::<span class="built_in">cin</span>, pattren);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. ì»´íŒŒì¼ëœ Hyperscan Pattern DBë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŒ¨í„´ ì²´í¬</span></span><br><span class="line"><span class="keyword">if</span>(!hst.scanPattern(pattren))</span><br><span class="line">{</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"scanPattern failed."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">}</span><br><span class="line">   } <span class="keyword">while</span> (<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure><br><h3 id="ì •ê·œí‘œí˜„ì‹-ìƒ˜í”Œ-íŒ¨í„´-ë“±ë¡"><a href="#ì •ê·œí‘œí˜„ì‹-ìƒ˜í”Œ-íŒ¨í„´-ë“±ë¡" class="headerlink" title="ì •ê·œí‘œí˜„ì‹ ìƒ˜í”Œ íŒ¨í„´ ë“±ë¡"></a>ì •ê·œí‘œí˜„ì‹ ìƒ˜í”Œ íŒ¨í„´ ë“±ë¡</h3><p>ì•„ë˜ ì˜ˆì‹œëŠ” (ìˆœì„œëŒ€ë¡œ) ì´ë©”ì¼, ì „í™”ë²ˆí˜¸, íœ´ëŒ€í°ë²ˆí˜¸, ìš°í¸ë²ˆí˜¸, ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ì— ëŒ€í•œ ì •ê·œí‘œí˜„ì‹ ìƒ˜í”Œ íŒ¨í„´ì´ë©°, ìƒì„±í•œ pattern.dbëŠ” í…ŒìŠ¤íŠ¸ì½”ë“œ ë¹Œë“œ ê²°ê³¼ ìƒì„±ë˜ëŠ” ì‹¤í–‰ íŒŒì¼(example)ê³¼ ë™ì¼í•œ ê²½ë¡œì— ìœ„ì¹˜ì‹œí‚¤ë©´ ë©ë‹ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ vim pattern.db</span><br><span class="line"></span><br><span class="line">1:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,4&#125;$/</span><br><span class="line">2:/^(070|02|031|032|033|041|042|043|051|052|053|054|055|061|062|063|064)-\d&#123;3,4&#125;-\d&#123;4&#125;$/</span><br><span class="line">3:/^(010|011|016|017|018|019)-\d&#123;3,4&#125;-\d&#123;4&#125;$/</span><br><span class="line">4:/^\d&#123;3&#125;-?\d&#123;3&#125;$/</span><br><span class="line">5:/^\d&#123;2&#125;[0-1]\d[0-3]\d-?[1-6]\d&#123;6&#125;$/</span><br></pre></td></tr></table></figure><br><h3 id="ë¹Œë“œ-ë°-í…ŒìŠ¤íŠ¸"><a href="#ë¹Œë“œ-ë°-í…ŒìŠ¤íŠ¸" class="headerlink" title="ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸"></a>ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ c++ -I /usr/local/include/hs example.cpp -o example -L &lt;hyperscan-source-path&gt;/build/lib -lhs</span><br><span class="line">$ ./example</span><br><span class="line">ì²´í¬í•  íŒ¨í„´ì„ ì…ë ¥í•˜ì„¸ìš” &gt;&gt; 900101-1234567</span><br><span class="line">id: 5 from: 0 to: 14 flags: 0</span><br><span class="line">match count: 1</span><br><span class="line">ì²´í¬í•  íŒ¨í„´ì„ ì…ë ¥í•˜ì„¸ìš” &gt;&gt; 010-1234-5678</span><br><span class="line">id: 3 from: 0 to: 13 flags: 0</span><br><span class="line">match count: 1</span><br><span class="line">ì²´í¬í•  íŒ¨í„´ì„ ì…ë ¥í•˜ì„¸ìš” &gt;&gt; bluetomorrow90@gmail.com</span><br><span class="line">id: 1 from: 0 to: 24 flags: 0</span><br><span class="line">match count: 1</span><br><span class="line">ì²´í¬í•  íŒ¨í„´ì„ ì…ë ¥í•˜ì„¸ìš” &gt;&gt; </span><br></pre></td></tr></table></figure><div class="alert info"><p>example ì‹¤í–‰ ì‹œ libhs.soë¥¼ ì°¸ì¡°í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ì—ëŠ” ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì°¸ì¡° ê²½ë¡œë¥¼ ì§ì ‘ ì§€ì •í•´ì¤ë‹ˆë‹¤.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ export LD_LIBRARY_PATH=&lt;hyperscan-source-path&gt;/build/lib</span><br></pre></td></tr></table></figure></div><br><h3 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h3><p>ì§€ê¸ˆê¹Œì§€ Hyperscan ì†ŒìŠ¤ ë¹Œë“œ ê³¼ì •ê³¼ ì •ê·œí‘œí˜„ì‹ ìƒ˜í”Œ íŒ¨í„´ì„ ì²´í¬í•˜ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. í•´ë‹¹ í¬ìŠ¤íŒ…ì—ì„œëŠ” Hyperscan APIì˜ ê°€ì¥ ê¸°ë³¸ì ì¸ ë™ì‘ë“¤ë§Œì„ ì‚´í´ë³´ì•˜êµ¬ìš”, Hyperscan ê³µì‹ ë¬¸ì„œë¥¼ ì‚´í´ë³´ë©´ ë©€í‹°ì“°ë ˆë“œ í™˜ê²½(â€œmainâ€ threadì—ì„œ pattern dbë¥¼ compileí•˜ê³  2ê°œ ì´ìƒì˜ â€œworkerâ€ threadì—ì„œ scanì„ ìˆ˜í–‰)ì—ì„œë„ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤ê³  í•˜ë‹ˆ ì–´ë–¤ì‹ìœ¼ë¡œ êµ¬í˜„í•´ì•¼í• ì§€ í•¨ê»˜ ê³ ë¯¼í•´ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ğŸ™‚</p><blockquote><p>In a scenario where a set of expressions are compiled by a single â€œmainâ€ thread and data will be scanned by multiple â€œworkerâ€ threads, the convenience function hs_clone_scratch() allows multiple copies of an existing scratch space to be made for each thread (rather than forcing the caller to pass all the compiled databases through hs_alloc_scratch() multiple times).</p></blockquote><br><br><span class="highlight-text yellow">í•´ë‹¹ ê²Œì‹œê¸€ì—ì„œ ë°œìƒí•œ ì˜¤íƒˆìë‚˜ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì •ì • ëŒ“ê¸€ ê²©í•˜ê²Œ í™˜ì˜í•©ë‹ˆë‹¤</span>ğŸ˜<p><strong>Reference</strong></p><ul><li><a href="https://intel.github.io/hyperscan/dev-reference/getting_started.html">https://intel.github.io/hyperscan/dev-reference/getting_started.html</a></li><li><a href="https://www.boost.org/doc/libs/1_77_0/more/getting_started/unix-variants.html">https://www.boost.org/doc/libs/1_77_0/more/getting_started/unix-variants.html</a></li><li><a href="https://github.com/intel/hyperscan">https://github.com/intel/hyperscan</a></li><li><a href="https://myeonguni.tistory.com/1555">https://myeonguni.tistory.com/1555</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://chelseafandev.github.io/categories/%EA%B8%B0%EC%88%A0%EB%AC%B8%EC%84%9C-%EB%B2%88%EC%97%AD/">ê¸°ìˆ ë¬¸ì„œ ë²ˆì—­</category>
      
      
      <category domain="https://chelseafandev.github.io/tags/hyperscan/">hyperscan</category>
      
      <category domain="https://chelseafandev.github.io/tags/regex/">regex</category>
      
      <category domain="https://chelseafandev.github.io/tags/regular-expression/">regular expression</category>
      
      <category domain="https://chelseafandev.github.io/tags/%EC%9D%B8%ED%85%94-%ED%95%98%EC%9D%B4%ED%8D%BC%EC%8A%A4%EC%BA%94/">ì¸í…” í•˜ì´í¼ìŠ¤ìº”</category>
      
      <category domain="https://chelseafandev.github.io/tags/%EC%A0%95%EA%B7%9C%ED%91%9C%ED%98%84%EC%8B%9D-%ED%8C%A8%ED%84%B4-%EB%A7%A4%EC%B9%AD/">ì •ê·œí‘œí˜„ì‹ íŒ¨í„´ ë§¤ì¹­</category>
      
      
      <comments>https://chelseafandev.github.io/2021/10/12/hyperscan-phase2/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
